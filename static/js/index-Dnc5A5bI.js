import{_ as M}from"./Table-CEy5VCRK.js";import{V as q,i as A,b as z,X as B,Y as N,_ as I,F,a as G,G as O,d as P}from"./element-plus-DEgQ78-a.js";import{_ as W}from"./CommonSelect-BPJDZPOW.js";import{p as D}from"./vueuse-CTCWISgP.js";import{b as j}from"./@vueuse-80B0Z04t.js";import{r as J,e as X,f as K}from"./options-BvRdR4NQ.js";import{T as m,n as f,J as L}from"./index-CYWUNeU5.js";import{d as Q,i as Z,m as R,k as ee,o as c,M as g,O as i,u as o,W as l,T as u,U as x,c as te,a as h,S as T}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./vue-router-MJGgZ6ro.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const ae={key:1},oe={class:"flex-center"},le={class:"dialog-footer"},Ie=Q({__name:"index",setup(ne){const k=Z(),{width:w}=j(),e=R({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,eidt_index:0,select_list:[],data_list:[],only_trashed:!1,create_data:!1,show_dialog:!1,request_options:J,request_type_tag:X,request_api_type:K}),y=R({id:void 0,name:void 0,cost:0,type:void 0,route:void 0,remark:void 0,method:void 0}),r=ee(()=>e.create_data?y:e.data_list[e.eidt_index]||y),d={initData:()=>{d.fetchData()},fetchData:async()=>{e.loading=1;const n=await m.all({order:"name asc",page:e.page,limit:e.limit,onlyTrashed:e.only_trashed});n.code===200?(e.data_list=n.data.data,e.count=n.data.count,e.page_count=n.data.page):e.data_list=[],e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,d.fetchData()},handleSelect:n=>{e.select_list=[...n.map(t=>t.id)]},handleAdd:()=>{e.create_data=!0,e.show_dialog=!0},handleEdit:n=>{e.create_data=!1,e.eidt_index=n,e.show_dialog=!0},handleSave:()=>{e.create_data?d.handleCreate():d.handleUpdate()},handleCreate:async()=>{e.loading=2;const n=await m.create(r.value);f(n),e.loading=0,n.code===200&&(d.fetchData(),L(y),e.show_dialog=!1)},handleUpdate:async()=>{e.loading=2;const n=await m.update({...r.value});f(n),e.show_dialog=!1,e.loading=0},handleRestore:async(n,t)=>{t===-1?e.loading=4:e.loading_index=t;const s=await m.restore(n);f(s),e.data_list=e.data_list.filter(b=>!s.data.ids.includes(b.id)),e.loading_index=-1,e.loading=0},handleRemove:async n=>{const t=e.only_trashed?await m.delete(n):await m.remove(n);f(t),t.code===200&&(e.data_list=e.data_list.filter(s=>!t.data.ids.includes(s.id))),d.fetchData()},rowDblclick:n=>{e.select_list.includes(n.id)?e.select_list=e.select_list.filter(t=>t!==n.id):e.select_list.push(n.id),k.value.toggleRowSelection(n)},getType(n){return e.request_type_tag[n]||"info"}};return d.initData(),(n,t)=>{const s=q,b=A,_=z,S=B,U=N,E=I,p=F,v=G,C=W,$=O,Y=P,H=M;return c(),g(H,{class:"auth-rules-table-container",page:o(e).page,"onUpdate:page":t[8]||(t[8]=a=>o(e).page=a),limit:o(e).limit,"onUpdate:limit":t[9]||(t[9]=a=>o(e).limit=a),pageCount:o(e).page_count,"onUpdate:pageCount":t[10]||(t[10]=a=>o(e).page_count=a),isScreen:o(e).is_screen,"onUpdate:isScreen":t[11]||(t[11]=a=>o(e).is_screen=a),loading:o(e).loading,length:o(e).select_list.length,count:o(e).count,onlyTrashed:o(e).only_trashed,onHandleAdd:t[12]||(t[12]=a=>d.handleAdd()),onHandleRestore:t[13]||(t[13]=a=>d.handleRestore(o(e).select_list,-1)),onHandleRemove:t[14]||(t[14]=a=>d.handleRemove(o(e).select_list)),onGetTrash:t[15]||(t[15]=a=>d.getTrash()),onHandleRefresh:t[16]||(t[16]=a=>d.fetchData())},{default:i(()=>[l(U,{border:"",ref_key:"tableRef",ref:k,data:o(e).data_list,"empty-text":"",class:"w-100","max-height":o(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:d.handleSelect,onRowDblclick:d.rowDblclick},{default:i(()=>[l(s,{fixed:"",type:"selection",width:"45"}),l(s,{fixed:o(w)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),l(s,{prop:"name",label:"名称",width:"300","show-overflow-tooltip":""}),l(s,{width:"100",align:"center",label:"请求类型"},{default:i(({row:a})=>[a.method?(c(),g(b,{key:0,type:d.getType(a.method)},{default:i(()=>[u(x(a.method),1)]),_:2},1032,["type"])):(c(),te("span",ae,"-"))]),_:1}),l(s,{prop:"hash",label:"哈希",width:"130","show-overflow-tooltip":""}),l(s,{prop:"cost",align:"center",label:"消费(算粒)",width:"100","show-overflow-tooltip":""}),l(s,{prop:"route","min-width":"300",label:"API","show-overflow-tooltip":"",formatter:a=>a.route||"-"},null,8,["formatter"]),l(s,{prop:"remark","min-width":"200",label:"备注","show-overflow-tooltip":"",formatter:a=>a.remark||"-"},null,8,["formatter"]),l(s,{prop:"update_time",sortable:"",label:"更新时间",width:"180"},{default:i(a=>[h("span",null,x(o(D)(a.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),l(s,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:i(a=>[h("span",null,x(o(D)(a.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),l(s,{fixed:o(w)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:140},{default:i(a=>[h("div",oe,[o(e).only_trashed?T("",!0):(c(),g(_,{key:0,size:"small",type:"primary",plain:"",onClick:V=>d.handleEdit(a.$index)},{default:i(()=>[u(" 编辑 ")]),_:2},1032,["onClick"])),o(e).only_trashed?(c(),g(_,{key:1,onClick:V=>d.handleRestore([a.row.id],a.$index),size:"small",loading:o(e).loading_index===a.$index,type:"success",plain:""},{default:i(()=>[u(" 恢复 ")]),_:2},1032,["onClick","loading"])):T("",!0),l(S,{onConfirm:V=>d.handleRemove([a.row.id]),width:"180",title:o(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:i(()=>[l(_,{size:"small",type:"danger",plain:""},{default:i(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"]),l(Y,{modelValue:o(e).show_dialog,"onUpdate:modelValue":t[7]||(t[7]=a=>o(e).show_dialog=a),draggable:"",width:"95%",title:"编辑权限规则"},{footer:i(()=>[h("span",le,[l(_,{onClick:t[6]||(t[6]=a=>o(e).show_dialog=!1)},{default:i(()=>[u("取消")]),_:1}),l(_,{loading:o(e).loading===2,type:"primary",onClick:d.handleSave},{default:i(()=>[u(" 确认 ")]),_:1},8,["loading","onClick"])])]),default:i(()=>[l($,{model:o(r),"label-position":o(w)<=768?"top":"left"},{default:i(()=>[l(p,{label:"费用"},{default:i(()=>[l(E,{class:"w-100",modelValue:o(r).cost,"onUpdate:modelValue":t[0]||(t[0]=a=>o(r).cost=a),min:0},null,8,["modelValue"])]),_:1}),l(p,{label:"名称"},{default:i(()=>[l(v,{modelValue:o(r).name,"onUpdate:modelValue":t[1]||(t[1]=a=>o(r).name=a),placeholder:"权限规则名称"},null,8,["modelValue"])]),_:1}),l(p,{label:"接口"},{default:i(()=>[l(v,{modelValue:o(r).route,"onUpdate:modelValue":t[2]||(t[2]=a=>o(r).route=a),placeholder:"接口地址"},null,8,["modelValue"])]),_:1}),l(p,{label:"请求"},{default:i(()=>[l(C,{value:o(r).method,"onUpdate:value":t[3]||(t[3]=a=>o(r).method=a),options:o(e).request_options},null,8,["value","options"])]),_:1}),l(p,{label:"类型"},{default:i(()=>[l(C,{value:o(r).type,"onUpdate:value":t[4]||(t[4]=a=>o(r).type=a),options:o(e).request_api_type},null,8,["value","options"])]),_:1}),l(p,{label:"备注"},{default:i(()=>[l(v,{modelValue:o(r).remark,"onUpdate:modelValue":t[5]||(t[5]=a=>o(r).remark=a),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入标签描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Ie as default};
