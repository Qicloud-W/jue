import{_ as z}from"./Table-CEy5VCRK.js";import{a as B,b as N,V as K,W,X as P,Y as F}from"./element-plus-DEgQ78-a.js";import{d as G,i as I,m as L,bg as O,ar as X,o as c,M as v,O as s,u as i,a as r,W as o,ai as j,T as g,U as f,c as _,V as q,aa as J,P as Q,S as b}from"./@vue-AVcRlItG.js";import{p as A}from"./vueuse-CTCWISgP.js";import{u as Z}from"./vue-router-MJGgZ6ro.js";import{b as ee}from"./@vueuse-80B0Z04t.js";import{u as te,f as h,n as k}from"./index-CYWUNeU5.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const ae={class:"right flex g-2",style:{"min-width":"40%"}},le={class:"px-2 py-1"},ie={class:"flex-yc g-2 flex-wrap"},ne=r("span",null,"作者：",-1),oe=["onClick"],se={class:"flex-yc mt-1 g-2 flex-wrap"},re=r("span",null,"分组：",-1),de={key:0,class:"group-list flex g-1"},pe={key:1},ce={class:"flex mt-1 g-2 word-break"},me=r("span",{class:"flex-shrink-0"},"摘要：",-1),ue={class:"fs-14 lh-17"},_e=["src"],he={key:1},ge={class:"flex-center"},Je=G({__name:"list",setup(fe){const w=Z(),x=I(),{width:C}=ee(),D=te(),e=L({page:1,count:0,limit:15,page_count:0,keywords:"",is_screen:!1,loading:0,loading_index:-1,select_list:[],data_list:[],only_trashed:!1}),V=({row:l})=>l.audit!==1?"no-audit":l.audit===1&&l.top===1?"set-top":"",n={fetchData:async()=>{var m;e.loading=1;let l=[],t=[];D.admin||l.push(["uid","=",((m=D.user)==null?void 0:m.id)||0]),e.keywords&&(t.push(["title","like",`%${e.keywords}%`]),t.push(["content","like",`%${e.keywords}%`]),t.push(["abstract","like",`%${e.keywords}%`]));const d=await h.all({page:e.page,limit:e.limit,onlyTrashed:e.only_trashed,or:t,where:l});d.code===200?(e.data_list=d.data.data,e.count=d.data.count,e.page_count=d.data.page):e.data_list=[],e.loading=0},startSearch:()=>{e.page=1,n.fetchData()},getTrash:()=>{e.only_trashed=!e.only_trashed,n.fetchData()},handleSelect:l=>{e.select_list=[...l.map(t=>t.id)]},handleAdd:()=>{w.push({name:"admin-article-write"})},handleEdit:l=>{w.push({name:"admin-article-write",params:{id:l}})},handleRestore:async(l,t)=>{t===-1?e.loading=4:e.loading_index=t;const d=await h.restore(l);k(d),e.data_list=e.data_list.filter(m=>!d.data.ids.includes(m.id)),e.loading_index=-1,e.loading=0},handleRemove:async l=>{const t=e.only_trashed?await h.delete(l):await h.remove(l);k(t),t.code===200&&(e.data_list=e.data_list.filter(d=>!t.data.ids.includes(d.id))),n.fetchData()},handleTop:async l=>{const t=await h.update({id:l.id,top:l.top===1?0:1});t.code===200&&(l.top=l.top===1?0:1),k(t)},handleAudit:async l=>{const t=await h.update({id:l.id,audit:l.audit===1?0:1});t.code===200&&(l.audit=l.audit===1?0:1),k(t)},rowDblclick:l=>{e.select_list.includes(l.id)?e.select_list=e.select_list.filter(t=>t!==l.id):e.select_list.push(l.id),x.value.toggleRowSelection(l)},formatEmpty:l=>l.abstract||"-"};return O(()=>{n.fetchData()}),(l,t)=>{const d=B,m=N,p=K,S=W,Y=P,H=F,M=z,U=X("imgbox");return c(),v(M,{class:"article-group-data-container",page:i(e).page,"onUpdate:page":t[1]||(t[1]=a=>i(e).page=a),limit:i(e).limit,"onUpdate:limit":t[2]||(t[2]=a=>i(e).limit=a),pageCount:i(e).page_count,"onUpdate:pageCount":t[3]||(t[3]=a=>i(e).page_count=a),isScreen:i(e).is_screen,"onUpdate:isScreen":t[4]||(t[4]=a=>i(e).is_screen=a),loading:i(e).loading,length:i(e).select_list.length,count:i(e).count,onlyTrashed:i(e).only_trashed,onHandleAdd:t[5]||(t[5]=a=>n.handleAdd()),onHandleRestore:t[6]||(t[6]=a=>n.handleRestore(i(e).select_list,-1)),onHandleRemove:t[7]||(t[7]=a=>n.handleRemove(i(e).select_list)),onGetTrash:t[8]||(t[8]=a=>n.getTrash()),onHandleRefresh:t[9]||(t[9]=a=>n.fetchData())},{"top-right":s(()=>[r("div",ae,[o(d,{clearable:"",placeholder:"输入关键词回车搜索...",modelValue:i(e).keywords,"onUpdate:modelValue":t[0]||(t[0]=a=>i(e).keywords=a),onKeyup:j(n.startSearch,["enter"])},null,8,["modelValue","onKeyup"]),o(m,{type:"primary",onClick:n.startSearch},{default:s(()=>[g("查询")]),_:1},8,["onClick"])])]),default:s(()=>[o(H,{border:"",ref_key:"tableRef",ref:x,data:i(e).data_list,"empty-text":"",class:"w-100","row-class-name":V,"max-height":i(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:n.handleSelect,onRowDblclick:n.rowDblclick},{default:s(()=>[o(p,{fixed:"",type:"selection",width:"45"}),o(p,{fixed:i(C)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),o(p,{type:"expand",width:"60",label:"展开"},{default:s(a=>{var u,$,R;return[r("div",le,[r("div",ie,[ne,r("span",{class:"curp theme-hover",onClick:T=>{var y,E;return i(w).push({name:"admin-manage-user-detail",params:{id:(E=(y=a.row.result)==null?void 0:y.author)==null?void 0:E.id}})}},f(($=(u=a.row.result)==null?void 0:u.author)==null?void 0:$.nickname),9,oe)]),r("div",se,[re,(R=a.row.result.group)!=null&&R.length?(c(),_("div",de,[(c(!0),_(q,null,J(a.row.result.group,(T,y)=>(c(),_("span",{class:"group-span",key:y},f(T.name),1))),128))])):(c(),_("span",pe,"无"))]),r("div",ce,[me,r("p",ue,f(a.row.abstract||"无"),1)])])]}),_:1}),o(p,{prop:"title",label:"标题","min-width":"250","show-overflow-tooltip":""}),o(p,{"class-name":"cover-item ",prop:"cover",label:"封面",align:"center",width:"80"},{default:s(a=>[Q((c(),_("div",null,[a.row.covers?(c(),_("img",{key:0,src:a.row.covers.split(",")[0],class:"logo br"},null,8,_e)):(c(),_("span",he,"-"))])),[[U]])]),_:1}),o(p,{prop:"top",width:"80",label:"置顶",align:"center"},{default:s(({row:a})=>[o(S,{"inline-prompt":"","active-text":"是","inactive-text":"否","model-value":a.top===1,onChange:u=>n.handleTop(a)},null,8,["model-value","onChange"])]),_:1}),o(p,{width:"80",label:"审核",align:"center"},{default:s(({row:a})=>[o(S,{"inline-prompt":"","active-text":"是","inactive-text":"否","model-value":a.audit===1,onChange:u=>n.handleAudit(a)},null,8,["model-value","onChange"])]),_:1}),o(p,{prop:"views",sortable:"",label:"浏览",width:"80",align:"center"}),o(p,{prop:"update_time",sortable:"",label:"更新时间",width:"160"},{default:s(a=>[r("span",null,f(i(A)(a.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(p,{prop:"create_time",sortable:"",width:"160",label:"创建时间"},{default:s(a=>[r("span",null,f(i(A)(a.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(p,{fixed:i(C)<768?!1:"right",align:"center",label:"操作","class-name":"center",width:190},{default:s(a=>[r("div",ge,[i(e).only_trashed?b("",!0):(c(),v(m,{key:0,size:"small",type:"success",plain:"",onClick:u=>i(w).push({name:"admin-article-detail",params:{id:a.row.id}})},{default:s(()=>[g(" 详情 ")]),_:2},1032,["onClick"])),i(e).only_trashed?b("",!0):(c(),v(m,{key:1,size:"small",type:"primary",plain:"",onClick:u=>n.handleEdit(a.row.id)},{default:s(()=>[g(" 编辑 ")]),_:2},1032,["onClick"])),i(e).only_trashed?(c(),v(m,{key:2,onClick:u=>n.handleRestore([a.row.id],a.$index),size:"small",loading:i(e).loading_index===a.$index,type:"success",plain:""},{default:s(()=>[g(" 恢复 ")]),_:2},1032,["onClick","loading"])):b("",!0),o(Y,{onConfirm:u=>n.handleRemove([a.row.id]),width:"180",title:i(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:s(()=>[o(m,{size:"small",type:"danger",plain:""},{default:s(()=>[g(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Je as default};
