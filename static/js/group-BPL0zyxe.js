import{_ as A}from"./Table-CEy5VCRK.js";import{V as I,b as N,X as z,Y as B,a as P,F,G,d as O}from"./element-plus-DEgQ78-a.js";import{_ as K}from"./InputUpload.vue_vue_type_style_index_0_lang-B-6SKlPI.js";import{_ as W}from"./CommonSelect-BPJDZPOW.js";import{p as D}from"./vueuse-CTCWISgP.js";import{l as J,o as m,n as f,J as X}from"./index-CYWUNeU5.js";import{b as q}from"./@vueuse-80B0Z04t.js";import{d as L,i as Q,m as S,k as Z,ar as ee,o as u,M as y,O as i,u as a,W as n,P as te,c as b,a as g,U as V,T as _,S as E}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./vue-router-MJGgZ6ro.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const ae=["src"],oe={key:1},le={class:"flex-center"},ne={class:"dialog-footer"},Pe=L({__name:"group",setup(ie){const R=J(),{width:v}=q(),x=Q(),e=S({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,edit_index:0,select_list:[],data_list:[],data_tree:[],only_trashed:!1,create_data:!1,show_dialog:!1}),h=S({id:void 0,name:void 0,key:void 0,avatar:void 0,pid:void 0,description:void 0,json:{cover:void 0}}),s=Z(()=>{const l=e.data_list.find(t=>t.id===e.edit_index);return l?(l.json=l.json||{cover:void 0},e.create_data?h:l):h}),d={fetchData:async()=>{e.loading=1;const l=await m.tree({onlyTrashed:e.only_trashed});l.code===200&&(e.data_tree=l.data);const t=await m.column({onlyTrashed:e.only_trashed});t.code===200&&(e.data_list=[...t.data,{id:0,name:"置于顶级"}]),e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,d.fetchData()},handleSelect:l=>{e.select_list=[...l.map(t=>t.value)]},handleAdd:()=>{e.create_data=!0,e.show_dialog=!0},handleEdit:l=>{e.create_data=!1,e.edit_index=l,e.show_dialog=!0},handleSave:()=>{e.create_data?d.handleCreate():d.handleUpdate()},handleCreate:async()=>{e.loading=2;const l=await m.create(s.value);f(l),e.loading=0,l.code===200&&(d.fetchData(),X(h),e.show_dialog=!1)},handleUpdate:async()=>{e.loading=2;const l=await m.update({...s.value,pid:s.value.pid||0});f(l),l.code===200&&d.fetchData(),e.show_dialog=!1,e.loading=0},handleRestore:async(l,t)=>{t===-1?e.loading=4:e.loading_index=t;const r=await m.restore(l);f(r),e.data_tree=e.data_tree.filter(p=>!r.data.ids.includes(p.value)),e.loading_index=-1,e.loading=0},handleRemove:async l=>{const t=e.only_trashed?await m.delete(l):await m.remove(l);f(t),t.code===200&&(e.data_tree=e.data_tree.filter(r=>!t.data.ids.includes(r.value))),d.fetchData()},rowDblclick:l=>{e.select_list.includes(l.id)?e.select_list=e.select_list.filter(t=>t!==l.id):e.select_list.push(l.id),x.value.toggleRowSelection(l)},formatEmpty:l=>l.data.description||"-"};return d.fetchData(),(l,t)=>{const r=I,p=N,T=z,U=B,w=P,c=F,$=W,k=K,j=G,H=O,M=A,Y=ee("imgbox");return u(),y(M,{class:"article-group-data-container",page:a(e).page,"onUpdate:page":t[8]||(t[8]=o=>a(e).page=o),limit:a(e).limit,"onUpdate:limit":t[9]||(t[9]=o=>a(e).limit=o),pageCount:a(e).page_count,"onUpdate:pageCount":t[10]||(t[10]=o=>a(e).page_count=o),isScreen:a(e).is_screen,"onUpdate:isScreen":t[11]||(t[11]=o=>a(e).is_screen=o),loading:a(e).loading,length:a(e).select_list.length,count:a(e).count,onlyTrashed:a(e).only_trashed,showPagination:!1,onHandleAdd:t[12]||(t[12]=o=>d.handleAdd()),onHandleRestore:t[13]||(t[13]=o=>d.handleRestore(a(e).select_list,-1)),onHandleRemove:t[14]||(t[14]=o=>d.handleRemove(a(e).select_list)),onGetTrash:t[15]||(t[15]=o=>d.getTrash()),onHandleRefresh:t[16]||(t[16]=o=>d.fetchData())},{default:i(()=>[n(U,{border:"",ref_key:"tableRef",ref:x,data:a(e).data_tree,"empty-text":"","row-key":"value",class:"w-100","max-height":a(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:d.handleSelect,onRowDblclick:d.rowDblclick},{default:i(()=>[n(r,{fixed:"",type:"selection",width:"45"}),n(r,{fixed:a(v)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),n(r,{prop:"data.name",label:"名称",width:"150","show-overflow-tooltip":""}),n(r,{prop:"data.key",label:"分组别名",width:"100","show-overflow-tooltip":""}),n(r,{"class-name":"logo-item ",prop:"data.avatar",label:"图标",align:"center",width:"80"},{default:i(o=>[te((u(),b("div",null,[o.row.data.avatar?(u(),b("img",{key:0,src:o.row.data.avatar,class:"logo br"},null,8,ae)):(u(),b("span",oe,"-"))])),[[Y]])]),_:1}),n(r,{prop:"data.description","min-width":"200",label:"描述","show-overflow-tooltip":"",formatter:d.formatEmpty},null,8,["formatter"]),n(r,{prop:"update_time",sortable:"",label:"更新时间",width:"180"},{default:i(o=>[g("span",null,V(a(D)(o.row.data.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),n(r,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:i(o=>[g("span",null,V(a(D)(o.row.data.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),n(r,{fixed:a(v)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:140},{default:i(o=>[g("div",le,[a(e).only_trashed?E("",!0):(u(),y(p,{key:0,size:"small",type:"primary",plain:"",onClick:C=>d.handleEdit(o.row.value)},{default:i(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),a(e).only_trashed?(u(),y(p,{key:1,onClick:C=>d.handleRestore([o.row.data.id],o.$index),size:"small",loading:a(e).loading_index===o.$index,type:"success",plain:""},{default:i(()=>[_(" 恢复 ")]),_:2},1032,["onClick","loading"])):E("",!0),n(T,{onConfirm:C=>d.handleRemove([o.row.data.id]),width:"180",title:a(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:i(()=>[n(p,{size:"small",type:"danger",plain:""},{default:i(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"]),n(H,{draggable:"",modelValue:a(e).show_dialog,"onUpdate:modelValue":t[7]||(t[7]=o=>a(e).show_dialog=o),width:"95%",title:"编辑文章分组"},{footer:i(()=>[g("span",ne,[n(p,{onClick:t[6]||(t[6]=o=>a(e).show_dialog=!1)},{default:i(()=>[_("取消")]),_:1}),n(p,{loading:a(e).loading===2,type:"primary",onClick:d.handleSave},{default:i(()=>[_(" 确认 ")]),_:1},8,["loading","onClick"])])]),default:i(()=>[n(j,{model:a(s),"label-position":a(v)<=768?"top":"left"},{default:i(()=>[n(c,{label:"分组名字"},{default:i(()=>[n(w,{modelValue:a(s).name,"onUpdate:modelValue":t[0]||(t[0]=o=>a(s).name=o),placeholder:"请输入分组名"},null,8,["modelValue"])]),_:1}),n(c,{label:"分组别名"},{default:i(()=>[n(w,{modelValue:a(s).key,"onUpdate:modelValue":t[1]||(t[1]=o=>a(s).key=o),placeholder:"请输入英文别名"},null,8,["modelValue"])]),_:1}),n(c,{label:"父级分组"},{default:i(()=>[n($,{value:a(s).pid,"onUpdate:value":t[2]||(t[2]=o=>a(s).pid=o),multiple:!1,flag:a(s).id,clearable:"",placeholder:"请选择父级分组",class:"w-100",labelKey:"name",valueKey:"id",options:a(e).data_list},null,8,["value","flag","options"])]),_:1}),n(c,{label:"分组图标"},{default:i(()=>[n(k,{path:`${a(R).env.INIS_APP_THEME_NAME}/article/group/image/${new Date().toISOString().split("T")[0]}`,accept:[".jpg",".png",".jpeg",".svg",".webp"],value:a(s).avatar,"onUpdate:value":t[3]||(t[3]=o=>a(s).avatar=o)},null,8,["path","accept","value"])]),_:1}),n(c,{label:"分组封面"},{default:i(()=>[n(k,{accept:[".jpg",".png",".jpeg",".svg",".webp"],value:a(s).json.cover,"onUpdate:value":t[4]||(t[4]=o=>a(s).json.cover=o)},null,8,["accept","value"])]),_:1}),n(c,{label:"分组描述"},{default:i(()=>[n(w,{modelValue:a(s).description,"onUpdate:modelValue":t[5]||(t[5]=o=>a(s).description=o),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入分组介绍"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Pe as default};
