import{_ as Y}from"./Table-CEy5VCRK.js";import{V as E,b as V,X as A,Y as z,d as G}from"./element-plus-DEgQ78-a.js";import{_ as M}from"./ImageConfig-C7ysa23g.js";import{_ as B}from"./CommonSelect-BPJDZPOW.js";import{p as D}from"./vueuse-CTCWISgP.js";import{u as N}from"./vue-router-MJGgZ6ro.js";import{b as K}from"./@vueuse-80B0Z04t.js";import{l as P,v as c,n as b}from"./index-CYWUNeU5.js";import{d as W,i as j,m as I,bg as O,ar as X,o as p,M as g,O as i,u as a,W as s,a as u,P as q,c as f,U as y,T as _,S as h}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./InputUpload.vue_vue_type_style_index_0_lang-B-6SKlPI.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const F=["src"],J={key:1},L={key:0,class:"group-list flex-center g-1"},Q={class:"group-span"},Z={key:1},ee={class:"flex-center"},te={class:"dialog-footer"},Be=W({__name:"image",setup(oe){const k=N(),x=j(),{width:C}=K(),w=P(),e=I({page:1,count:0,limit:15,page_count:0,is_screen:!1,show_dialog:!1,group_id:void 0,loading:0,loading_index:-1,select_list:[],data_list:[],only_trashed:!1,album_group:[],current_edit:null}),n={fetchData:async()=>{e.loading=1;const l=await c.all({page:e.page,limit:e.limit,where:e.group_id?`group = ${e.group_id}`:"",onlyTrashed:e.only_trashed});l.code===200?(e.data_list=l.data.data,e.count=l.data.count,e.page_count=l.data.page):e.data_list=[],e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,n.fetchData()},getGroup:l=>{var d;const t=(d=w.albumGroup)==null?void 0:d.find(r=>r.id===l);return t?t.name:"无分组"},handleSelect:l=>{e.select_list=[...l.map(t=>t.id)]},handleAdd:()=>{k.push({name:"admin-album-create"})},handleEdit:l=>{var t,d;e.show_dialog=!0,l.tags_arr=(t=l.result)!=null&&t.tags?(d=l.result)==null?void 0:d.tags.map(r=>r.id):[],e.current_edit=l},handleSave:async()=>{var l;if(e.current_edit){e.current_edit.tags=(l=e.current_edit.tags_arr)!=null&&l.length?`|${e.current_edit.tags_arr.join("|")}|`:"";const t=await c.update(e.current_edit);b(t),t.code===200&&(e.show_dialog=!1)}},handleRestore:async(l,t)=>{t===-1?e.loading=4:e.loading_index=t;const d=await c.restore(l);b(d),e.data_list=e.data_list.filter(r=>!d.data.ids.includes(r.id)),e.loading_index=-1,e.loading=0},handleRemove:async l=>{const t=e.only_trashed?await c.delete(l):await c.remove(l);b(t),t.code===200&&(e.data_list=e.data_list.filter(d=>!t.data.ids.includes(d.id))),n.fetchData()},rowDblclick:l=>{e.select_list.includes(l.id)?e.select_list=e.select_list.filter(t=>t!==l.id):e.select_list.push(l.id),x.value.toggleRowSelection(l)}};return O(()=>{n.fetchData()}),w.getAlbumGroup(),(l,t)=>{const d=B,r=E,m=V,S=A,R=z,$=M,T=G,H=Y,U=X("imgbox");return p(),g(H,{class:"album-data-container",page:a(e).page,"onUpdate:page":t[5]||(t[5]=o=>a(e).page=o),limit:a(e).limit,"onUpdate:limit":t[6]||(t[6]=o=>a(e).limit=o),pageCount:a(e).page_count,"onUpdate:pageCount":t[7]||(t[7]=o=>a(e).page_count=o),isScreen:a(e).is_screen,"onUpdate:isScreen":t[8]||(t[8]=o=>a(e).is_screen=o),loading:a(e).loading,length:a(e).select_list.length,count:a(e).count,onlyTrashed:a(e).only_trashed,onHandleAdd:t[9]||(t[9]=o=>n.handleAdd()),onHandleRestore:t[10]||(t[10]=o=>n.handleRestore(a(e).select_list,-1)),onHandleRemove:t[11]||(t[11]=o=>n.handleRemove(a(e).select_list)),onGetTrash:t[12]||(t[12]=o=>n.getTrash()),onHandleRefresh:t[13]||(t[13]=o=>n.fetchData())},{"top-right":i(()=>[s(d,{value:a(e).group_id,"onUpdate:value":t[0]||(t[0]=o=>a(e).group_id=o),size:"small",multiple:!1,clearable:"",placeholder:"请选择相册",labelKey:"name",valueKey:"id",options:a(w).albumGroup||[],style:{width:"120px"},onHandleChange:t[1]||(t[1]=o=>n.fetchData())},null,8,["value","options"])]),default:i(()=>[s(R,{border:"",ref_key:"tableRef",ref:x,data:a(e).data_list,"empty-text":"",class:"w-100","max-height":a(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:n.handleSelect,onRowDblclick:n.rowDblclick},{default:i(()=>[s(r,{fixed:"",type:"selection",width:"45"}),s(r,{fixed:a(C)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),s(r,{prop:"title",label:"标题",width:"250","show-overflow-tooltip":""}),s(r,{"class-name":"cover-item ",prop:"cover",label:"图片",align:"center",width:"80"},{default:i(o=>[u("div",null,[o.row.image?q((p(),f("img",{key:0,src:o.row.image,class:"logo br"},null,8,F)),[[U]]):(p(),f("span",J,"-"))])]),_:1}),s(r,{"class-name":"group-item",width:"150",label:"归属相册","show-overflow-tooltip":"",align:"center"},{default:i(o=>[o.row.group?(p(),f("div",L,[u("span",Q,y(n.getGroup(o.row.group)),1)])):(p(),f("span",Z,"-"))]),_:1}),s(r,{prop:"content","min-width":"250",label:"描述","show-overflow-tooltip":"",formatter:o=>o.content||"-"},null,8,["formatter"]),s(r,{prop:"update_time",sortable:"",label:"更新时间",width:"160"},{default:i(o=>[u("span",null,y(a(D)(o.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),s(r,{prop:"create_time",sortable:"",width:"160",label:"创建时间"},{default:i(o=>[u("span",null,y(a(D)(o.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),s(r,{fixed:a(C)<768?!1:"right",align:"center",label:"操作","class-name":"center",width:190},{default:i(o=>[u("div",ee,[a(e).only_trashed?h("",!0):(p(),g(m,{key:0,size:"small",type:"success",plain:"",onClick:v=>a(k).push({name:"admin-album-image-detail",params:{id:o.row.id}})},{default:i(()=>[_(" 详情 ")]),_:2},1032,["onClick"])),a(e).only_trashed?h("",!0):(p(),g(m,{key:1,size:"small",type:"primary",plain:"",onClick:v=>n.handleEdit(o.row)},{default:i(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),a(e).only_trashed?(p(),g(m,{key:2,onClick:v=>n.handleRestore([o.row.id],o.$index),size:"small",loading:a(e).loading_index===o.$index,type:"success",plain:""},{default:i(()=>[_(" 恢复 ")]),_:2},1032,["onClick","loading"])):h("",!0),s(S,{onConfirm:v=>n.handleRemove([o.row.id]),width:"180",title:a(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:i(()=>[s(m,{size:"small",type:"danger",plain:""},{default:i(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"]),a(e).current_edit?(p(),g(T,{key:0,draggable:"",modelValue:a(e).show_dialog,"onUpdate:modelValue":t[4]||(t[4]=o=>a(e).show_dialog=o),width:"95%",title:"编辑照片"},{footer:i(()=>[u("span",te,[s(m,{onClick:t[3]||(t[3]=o=>a(e).show_dialog=!1)},{default:i(()=>[_("取消")]),_:1}),s(m,{loading:a(e).loading===2,type:"primary",onClick:n.handleSave},{default:i(()=>[_(" 确认 ")]),_:1},8,["loading","onClick"])])]),default:i(()=>[s($,{form:a(e).current_edit,"onUpdate:form":t[2]||(t[2]=o=>a(e).current_edit=o),showUpload:""},null,8,["form"])]),_:1},8,["modelValue"])):h("",!0)]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Be as default};
