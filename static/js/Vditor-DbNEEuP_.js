import{g as I,b as V,Z as q,E as C,D as E}from"./element-plus-DEgQ78-a.js";import{_ as D,d as M,l as _,B as P,n as x,m as A}from"./index-CYWUNeU5.js";import{d as T,o as b,M as $,O as S,W,S as Y,bf as F,i as v,bF as R,w as U,l as z,m as H,b as L,E as O,c as Z}from"./@vue-AVcRlItG.js";import{V as G}from"./vditor-CyQdJvZo.js";import{b as N,u as B}from"./@vueuse-80B0Z04t.js";import{p as J}from"./vueuse-CTCWISgP.js";const K=T({__name:"SaveBtn",props:{loading:{type:Boolean}},emits:["handleClick"],setup(a,{emit:s}){const m=s;return(e,i)=>{const o=D,l=V,d=I;return b(),$(d,{content:"提交保存",placement:"top"},{default:S(()=>[W(l,{type:"primary",class:"save-fixed-btn flex-center",loading:e.loading,round:"",onClick:i[0]||(i[0]=p=>m("handleClick"))},{default:S(()=>[e.loading?Y("",!0):(b(),$(o,{key:0,name:"save-3-line",size:"22",style:{"margin-left":"0"}}))]),_:1},8,["loading"])]),_:1})}}}),mn=M(K,[["__scopeId","data-v-b897a7dd"]]),{width:Q}=N(),X=Q.value>768?[{name:"undo",icon:'<i class="iconfont iconfont-arrow-go-back-fill" ></i>'},{name:"redo",icon:'<i class="iconfont iconfont-arrow-go-forward-fill" ></i>'},"|",{name:"headings",icon:'<i class="iconfont iconfont-heading " ></i>'},{name:"bold",icon:'<i class="iconfont iconfont-bold " ></i>'},{name:"italic",icon:'<i class="iconfont iconfont-italic" ></i>'},{name:"strike",icon:'<i class="iconfont iconfont-strikethrough" ></i>'},{name:"emoji",icon:'<i class="iconfont iconfont-emotion-happy-line" ></i>'},"|",{name:"line",icon:'<i class="iconfont iconfont-subtract-line" ></i>'},{name:"quote",icon:'<i class="iconfont iconfont-double-quotes-l" ></i>'},{name:"list",icon:'<i class="iconfont iconfont-list-unordered" ></i>'},{name:"ordered-list",icon:'<i class="iconfont iconfont-list-ordered" ></i>'},{name:"check",icon:'<i class="iconfont iconfont-checkbox-line" ></i>'},{name:"outdent",icon:'<i class="iconfont iconfont-indent-decrease" ></i>'},{name:"indent",icon:'<i class="iconfont iconfont-indent-increase" ></i>'},"|",{name:"code",icon:'<i class="iconfont iconfont-code-s-slash-fill" ></i>'},{name:"inline-code",icon:'<i class="iconfont iconfont-code-s-fill" ></i>'},{name:"insert-after",icon:'<i class="iconfont iconfont-arrow-down-line" ></i>'},{name:"insert-before",icon:'<i class="iconfont iconfont-arrow-up-line" ></i>'},{name:"table",icon:'<i class="iconfont iconfont-table-2" ></i>'},"|",{name:"upload",icon:'<i class="iconfont iconfont-upload-cloud-line" ></i>'},{name:"link",icon:'<i class="iconfont iconfont-link" ></i>'},{name:"edit-mode",tip:"编辑模式",icon:'<i class="iconfont iconfont-edit-box-line" ></i>'},{name:"preview",icon:'<i class="iconfont iconfont-eye-line" ></i>'},"both"]:[{name:"headings",icon:'<i class="iconfont iconfont-heading " ></i>'},{name:"bold",icon:'<i class="iconfont iconfont-bold " ></i>'},{name:"upload",icon:'<i class="iconfont iconfont-upload-cloud-line" ></i>'},{name:"fullscreen",icon:'<i class="iconfont iconfont-fullscreen-fill" ></i>'},{name:"more",toolbar:[{name:"emoji",icon:'<i class="iconfont iconfont-emotion-happy-line" ></i>'},{name:"italic",icon:'<i class="iconfont iconfont-italic" ></i>'},{name:"line",icon:'<i class="iconfont iconfont-subtract-line" ></i>'},{name:"quote",icon:'<i class="iconfont iconfont-double-quotes-l" ></i>'},{name:"list",icon:'<i class="iconfont iconfont-list-unordered" ></i>'},{name:"ordered-list",icon:'<i class="iconfont iconfont-list-ordered" ></i>'},{name:"check",icon:'<i class="iconfont iconfont-checkbox-line" ></i>'},{name:"outdent",icon:'<i class="iconfont iconfont-indent-decrease" ></i>'},{name:"indent",icon:'<i class="iconfont iconfont-indent-increase" ></i>'},{name:"insert-after",icon:'<i class="iconfont iconfont-arrow-down-line" ></i>'},{name:"insert-before",icon:'<i class="iconfont iconfont-arrow-up-line" ></i>'},{name:"link",icon:'<i class="iconfont iconfont-link" ></i>'},{name:"table",icon:'<i class="iconfont iconfont-table-2" ></i>'},{name:"code",icon:'<i class="iconfont iconfont-code-s-slash-fill" ></i>'},{name:"inline-code",icon:'<i class="iconfont iconfont-code-s-fill" ></i>'},{name:"preview",icon:'<i class="iconfont iconfont-eye-line" ></i>'}]}],nn=B(),on=async(a,s,m,e)=>{if(!a.length)return;let i;const o=q.service({lock:!0,fullscreen:!1,target:m,text:"开始上传...",background:nn.value?"rgba(0, 0, 0, 0.7)":"rgba(255, 255, 255, 0.7)"}),l=t=>{const g=t.progress?`${(t.progress*100).toString().substring(0,5)}%`:"0%";o.setText(g),t.progress===1&&o.setText("上传完成，正在处理中，请稍后...")};if(a[0].type.startsWith("image"))i="image";else if(a[0].type.startsWith("video"))i="video";else{C.warning("暂不支持上传该类型文件");return}_().env.INIS_APP_THEME_NAME;const u=a[0].name.match(/[^.]+(?=\.[^.]*$)|[^.]+$/g),h=u?u[0]:a[0].name;J(new Date().getTime(),"YYYY-MM-DD"),e=i==="image"?`${e||""}image`:i==="video"?`${e||""}video`:e;const n=await P.upload(a[0],e,void 0,l);o.close(),x(n),n.code===200?i==="image"?s.insertValue(`![${h}](${n.data.path})`):i==="video"&&s.insertValue(`<video playsinline controls><source src="${n.data.path}" type="video/mp4" /></video>`):x(n)},en=a=>{const s=_();let m=/:(\w+):/g;return a.replace(m,(i,o)=>s.emojiMap[o]?`<img alt="${o}" class="emoji" src="${s.emojiMap[o]}" title="${o}">`:i)},tn=T({__name:"Vditor",props:F({path:{}},{content:{},contentModifiers:{}}),emits:["update:content"],setup(a){const s=a,{width:m}=N(),e=_(),i=B(),o=v(null),l=v(!1),d=v(),p=R(a,"content");U(i,n=>{var t;(t=o.value)==null||t.setTheme(n?"dark":"classic",n?"dark":"light")}),z(()=>{var n,t;l.value&&o.value&&p.value&&(l.value=!1,(t=o.value)==null||t.setValue((n=o.value)==null?void 0:n.html2md(A(p.value)||""),!0),o.value.focus())});const u=H({emoji:{}}),h={getEmoji:async()=>{var n,t,g,k,w,y,j;await e.getEmoji(),(n=e.emoji)!=null&&n.qq&&((g=(t=e.emoji)==null?void 0:t.qq)==null||g.forEach(r=>{var f;let c=(f=r.split("/").pop())==null?void 0:f.split(".");c&&c.length>1&&(u.emoji[c[0]]=r)}),(w=(k=e.emoji)==null?void 0:k.tiktok)==null||w.forEach(r=>{var f;let c=(f=r.split("/").pop())==null?void 0:f.split(".");c&&c.length>1&&(u.emoji[c[0]]=r)}),(j=(y=e.emoji)==null?void 0:y.bilibili)==null||j.forEach(r=>{var f;let c=(f=r.split("/").pop())==null?void 0:f.split(".");c&&c.length>1&&(u.emoji[c[0]]=r)}))}};return L(async()=>{await h.getEmoji(),d.value&&(o.value=new G(d.value,{value:p.value,mode:"wysiwyg",tab:"	",placeholder:"说些什么吧...",toolbar:X,toolbarConfig:{pin:!0},height:m.value>768?"calc(100vh - 250px)":"calc(100vh - 350px)",hint:{emoji:u.emoji,extend:[{key:"inis",hint(n){return E({title:"INIS祝你",message:"生活愉快，万事胜意！！！",type:"success"}),[]}},{key:"相左",hint(){return E({title:"相左祝你",message:"好运天天有，事业步步高！！！",type:"success"}),[]}}]},cdn:`${e.env.INIS_APP_BASE_URL}static/plugin/vditor`,counter:{enable:!0,type:"markdown"},cache:{enable:!1},theme:i?"dark":"classic",preview:{hljs:{enable:!0,lineNumber:!0},delay:300},upload:{accept:"image/*,video/*",multiple:!1,handler:n=>(on(n,o.value,d.value,s.path),null)},input:n=>{l.value=!1,p.value=en(n)},after:()=>{var n;l.value=!0,(n=o.value)==null||n.setTheme(i.value?"dark":"classic",i.value?"dark":"light","monokai")}}))}),O(()=>{o.value&&o.value.destroy()}),(n,t)=>(b(),Z("div",{ref_key:"vditorRef",ref:d},null,512))}}),dn=M(tn,[["__scopeId","data-v-a62ebad5"]]);export{mn as _,dn as a};
