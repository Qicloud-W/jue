import{_ as It}from"./CommentList-CLxjsben.js";import{_ as Lt}from"./CommentInput-CLsnyAEF.js";import{u as Ie,j as re,n as ve,_ as ye,c as be,d as oe,f as vt,g as qt,m as gt,k as Tt,C as At,l as Qt,e as Et}from"./index-CYWUNeU5.js";import{f as Le,J as yt,j as bt,E as me,g as Dt,e as we,K as Mt,c as Ht,k as Rt}from"./element-plus-DEgQ78-a.js";import{u as qe,a as Ot}from"./vue-router-MJGgZ6ro.js";import{d as ae,o as g,c as T,a as l,W as d,U as O,u as s,O as L,M as F,S as D,Q as ie,bn as ne,bl as ce,bf as wt,bF as kt,V as ge,m as $t,af as St,al as ke,aa as xe,k as xt,i as he,w as mt,ar as le,P as fe,T as ze,bg as Bt,a7 as Se,j as _t,X as Yt,a0 as Nt}from"./@vue-AVcRlItG.js";import{b as Te,a as jt,g as Vt,c as ft}from"./@vueuse-80B0Z04t.js";import{_ as Wt}from"./Image-CtzcM27r.js";import{_ as Ft}from"./write-uZ-K_WP_.js";import{p as Ce}from"./vueuse-CTCWISgP.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./clipboard-CJr-i2j9.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./dayjs-D7ajE0Qg.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";const Ae=y=>(ne("data-v-e0b243c6"),y=y(),ce(),y),Pt={key:0,class:"article-tool-bar-wrap card-bg z-2 shadow flex-yc flex-sb"},Ut={class:"fs-16"},Jt={class:"flex-yc g-5 pr-1"},Kt=Ae(()=>l("span",null,"腾讯QQ",-1)),Xt=Ae(()=>l("span",null,"QQ空间",-1)),Gt=Ae(()=>l("span",null,"新浪微博",-1)),Zt={class:"operate-item curp br-50 card-bg flex-center theme-hover"},es=ae({__name:"MobileOperate",props:{article:{}},setup(y){const p=qe(),$=Ie(),r=y,v={handleThumb:async()=>{var e,a,o,c,h,_,t,m,n,u,f,b,S,x,C,w,I,k,A,E,M,H;if(!$.hasLogin)return me.warning("请先登录");if(!r.article)return;const i=await re.like({bind_id:r.article.id,bind_type:"article",state:(c=(a=(e=r.article)==null?void 0:e.result)==null?void 0:a.like)!=null&&c.includes(((o=$.user)==null?void 0:o.id)||0)?0:1});if(ve(i),i.code===200&&((_=(h=r.article)==null?void 0:h.result)!=null&&_.like))if((u=(m=(t=r.article)==null?void 0:t.result)==null?void 0:m.like)!=null&&u.includes(((n=$.user)==null?void 0:n.id)||0)){const R=(x=(b=(f=r.article)==null?void 0:f.result)==null?void 0:b.like)==null?void 0:x.indexOf(((S=$.user)==null?void 0:S.id)||0);R>=0&&((I=(w=(C=r.article)==null?void 0:C.result)==null?void 0:w.like)==null||I.splice(R,1))}else(k=$.user)!=null&&k.id&&((H=(E=(A=r.article)==null?void 0:A.result)==null?void 0:E.like)==null||H.push((M=$.user)==null?void 0:M.id))},handleCollect:async()=>{var e,a,o,c,h,_,t,m,n,u,f,b,S,x,C,w,I,k,A,E,M,H;if(!$.hasLogin)return me.warning("请先登录");if(!r.article)return;const i=await re.collect({bind_id:r.article.id,bind_type:"article",state:(c=(a=(e=r.article)==null?void 0:e.result)==null?void 0:a.collect)!=null&&c.includes(((o=$.user)==null?void 0:o.id)||0)?0:1});if(ve(i),i.code===200&&((_=(h=r.article)==null?void 0:h.result)!=null&&_.collect))if((u=(m=(t=r.article)==null?void 0:t.result)==null?void 0:m.collect)!=null&&u.includes(((n=$.user)==null?void 0:n.id)||0)){const R=(x=(b=(f=r.article)==null?void 0:f.result)==null?void 0:b.collect)==null?void 0:x.indexOf(((S=$.user)==null?void 0:S.id)||0);R>=0&&((I=(w=(C=r.article)==null?void 0:C.result)==null?void 0:w.collect)==null||I.splice(R,1))}else(k=$.user)!=null&&k.id&&((H=(E=(A=r.article)==null?void 0:A.result)==null?void 0:E.collect)==null||H.push((M=$.user)==null?void 0:M.id))},handleShare:async()=>{var e,a,o,c,h,_,t,m,n,u,f;if(!$.hasLogin||!r.article||(c=(a=(e=r.article)==null?void 0:e.result)==null?void 0:a.share)!=null&&c.includes(((o=$.user)==null?void 0:o.id)||0))return;(await re.share({bind_id:r.article.id,bind_type:"article"})).code===200&&((_=(h=r.article)==null?void 0:h.result)!=null&&_.share)&&(t=$.user)!=null&&t.id&&((f=(n=(m=r.article)==null?void 0:m.result)==null?void 0:n.share)==null||f.push((u=$.user)==null?void 0:u.id))},shareQQ:()=>{var i,e,a;v.handleShare(),window.open(`https://connect.qq.com/widget/shareqq/index.html?url=${window.location.href}&title=${(i=r.article)==null?void 0:i.title}&pics=${(e=r.article)==null?void 0:e.covers.split(",")[0]}&summary=${(a=r.article)==null?void 0:a.abstract}`)},shareQzone:()=>{var i,e,a;v.handleShare(),window.open(`https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=${window.location.href}&title=${(i=r.article)==null?void 0:i.title}&pics=${(e=r.article)==null?void 0:e.covers.split(",")[0]}&summary=${(a=r.article)==null?void 0:a.abstract}`)},shareWeibo:()=>{var i,e;v.handleShare(),window.open(`https://service.weibo.com/share/share.php?url=${window.location.href}&title=${(i=r.article)==null?void 0:i.abstract}&pic=${(e=r.article)==null?void 0:e.covers.split(",")[0]}`)},handleScroll:()=>{const i=document.querySelector("#comment-list-wrapper");i&&i.scrollIntoView({behavior:"smooth"})}};return(i,e)=>{var t,m,n,u,f,b,S,x,C,w,I,k,A,E,M,H,R,V,G,Z,U,J,q,B,Y;const a=Le,o=ye,c=yt,h=be,_=bt;return i.article?(g(),T("div",Pt,[l("div",{class:"flex-yc g-2 theme-hover curp",onClick:e[0]||(e[0]=z=>{var Q;return s(p).push({name:"front-user-detail",params:{id:(Q=i.article)==null?void 0:Q.uid}})})},[d(a,{src:(m=(t=i.article.result)==null?void 0:t.author)==null?void 0:m.avatar,size:22},null,8,["src"]),l("span",Ut,O(((u=(n=i.article.result)==null?void 0:n.author)==null?void 0:u.nickname)||"未知用户"),1)]),l("div",Jt,[d(c,{value:((S=(b=(f=i.article)==null?void 0:f.result)==null?void 0:b.like)==null?void 0:S.length)||0,hidden:!i.article||!((w=(C=(x=i.article)==null?void 0:x.result)==null?void 0:C.like)!=null&&w.length),type:"info"},{default:L(()=>{var z,Q,N,j;return[l("div",{class:"operate-item trf curp br-50 card-bg flex-center theme-hover",onClick:e[1]||(e[1]=(...W)=>v.handleThumb&&v.handleThumb(...W))},[d(o,{class:ie({"theme-color":(j=(Q=(z=i.article)==null?void 0:z.result)==null?void 0:Q.like)==null?void 0:j.includes(((N=s($).user)==null?void 0:N.id)||0)}),name:"thumb-up-fill",size:"22"},null,8,["class"])])]}),_:1},8,["value","hidden"]),d(c,{value:((A=(k=(I=i.article)==null?void 0:I.result)==null?void 0:k.collect)==null?void 0:A.length)||0,hidden:!i.article||!((H=(M=(E=i.article)==null?void 0:E.result)==null?void 0:M.collect)!=null&&H.length),type:"info"},{default:L(()=>{var z,Q,N,j;return[l("div",{class:ie([{"theme-color":(j=(Q=(z=i.article)==null?void 0:z.result)==null?void 0:Q.collect)==null?void 0:j.includes(((N=s($).user)==null?void 0:N.id)||0)},"operate-item trf curp br-50 card-bg flex-center theme-hover"]),onClick:e[2]||(e[2]=(...W)=>v.handleCollect&&v.handleCollect(...W))},[d(o,{name:"star-fill",size:"24"})],2)]}),_:1},8,["value","hidden"]),d(_,{placement:"right-start",width:40,trigger:"hover",teleported:!1},{reference:L(()=>{var z,Q,N,j,W,K;return[d(c,{value:((N=(Q=(z=i.article)==null?void 0:z.result)==null?void 0:Q.share)==null?void 0:N.length)||0,hidden:!i.article||!((K=(W=(j=i.article)==null?void 0:j.result)==null?void 0:W.share)!=null&&K.length),type:"info"},{default:L(()=>{var X,de,ue,pe;return[l("div",Zt,[d(o,{class:ie({"theme-color":(pe=(de=(X=i.article)==null?void 0:X.result)==null?void 0:de.share)==null?void 0:pe.includes(((ue=s($).user)==null?void 0:ue.id)||0)}),name:"share-forward-fill",size:"28"},null,8,["class"])])]}),_:1},8,["value","hidden"])]}),default:L(()=>[l("div",{class:"flex-yc g-2 share-item trf mt-1 curp theme-hover",onClick:e[3]||(e[3]=(...z)=>v.shareQQ&&v.shareQQ(...z))},[d(h,{name:"qq-1",size:"20"}),Kt]),l("div",{class:"flex-yc g-2 my5 share-item curp theme-hover",onClick:e[4]||(e[4]=(...z)=>v.shareQzone&&v.shareQzone(...z))},[d(h,{name:"qzone",size:"20"}),Xt]),l("div",{class:"flex-yc g-2 mt5 mb-1 share-item curp theme-hover",onClick:e[5]||(e[5]=(...z)=>v.shareWeibo&&v.shareWeibo(...z))},[d(h,{name:"weibo",size:"20"}),Gt])]),_:1}),((G=(V=(R=i.article)==null?void 0:R.json)==null?void 0:V.comment)==null?void 0:G.allow)===1?(g(),F(c,{key:0,value:((J=(U=(Z=i.article)==null?void 0:Z.result)==null?void 0:U.comment)==null?void 0:J.count)||0,hidden:!((Y=(B=(q=i.article)==null?void 0:q.result)==null?void 0:B.comment)!=null&&Y.count),type:"info"},{default:L(()=>[l("div",{onClick:e[6]||(e[6]=(...z)=>v.handleScroll&&v.handleScroll(...z)),class:"operate-item trf curp br-50 card-bg flex-center theme-hover"},[d(o,{name:"message-3-fill",size:"22"})])]),_:1},8,["value","hidden"])):D("",!0)])])):D("",!0)}}}),ts=oe(es,[["__scopeId","data-v-e0b243c6"]]),Qe=y=>(ne("data-v-8b8f4c06"),y=y(),ce(),y),ss={key:0,class:"article-side-operate-wrapper light-text flex-shrink-0 z-2"},ls=Qe(()=>l("span",null,"腾讯QQ",-1)),rs=Qe(()=>l("span",null,"QQ空间",-1)),is=Qe(()=>l("span",null,"新浪微博",-1)),os={class:"operate-item curp br-50 card-bg flex-center theme-hover"},as=ae({__name:"ArticleSideOperate",props:wt({article:{}},{clear:{type:Boolean},clearModifiers:{}}),emits:["update:clear"],setup(y){const p=y,{width:$}=Te(),r=Ie(),v=kt(y,"clear");v.value=!1;const i={handleThumb:async()=>{var a,o,c,h,_,t,m,n,u,f,b,S,x,C,w,I,k,A,E,M,H,R;if(!r.hasLogin)return me.warning("请先登录");if(!p.article)return;const e=await re.like({bind_id:p.article.id,bind_type:"article",state:(h=(o=(a=p.article)==null?void 0:a.result)==null?void 0:o.like)!=null&&h.includes(((c=r.user)==null?void 0:c.id)||0)?0:1});if(ve(e),e.code===200&&((t=(_=p.article)==null?void 0:_.result)!=null&&t.like))if((f=(n=(m=p.article)==null?void 0:m.result)==null?void 0:n.like)!=null&&f.includes(((u=r.user)==null?void 0:u.id)||0)){const V=(C=(S=(b=p.article)==null?void 0:b.result)==null?void 0:S.like)==null?void 0:C.indexOf(((x=r.user)==null?void 0:x.id)||0);V>=0&&((k=(I=(w=p.article)==null?void 0:w.result)==null?void 0:I.like)==null||k.splice(V,1))}else(A=r.user)!=null&&A.id&&((R=(M=(E=p.article)==null?void 0:E.result)==null?void 0:M.like)==null||R.push((H=r.user)==null?void 0:H.id))},handleCollect:async()=>{var a,o,c,h,_,t,m,n,u,f,b,S,x,C,w,I,k,A,E,M,H,R;if(!r.hasLogin)return me.warning("请先登录");if(!p.article)return;const e=await re.collect({bind_id:p.article.id,bind_type:"article",state:(h=(o=(a=p.article)==null?void 0:a.result)==null?void 0:o.collect)!=null&&h.includes(((c=r.user)==null?void 0:c.id)||0)?0:1});if(ve(e),e.code===200&&((t=(_=p.article)==null?void 0:_.result)!=null&&t.collect))if((f=(n=(m=p.article)==null?void 0:m.result)==null?void 0:n.collect)!=null&&f.includes(((u=r.user)==null?void 0:u.id)||0)){const V=(C=(S=(b=p.article)==null?void 0:b.result)==null?void 0:S.collect)==null?void 0:C.indexOf(((x=r.user)==null?void 0:x.id)||0);V>=0&&((k=(I=(w=p.article)==null?void 0:w.result)==null?void 0:I.collect)==null||k.splice(V,1))}else(A=r.user)!=null&&A.id&&((R=(M=(E=p.article)==null?void 0:E.result)==null?void 0:M.collect)==null||R.push((H=r.user)==null?void 0:H.id))},handleShare:async()=>{var a,o,c,h,_,t,m,n,u,f,b;if(!r.hasLogin||!p.article||(h=(o=(a=p.article)==null?void 0:a.result)==null?void 0:o.share)!=null&&h.includes(((c=r.user)==null?void 0:c.id)||0))return;(await re.share({bind_id:p.article.id,bind_type:"article"})).code===200&&((t=(_=p.article)==null?void 0:_.result)!=null&&t.share)&&(m=r.user)!=null&&m.id&&((b=(u=(n=p.article)==null?void 0:n.result)==null?void 0:u.share)==null||b.push((f=r.user)==null?void 0:f.id))},shareQQ:()=>{var e,a,o;i.handleShare(),window.open(`https://connect.qq.com/widget/shareqq/index.html?url=${window.location.href}&title=${(e=p.article)==null?void 0:e.title}&pics=${(a=p.article)==null?void 0:a.covers.split(",")[0]}&summary=${(o=p.article)==null?void 0:o.abstract}`)},shareQzone:()=>{var e,a,o;i.handleShare(),window.open(`https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=${window.location.href}&title=${(e=p.article)==null?void 0:e.title}&pics=${(a=p.article)==null?void 0:a.covers.split(",")[0]}&summary=${(o=p.article)==null?void 0:o.abstract}`)},shareWeibo:()=>{var e,a;i.handleShare(),window.open(`https://service.weibo.com/share/share.php?url=${window.location.href}&title=${(e=p.article)==null?void 0:e.abstract}&pic=${(a=p.article)==null?void 0:a.covers.split(",")[0]}`)},handleScroll:()=>{const e=document.querySelector("#comment-list-wrapper");e&&e.scrollIntoView({behavior:"smooth"})}};return(e,a)=>{var m,n,u,f,b,S,x,C,w,I,k,A,E,M,H,R,V,G,Z,U,J;const o=ye,c=yt,h=be,_=bt,t=Dt;return s($)>768?(g(),T("div",ss,[v.value?D("",!0):(g(),T(ge,{key:0},[d(c,{class:"mb-3",value:((u=(n=(m=e.article)==null?void 0:m.result)==null?void 0:n.like)==null?void 0:u.length)||0,hidden:!e.article||!((S=(b=(f=e.article)==null?void 0:f.result)==null?void 0:b.like)!=null&&S.length),type:"info"},{default:L(()=>{var q,B,Y,z;return[l("div",{class:"operate-item trf curp br-50 card-bg flex-center theme-hover",onClick:a[0]||(a[0]=(...Q)=>i.handleThumb&&i.handleThumb(...Q))},[d(o,{class:ie({"theme-color":(z=(B=(q=e.article)==null?void 0:q.result)==null?void 0:B.like)==null?void 0:z.includes(((Y=s(r).user)==null?void 0:Y.id)||0)}),name:"thumb-up-fill",size:"22"},null,8,["class"])])]}),_:1},8,["value","hidden"]),d(c,{class:"mb-3",value:((w=(C=(x=e.article)==null?void 0:x.result)==null?void 0:C.collect)==null?void 0:w.length)||0,hidden:!e.article||!((A=(k=(I=e.article)==null?void 0:I.result)==null?void 0:k.collect)!=null&&A.length),type:"info"},{default:L(()=>{var q,B,Y,z;return[l("div",{class:ie([{"theme-color":(z=(B=(q=e.article)==null?void 0:q.result)==null?void 0:B.collect)==null?void 0:z.includes(((Y=s(r).user)==null?void 0:Y.id)||0)},"operate-item trf curp br-50 card-bg flex-center theme-hover"]),onClick:a[1]||(a[1]=(...Q)=>i.handleCollect&&i.handleCollect(...Q))},[d(o,{name:"star-fill",size:"22"})],2)]}),_:1},8,["value","hidden"]),d(_,{placement:"right-start",width:40,trigger:"hover",teleported:!1},{reference:L(()=>{var q,B,Y,z,Q,N;return[d(c,{class:"mb-3",value:((Y=(B=(q=e.article)==null?void 0:q.result)==null?void 0:B.share)==null?void 0:Y.length)||0,hidden:!e.article||!((N=(Q=(z=e.article)==null?void 0:z.result)==null?void 0:Q.share)!=null&&N.length),type:"info"},{default:L(()=>{var j,W,K,X;return[l("div",os,[d(o,{class:ie({"theme-color":(X=(W=(j=e.article)==null?void 0:j.result)==null?void 0:W.share)==null?void 0:X.includes(((K=s(r).user)==null?void 0:K.id)||0)}),name:"share-forward-fill",size:"24"},null,8,["class"])])]}),_:1},8,["value","hidden"])]}),default:L(()=>[l("div",{class:"flex-yc g-2 share-item trf mt-1 curp theme-hover",onClick:a[2]||(a[2]=(...q)=>i.shareQQ&&i.shareQQ(...q))},[d(h,{name:"qq-1",size:"20"}),ls]),l("div",{class:"flex-yc g-2 my5 share-item curp theme-hover",onClick:a[3]||(a[3]=(...q)=>i.shareQzone&&i.shareQzone(...q))},[d(h,{name:"qzone",size:"20"}),rs]),l("div",{class:"flex-yc g-2 mt5 mb-1 share-item curp theme-hover",onClick:a[4]||(a[4]=(...q)=>i.shareWeibo&&i.shareWeibo(...q))},[d(h,{name:"weibo",size:"20"}),is])]),_:1}),((H=(M=(E=e.article)==null?void 0:E.json)==null?void 0:M.comment)==null?void 0:H.allow)===1?(g(),F(c,{key:0,class:"mb-3",value:((G=(V=(R=e.article)==null?void 0:R.result)==null?void 0:V.comment)==null?void 0:G.count)||0,hidden:!((J=(U=(Z=e.article)==null?void 0:Z.result)==null?void 0:U.comment)!=null&&J.count),type:"info"},{default:L(()=>[l("div",{onClick:a[5]||(a[5]=(...q)=>i.handleScroll&&i.handleScroll(...q)),class:"operate-item trf curp br-50 card-bg flex-center theme-hover"},[d(o,{name:"message-3-fill",size:"22"})])]),_:1},8,["value","hidden"])):D("",!0)],64)),d(t,{effect:"dark",content:v.value?"退出沉浸模式":"沉浸阅读",placement:"top"},{default:L(()=>[l("div",{class:"operate-item trf curp br-50 card-bg flex-center theme-hover",onClick:a[6]||(a[6]=q=>v.value=!v.value)},[d(o,{name:"fullscreen-fill",size:"22"})])]),_:1},8,["content"])])):D("",!0)}}}),ns=oe(as,[["__scopeId","data-v-8b8f4c06"]]),zt=y=>(ne("data-v-da62e11f"),y=y(),ce(),y),cs={class:"hot-article-list-wrapper card-bg br-5 px-1 py-1"},ds={class:"flex-yc g-1 mt5"},us=zt(()=>l("span",{class:"title-color fw-600"},"猜你喜欢",-1)),ps=zt(()=>l("div",{class:"split-line my-1"},null,-1)),hs={class:"article-list-wrap"},ms={key:3,class:"order-num text-color fs-12 br-50 center flex-center flex-shrink-0"},_s={class:"h-1x"},fs=ae({__name:"ArticleRand",setup(y){const p=$t({data:null});return{fetchData:async()=>{const{code:r,data:v}=await vt.rand({field:"id,title,views,result,json",limit:5,order:"views desc",where:"audit = 1"});r===200&&(p.data=qt(v))}}.fetchData(),(r,v)=>{const i=be,e=we,a=St("RouterLink");return g(),T("div",cs,[l("div",ds,[d(i,{name:"like",size:"24"}),us]),ps,d(e,{animated:"",loading:s(p).data===null},ke({template:L(()=>[d(e,{rows:3})]),_:2},[s(p).data?{name:"default",fn:L(()=>[l("ul",hs,[(g(!0),T(ge,null,xe(s(p).data,(o,c)=>(g(),T("li",{key:c},[d(a,{to:{name:"front-article-detail",params:{id:o.id}},class:"text-color fs-15 flex-yc g-1 mt-1 theme-hover"},{default:L(()=>[c===0?(g(),F(i,{key:0,name:"first",size:"16"})):c===1?(g(),F(i,{key:1,name:"second",size:"16"})):c===2?(g(),F(i,{key:2,name:"third",size:"16"})):(g(),T("span",ms,O(c+1),1)),l("span",_s,O(o.title),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1032,["loading"])])}}}),vs=oe(fs,[["__scopeId","data-v-da62e11f"]]),Ct=y=>(ne("data-v-e35d25f4"),y=y(),ce(),y),gs={key:0,class:"active-user-list-wrapper mb-2 card-bg br-5 px-1 py-1"},ys={class:"flex-yc g-2 mt5"},bs=Ct(()=>l("span",{class:"title-color fw-600"},"文章目录",-1)),ws=Ct(()=>l("div",{class:"split-line my-1"},null,-1)),ks={class:"p-2"},$s=ae({__name:"ArticleTocTree",props:wt({html:{},clear:{type:Boolean}},{hList:{},hListModifiers:{}}),emits:["update:hList"],setup(y){const p=y,$=xt(()=>p.clear?1e3:300),r=he(),v=he([]),{y:i}=jt(window),e=kt(y,"hList"),a={initData:()=>{if(p.html){const o=gt(p.html);v.value=a.getContentDirTree(o)}},handleHighlight:Vt(()=>{const o=document.querySelectorAll(".article-content h1,.article-content h3,.article-content h2");if(o&&o.length){for(let c=0;c<o.length;c++)if(o[c].getBoundingClientRect().top>0){if(c===0){r.value=o[c].id;break}o[c].getBoundingClientRect().top<100?r.value=o[c].id:r.value=o[c-1].id;break}}},100),getContentDirTree:o=>{if(!o)return[];const c=o.match(/<h[1-3]{1}[^>]*>([\s\S]*?)<\/h[1-3]{1}>/g);if(!Array.isArray(c))return[];const h=[];let _;return c.forEach((t,m)=>{const n=t.indexOf('id="'),u=t.indexOf('">');if(n!=-1&&u!=-1){const f=t.slice(n+4,u),b=/<h([1-6]{1})[^>]*>([\s\S]*?)<\/h[1-6]{1}>/,S=Number(t.replace(b,"$1")),C=t.replace(b,"$2").replace(/<([\s\S]*?)>|<\/([\s\S]*?)>/g,"");e.value=e.value||[],e.value.push(f);const w={id:m+1,title:C,domId:f,hLevel:S,pid:0};_&&(w.hLevel>_.hLevel?w.pid=_.id:w.hLevel<_.hLevel?w.pid=0:w.pid=_.pid),_=w,h.push(w)}}),h.forEach(t=>{if(t.pid!==0){const m=h.find(n=>n.id===t.pid);m&&(Array.isArray(m.children)||(m.children=[]),m.children.push(t))}}),h.filter(t=>t.pid===0)},handleNodeClick:o=>{var c;(c=document.querySelector("#"+o.domId))==null||c.scrollIntoView({behavior:"smooth"})}};return mt(i,()=>{a.handleHighlight()},{immediate:!0}),mt(r,()=>{const o=document.querySelector(".toc-scroller-wrap .el-scrollbar__wrap");if(document.querySelector(".toc-scroller-wrap .is-current")&&o&&r.value){e.value=e.value||[];const h=e.value.indexOf(r.value);o.scrollTop=(h+1)*30-$.value/2}}),a.initData(),(o,c)=>{const h=be,_=we,t=Mt,m=Ht;return s(v).length?(g(),T("div",gs,[l("div",ys,[d(h,{name:"toc",size:"16"}),bs]),ws,d(_,{animated:"",throttle:200,count:5,loading:o.html===null},ke({template:L(()=>[l("div",ks,[d(_)])]),_:2},[o.html&&s(v).length?{name:"default",fn:L(()=>[d(m,{class:"toc-scroller-wrap","max-height":s($)},{default:L(()=>[d(t,{data:s(v),indent:15,"node-key":"domId","current-node-key":s(r),props:{children:"children",label:"title"},style:{"--el-tree-node-content-height":"32px","--el-tree-node-hover-bg-color":"var(--theme-opacity-color--5)"},onNodeClick:a.handleNodeClick},null,8,["data","current-node-key","onNodeClick"])]),_:1},8,["max-height"])]),key:"0"}:void 0]),1032,["loading"])])):D("",!0)}}}),Ss=oe($s,[["__scopeId","data-v-e35d25f4"]]),$e=y=>(ne("data-v-053c9ecc"),y=y(),ce(),y),xs={class:"card-bg pr mb-2 h-100 article-detail br-5 overhide"},zs={class:"p-2"},Cs={class:"article-cover layout-41 pr"},Is={class:"layout-card"},Ls={key:1,class:"article-cover-placeholder no-select",src:Ft},qs=$e(()=>l("div",{class:"cover-overlay wh-100"},null,-1)),Ts={class:"article-author flex g-2 px-2 mb-1 z-2 pr"},As={class:"flex-column article-info pr"},Qs={class:"article-author-nickname fs-16 fw-600 white-color pr"},Es={class:"author-info flex g-2"},Ds={key:0,class:"article-title fs-12 white-color success-bg br-3 px-1"},Ms={class:"px-2 fs-12 text-color word-break h-3x"},Hs=$e(()=>l("div",{class:"split-line my-2"},null,-1)),Rs={class:"px-2 mb-2"},Os={class:"flex-yc g-2 fs-14 mb-1"},Bs={class:"flex-yc g-1 text-color"},Ys=$e(()=>l("span",null,"发布时间",-1)),Ns={class:"text-color"},js={class:"flex-yc g-2 fs-14"},Vs={class:"flex-yc g-1 text-color"},Ws=$e(()=>l("span",null,"更新时间",-1)),Fs={class:"text-color"},Ps=ae({__name:"ArticleSideInfo",props:{article:{}},setup(y){const{width:p}=Te(),$=qe();return(r,v)=>{const i=we,e=Wt,a=Le,o=Tt,c=ye,h=le("ripple");return fe((g(),T("div",xs,[d(i,{animated:"",loading:r.article===null},ke({template:L(()=>[l("div",zs,[d(i,{rows:5})])]),_:2},[r.article?{name:"default",fn:L(()=>{var _,t,m,n,u,f,b,S,x,C,w,I,k,A;return[l("div",Cs,[l("div",Is,[r.article.covers?(g(),F(e,{key:0,class:"article-cover-img wh-100 pa",src:r.article.covers.split(",")[0]},null,8,["src"])):(g(),T("img",Ls)),qs])]),l("div",Ts,[l("div",{class:"curp avatar flex-shrink-0",onClick:v[0]||(v[0]=E=>s($).push({name:"front-user-detail",params:{id:r.article.uid}}))},[d(a,{size:60,src:r.article.result.author.avatar},null,8,["src"])]),l("div",As,[l("div",Qs,O(((_=r.article.result.author)==null?void 0:_.nickname)||"未知用户"),1),l("div",Es,[d(o,{class:"level-icon",size:s(p)>720?16:15,name:((u=(n=(m=(t=r.article.result.author)==null?void 0:t.result)==null?void 0:m.level)==null?void 0:n.current)==null?void 0:u.name)||"",value:((x=(S=(b=(f=r.article.result.author)==null?void 0:f.result)==null?void 0:b.level)==null?void 0:S.current)==null?void 0:x.value)||0},null,8,["size","name","value"]),(C=r.article.result.author)!=null&&C.title?(g(),T("span",Ds,O((w=r.article.result.author)==null?void 0:w.title),1)):D("",!0)])])]),l("p",Ms,O((I=r.article.result.author)==null?void 0:I.description),1),Hs,l("div",Rs,[l("div",Os,[l("div",Bs,[d(c,{name:"time-line"}),ze(),Ys]),l("span",Ns,O(s(Ce)((k=r.article)==null?void 0:k.create_time,"YYYY-MM-DD HH:mm")),1)]),l("div",js,[l("div",Vs,[d(c,{name:"timer-line"}),ze(),Ws]),l("span",Fs,O(s(Ce)((A=r.article)==null?void 0:A.update_time,"YYYY-MM-DD HH:mm")),1)])])]}),key:"0"}:void 0]),1032,["loading"])])),[[h,{color:"var(--theme-color-light-7)",duration:2e3}]])}}}),Us=oe(Ps,[["__scopeId","data-v-053c9ecc"]]),te=y=>(ne("data-v-20aec780"),y=y(),ce(),y),Js={class:"w-100 article-wraper"},Ks={class:"article-detail-wrapper br-5 p-2 w-100 card-bg"},Xs={class:"fs-24 lh-17 title-color"},Gs={class:"mt-1 flex-yc g-3 muted-color"},Zs={class:"fs-12"},el={class:"flex-yc"},tl={class:"light-text fs-12"},sl={class:"flex-yc"},ll={class:"light-text fs-12"},rl=te(()=>l("div",{class:"split-line my-1"},null,-1)),il=["innerHTML"],ol={key:0,class:"flex-center tip separator mt-2 fs-12 muted-color no-select"},al={key:1,class:"flex-yc flex-wrap g-2 mt-4"},nl={key:0,class:"group-list flex g-1 mr-2"},cl=te(()=>l("div",{class:"flex flex-shrink-0 g-1 text-color mr-1"},[l("span",{class:"fs-14"},"分组:")],-1)),dl={class:"flex flex-wrap g-2"},ul=["onClick"],pl={key:1,class:"group-list flex g-1"},hl=te(()=>l("div",{class:"flex g-1 text-color flex-shrink-0 mr-1"},[l("span",{class:"fs-14"},"标签:")],-1)),ml={class:"flex flex-wrap g-2"},_l=["onClick"],fl={key:2,class:"copyright-wrap overhide no-select br-5 p-2 mt-3 mb-1 pr"},vl={class:"text-color fs-15 flex-yc"},gl=te(()=>l("span",null,"版权声明",-1)),yl={class:"light-text copyright-content mt5 fs-14"},bl=te(()=>l("span",null,"本文系作者",-1)),wl=te(()=>l("span",null,"发布在",-1)),kl=te(()=>l("span",null,"站点，",-1)),$l={key:0,id:"comment-list-wrapper",class:"comment-list-wrapper card-bg mt-2 p-2 br-5"},Sl={key:1,class:"flex-center tip separator my-2 fs-12 muted-color no-select"},xl=ae({__name:"index",setup(y){const p=At.CommAES(),$=Ie(),r=Qt(),v=Et(),i=Ot(),e=qe(),{width:a}=Te(),o=he(!1),c=he(),h=he([]),_=xt(()=>!!(a.value&&document.querySelector("#article-info-card"))),t=$t({article:null}),m={initData:async()=>{t.article||m.getArticle()},getArticle:async()=>{const{code:n,data:u}=await vt.one({id:i.params.id,where:"audit = 1"});n==200?(ft(`${u.title}-${v.site.title}`),m.handlePass(u)):e.push({name:"404"})},handlePass:n=>{var u,f,b,S,x;if(!t.article){if(((f=(u=n==null?void 0:n.json)==null?void 0:u.auth)==null?void 0:f.auth)!=="password"||$.admin||r.passArticle.includes(n.id)||((b=$.user)==null?void 0:b.id)===((x=(S=n==null?void 0:n.result)==null?void 0:S.author)==null?void 0:x.id)){t.article=n;return}Rt.prompt("本文受密码保护，请提供正确密码。","请输入密码！",{confirmButtonText:"提交",cancelButtonText:"返回",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,autofocus:!0,inputType:"password",inputErrorMessage:"密码错误, 请重试！",inputValidator:C=>{var I,k;return p.decrypt(((k=(I=n==null?void 0:n.json)==null?void 0:I.auth)==null?void 0:k.password)||"")===C}}).then(({value:C})=>{var I,k;p.decrypt(((k=(I=n==null?void 0:n.json)==null?void 0:I.auth)==null?void 0:k.password)||"")===C?(t.article=n,r.passArticle.push(n.id),me({type:"success",message:"密码正确！"})):m.handlePass(n)}).catch(()=>{e.back()})}},handleRefresh:()=>{var n,u,f,b,S,x;(f=(u=(n=t.article)==null?void 0:n.result)==null?void 0:u.comment)!=null&&f.count&&(t.article.result.comment.count=((x=(S=(b=t.article)==null?void 0:b.result)==null?void 0:S.comment)==null?void 0:x.count)+1),c.value&&c.value.refresh()}};return Bt(()=>{var n;m.initData(),a.value=10,t.article&&ft(`${(n=t.article)==null?void 0:n.title}-${v.site.title}`)}),(n,u)=>{var U,J,q,B,Y,z,Q,N,j,W,K,X,de,ue,pe,Ee,De,Me,He,Re,Oe,Be,Ye,Ne,je,Ve,We,Fe,Pe;const f=Us,b=Ss,S=vs,x=ns,C=ts,w=we,I=Le,k=ye,A=St("RouterLink"),E=Lt,M=It,H=le("lazy"),R=le("plyr"),V=le("imgbox"),G=le("highlight"),Z=le("ripple");return g(),T("div",{class:"page-article-detail-wrapper flex w-100",style:Nt({marginLeft:s(o)&&!((U=s(h))!=null&&U.length)?"120px":0})},[s(_)&&((J=s(t).article)==null?void 0:J.id.toString())===s(i).params.id&&!s(o)?(g(),F(Se,{key:0,to:"#article-info-card"},[d(f,{article:s(t).article},null,8,["article"])])):D("",!0),s(_)&&((q=s(t).article)==null?void 0:q.id.toString())===s(i).params.id?(g(),F(Se,{key:1,to:"#article-toc-card"},[d(b,{hList:s(h),"onUpdate:hList":u[0]||(u[0]=se=>_t(h)?h.value=se:null),html:(B=s(t).article)==null?void 0:B.content,clear:s(o)},null,8,["hList","html","clear"])])):D("",!0),s(_)&&((Y=s(t).article)==null?void 0:Y.id.toString())===s(i).params.id&&!s(o)?(g(),F(Se,{key:2,to:"#article-rand-card"},[d(S)])):D("",!0),s(i).name==="front-article-detail"?(g(),F(x,{key:3,class:"mr-3",article:s(t).article,clear:s(o),"onUpdate:clear":u[1]||(u[1]=se=>_t(o)?o.value=se:null)},null,8,["article","clear"])):D("",!0),d(C,{article:s(t).article},null,8,["article"]),l("div",Js,[l("div",Ks,[d(w,{animated:"",loading:s(t).article===null},ke({template:L(()=>[d(w,{rows:8})]),_:2},[s(t).article&&s(i).params.id?{name:"default",fn:L(()=>{var se,Ue,Je,Ke,Xe,Ge,Ze,et,tt,st,lt,rt,it,ot,at,nt,ct,dt,ut,pt;return[l("h1",Xs,O(s(t).article.title),1),l("div",Gs,[l("div",{class:"flex-yc g-1 theme-hover curp",onClick:u[2]||(u[2]=ee=>{var P;return s(e).push({name:"front-user-detail",params:{id:(P=s(t).article)==null?void 0:P.uid}})})},[d(I,{src:(Ue=(se=s(t).article.result)==null?void 0:se.author)==null?void 0:Ue.avatar,size:14},null,8,["src"]),l("span",Zs,O(((Ke=(Je=s(t).article.result)==null?void 0:Je.author)==null?void 0:Ke.nickname)||"未知用户"),1)]),l("div",el,[d(k,{name:"calendar-line",class:"mr5",size:"14",color:"var(--light-text)"}),l("span",tl,O(s(Ce)(s(t).article.create_time,"YYYY-MM-DD HH:mm")),1)]),l("div",sl,[d(k,{name:"eye-line",class:"mr5",size:"14",color:"var(--light-text)"}),l("span",ll,O(s(t).article.views),1)])]),rl,fe(l("article",{class:"article-content",innerHTML:s(gt)(s(t).article.content)},null,8,il),[[H],[R],[V],[G]]),s(o)?D("",!0):(g(),T("div",ol," THE END ")),s(o)?D("",!0):(g(),T("div",al,[(Ze=(Ge=(Xe=s(t).article)==null?void 0:Xe.result)==null?void 0:Ge.group)!=null&&Ze.length?(g(),T("div",nl,[cl,l("div",dl,[(g(!0),T(ge,null,xe((tt=(et=s(t).article)==null?void 0:et.result)==null?void 0:tt.group,(ee,P)=>(g(),T("span",{class:"group-span curp theme-hover",onClick:_e=>s(e).push({name:"front-article-group",params:{id:ee.id}}),key:P},O(ee.name),9,ul))),128))])])):D("",!0),(rt=(lt=(st=s(t).article)==null?void 0:st.result)==null?void 0:lt.tags)!=null&&rt.length?(g(),T("div",pl,[hl,l("div",ml,[(g(!0),T(ge,null,xe((ot=(it=s(t).article)==null?void 0:it.result)==null?void 0:ot.tags,(ee,P)=>(g(),T("span",{class:"group-span curp theme-hover",onClick:_e=>s(e).push({name:"front-article-group",params:{id:ee.id}}),key:P},O(ee.name),9,_l))),128))])])):D("",!0)])),s(o)?D("",!0):fe((g(),T("div",fl,[d(k,{name:"copyright-fill",size:"100",class:"copyrught-icon theme-color"}),l("div",vl,[d(k,{name:"copyright-line",class:"mr5"}),gl]),l("div",yl,[bl,l("span",{class:"theme-color mx5 curp hvco",onClick:u[3]||(u[3]=ee=>{var P,_e,ht;return s(e).push({name:"front-user-detail",params:{id:((ht=(_e=(P=s(t).article)==null?void 0:P.result)==null?void 0:_e.author)==null?void 0:ht.id)||0}})})}," @"+O(((ct=(nt=(at=s(t).article)==null?void 0:at.result)==null?void 0:nt.author)==null?void 0:ct.nickname)||"未知作者"),1),wl,d(A,{class:"mx5 theme-color hvco",to:{name:"front-article-detail",params:{id:(dt=s(t).article)==null?void 0:dt.id}}},{default:L(()=>[ze(O(s(v).site.title),1)]),_:1},8,["to"]),kl,l("span",null,O(((pt=(ut=s(t).article)==null?void 0:ut.json)==null?void 0:pt.copyright)||"原创发布，未经许可，禁止转载。"),1)])])),[[Z,{color:"var(--theme-opacity-color-7)",duration:2e3}]])]}),key:"0"}:void 0]),1032,["loading"])]),((N=(Q=(z=s(t).article)==null?void 0:z.result)==null?void 0:Q.comment)==null?void 0:N.allow)===1||((K=(W=(j=s(t).article)==null?void 0:j.result)==null?void 0:W.comment)==null?void 0:K.show)===1?fe((g(),T("div",$l,[((ue=(de=(X=s(t).article)==null?void 0:X.result)==null?void 0:de.comment)==null?void 0:ue.allow)===1?(g(),F(E,{key:0,class:"mb-3",onHandleSend:m.handleRefresh,pid:0,"bind-id":(s(i).params.id||0).toString(),"bind-type":"article"},null,8,["onHandleSend","bind-id"])):D("",!0),((De=(Ee=(pe=s(t).article)==null?void 0:pe.result)==null?void 0:Ee.comment)==null?void 0:De.show)===1&&((Re=(He=(Me=s(t).article)==null?void 0:Me.result)==null?void 0:He.comment)!=null&&Re.count)?(g(),T("div",Sl," 评论("+O(((Ye=(Be=(Oe=s(t).article)==null?void 0:Oe.result)==null?void 0:Be.comment)==null?void 0:Ye.count)||0)+") ",1)):D("",!0),((Ve=(je=(Ne=s(t).article)==null?void 0:Ne.result)==null?void 0:je.comment)==null?void 0:Ve.show)===1?(g(),F(M,{key:2,ref_key:"commentListRef",ref:c,"bind-id":(s(i).params.id||0).toString(),uid:((Pe=(Fe=(We=s(t).article)==null?void 0:We.result)==null?void 0:Fe.author)==null?void 0:Pe.id)||0,"bind-type":"article"},null,8,["bind-id","uid"])):D("",!0)],512)),[[Yt,!s(o)]]):D("",!0)])],4)}}}),nr=oe(xl,[["__scopeId","data-v-20aec780"]]);export{nr as default};
