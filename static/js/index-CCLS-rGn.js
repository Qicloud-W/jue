import{_ as v}from"./Table-CEy5VCRK.js";import{V as C,b as D,X as R,Y as k}from"./element-plus-DEgQ78-a.js";import{p as T}from"./vueuse-CTCWISgP.js";import{b as S}from"./@vueuse-80B0Z04t.js";import{U as m,n as _}from"./index-CYWUNeU5.js";import{d as $,i as U,m as H,o as f,M as g,O as r,u as o,W as s,a as h,U as V,T as u,S as Y}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./vue-router-MJGgZ6ro.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const B={class:"flex-center"},ge=$({__name:"index",setup(E){const p=U(),{width:c}=S(),e=H({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,select_list:[],data_list:[],only_trashed:!1}),i={initData:()=>{i.fetchData()},fetchData:async()=>{e.loading=1;const l=await m.all({order:"name asc",where:'hash <> ""',page:e.page,limit:e.limit,onlyTrashed:e.only_trashed});l.code===200?(e.data_list=l.data.data,e.count=l.data.count,e.page_count=l.data.page):e.data_list=[],e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,i.fetchData()},handleSelect:l=>{e.select_list=[...l.map(t=>t.id)]},handleRestore:async(l,t)=>{t===-1?e.loading=4:e.loading_index=t;const n=await m.restore(l);_(n),e.data_list=e.data_list.filter(d=>!n.data.ids.includes(d.id)),e.loading_index=-1,e.loading=0},handleRemove:async l=>{const t=e.only_trashed?await m.delete(l):await m.remove(l);_(t),t.code===200&&(e.data_list=e.data_list.filter(n=>!t.data.ids.includes(n.id))),i.fetchData()},rowDblclick:l=>{e.select_list.includes(l.id)?e.select_list=e.select_list.filter(t=>t!==l.id):e.select_list.push(l.id),p.value.toggleRowSelection(l)}};return i.initData(),(l,t)=>{const n=C,d=D,w=R,b=k,x=v;return f(),g(x,{class:"auth-pages-table-container",page:o(e).page,"onUpdate:page":t[0]||(t[0]=a=>o(e).page=a),limit:o(e).limit,"onUpdate:limit":t[1]||(t[1]=a=>o(e).limit=a),pageCount:o(e).page_count,"onUpdate:pageCount":t[2]||(t[2]=a=>o(e).page_count=a),isScreen:o(e).is_screen,"onUpdate:isScreen":t[3]||(t[3]=a=>o(e).is_screen=a),loading:o(e).loading,length:o(e).select_list.length,count:o(e).count,onlyTrashed:o(e).only_trashed,alloCreate:!1,onHandleRestore:t[4]||(t[4]=a=>i.handleRestore(o(e).select_list,-1)),onHandleRemove:t[5]||(t[5]=a=>i.handleRemove(o(e).select_list)),onGetTrash:t[6]||(t[6]=a=>i.getTrash()),onHandleRefresh:t[7]||(t[7]=a=>i.fetchData())},{default:r(()=>[s(b,{border:"",ref_key:"tableRef",ref:p,data:o(e).data_list,"empty-text":"",class:"w-100","max-height":o(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:i.handleSelect,onRowDblclick:i.rowDblclick},{default:r(()=>[s(n,{fixed:"",type:"selection",width:"45"}),s(n,{fixed:o(c)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),s(n,{prop:"name",width:"300",label:"名称","show-overflow-tooltip":"",formatter:a=>a.name||"-"},null,8,["formatter"]),s(n,{prop:"hash",width:"150",label:"哈希","show-overflow-tooltip":"",formatter:a=>a.hash||"-"},null,8,["formatter"]),s(n,{prop:"remark","min-width":"150",label:"备注","show-overflow-tooltip":"",formatter:a=>a.remark||"-"},null,8,["formatter"]),s(n,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:r(a=>[h("span",null,V(o(T)(a.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),s(n,{fixed:o(c)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:140},{default:r(a=>[h("div",B,[o(e).only_trashed?(f(),g(d,{key:0,onClick:y=>i.handleRestore([a.row.id],a.$index),size:"small",loading:o(e).loading_index===a.$index,type:"success",plain:""},{default:r(()=>[u(" 恢复 ")]),_:2},1032,["onClick","loading"])):Y("",!0),s(w,{onConfirm:y=>i.handleRemove([a.row.id]),width:"180",title:o(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:r(()=>[s(d,{size:"small",type:"danger",plain:""},{default:r(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{ge as default};
