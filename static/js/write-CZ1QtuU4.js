import{_ as N,a as B}from"./Vditor-DbNEEuP_.js";import{T as K,E as P,L as $,a as x,F as D,p as R,U as z,q as O,G as F}from"./element-plus-DEgQ78-a.js";import{_ as G}from"./CommonSelect-BPJDZPOW.js";import{d as C,bf as w,bF as H,o as M,M as E,m as J,c as L,W as t,O as d,u as a,S as q,bn as W,bl as X,a as Q}from"./@vue-AVcRlItG.js";import{_ as Y}from"./InputUpload.vue_vue_type_style_index_0_lang-B-6SKlPI.js";import{u as Z,a as ee}from"./vue-router-MJGgZ6ro.js";import{l as oe,u as ae,C as te,f as y,n as j,o as le,A as V,d as se}from"./index-CYWUNeU5.js";import{a as ne,s as de,b as re,c as ie,d as pe}from"./options-BvRdR4NQ.js";import"./vditor-CyQdJvZo.js";import"./clipboard-CJr-i2j9.js";import"./@vueuse-80B0Z04t.js";import"./vueuse-CTCWISgP.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const me=C({__name:"CascadeSelect",props:w({labelKey:{default:"label"},valueKey:{default:"value"},disabled:{type:Boolean,default:!1},childrenKey:{default:"children"},emitPath:{type:Boolean,default:!0},teleported:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0},expandTrigger:{default:"click"},disabledKey:{default:"disabled"},clearable:{type:Boolean,default:!1},separator:{default:"/"},placeholder:{default:"请选择"},size:{default:"default"},options:{default:()=>[]}},{value:{},valueModifiers:{}}),emits:w(["handleChange","handleExpandChange","handleClose"],["update:value"]),setup(u,{emit:b}){const f=H(u,"value"),c=b,_=()=>{c("handleChange")},h=()=>{c("handleExpandChange")},e=()=>{c("handleClose")};return(n,r)=>{const o=K;return M(),E(o,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=m=>f.value=m),props:{multiple:n.multiple,emitPath:n.emitPath,expandTrigger:n.expandTrigger,label:n.labelKey,value:n.valueKey,children:n.childrenKey,disabled:n.disabledKey},size:n.size,options:n.options,disabled:n.disabled,clearable:n.clearable,teleported:n.teleported,separator:n.separator,placeholder:n.placeholder,"show-all-levels":n.showAllLevels,onClose:e,onChange:_,onExpandChange:h},null,8,["modelValue","props","size","options","disabled","clearable","teleported","separator","placeholder","show-all-levels"])}}}),ue=u=>(W("data-v-69db7f4c"),u=u(),X(),u),fe={class:"admin-article-page-wrapper flex g-4"},ce=ue(()=>Q("h4",null,"撰写文章",-1)),ge=C({__name:"write",setup(u){const b=Z(),f=oe(),c=ae(),_=ee(),h=te.CommAES(),e=J({formModel:{id:void 0,title:f.env.DEV?"开发测试标题":"",covers:"",abstract:"",tags:[],content:"",remark:"",top:0,audit:c.admin?1:0,editor:"vditor",create_time:Math.floor(Date.now()/1e3),group:[],json:{copyright:"",comment:{allow:1,show:1},auth:{auth:"everyone",password:""}}},allow_options:ne,show_options:de,auth_options:re,audit_options:ie,bool_num_options:pe,group_tree:[],tags_options:[],loading:!1}),n={initData:()=>{n.fetchData(),n.getArticleTags(),n.getArticleGroup()},fetchData:async()=>{var r,o,m,p;if(_.params.id){const l=await y.one({id:_.params.id});l.code===200?((o=(r=l.data.json)==null?void 0:r.auth)!=null&&o.password&&(l.data.json.auth.password=h.decrypt(l.data.json.auth.password)),e.formModel.id=l.data.id,e.formModel.top=l.data.top,e.formModel.audit=l.data.audit,e.formModel.title=l.data.title,e.formModel.create_time=l.data.create_time,l.data.json&&(l.data.json.comment&&(e.formModel.json.comment=l.data.json.comment),l.data.json.auth&&(e.formModel.json.auth=l.data.json.auth),l.data.json.copyright&&(e.formModel.json.copyright=l.data.json.copyright)),e.formModel.remark=l.data.remark||"",e.formModel.covers=l.data.covers,e.formModel.content=l.data.content,e.formModel.abstract=l.data.abstract,e.formModel.tags=((m=l.data.tags.match(/\d+/g))==null?void 0:m.map(Number))||[],e.formModel.group=((p=l.data.group.match(/\d+/g))==null?void 0:p.map(Number))||[]):b.push({name:"admin-404"})}},handleSubmit:async()=>{if(!e.formModel.title)return P.warning("标题不能为空");e.loading=!0;try{const r=JSON.parse(JSON.stringify({...e.formModel.json})),o=r.auth.password;r.auth.password=o?h.encrypt(o):"";const m={...e.formModel,tags:e.formModel.tags.length?`|${e.formModel.tags.join("|")}|`:"",group:e.formModel.group.length?`|${e.formModel.group.join("|")}|`:"",json:JSON.stringify({...r})},p=await y.save(m);j(p),p.code===200&&(e.formModel.id=p.data.id)}finally{e.loading=!1}},getArticleGroup:async()=>{const r=await le.tree({field:"label,value,children"});r.code===200&&(e.group_tree=r.data)},getArticleTags:async()=>{const r=await V.column({field:"id,name",order:"id desc",or:[["type","=","default"],["type","=","article"]]});r.code===200&&(e.tags_options=r.data)},handleTags:r=>{r&&r.length&&r.forEach(async(o,m)=>{if(typeof o=="string"){const{code:p,msg:l,data:i}=await V.save({name:o,type:"article",description:`发布文章${e.formModel.title||""}创建的标签`});if(p!==200)return j(p,void 0,"添加标签失败："+l),e.tags_options.splice(m,1);e.formModel.tags[m]=i.id,e.tags_options.push({id:i.id,name:o})}})}};return n.initData(),(r,o)=>{const m=B,p=$,l=x,i=D,S=Y,A=me,g=G,v=R,U=z,T=O,k=F,I=N;return M(),L("div",fe,[t(p,{class:"box-card cus-box-card w-100 article-left flex-column",shadow:"never"},{header:d(()=>[ce]),default:d(()=>[t(m,{class:"flex-1",path:`${a(f).env.INIS_APP_THEME_NAME}/article/${new Date().toISOString().split("T")[0]}`,content:a(e).formModel.content,"onUpdate:content":o[0]||(o[0]=s=>a(e).formModel.content=s)},null,8,["path","content"])]),_:1}),t(p,{class:"article-config-card box-card cus-box-card",shadow:"never"},{default:d(()=>[t(k,{"label-position":"top"},{default:d(()=>[t(T,{"model-value":"base"},{default:d(()=>[t(v,{label:"基本选项",name:"base"},{default:d(()=>[t(i,{label:"文章标题"},{default:d(()=>[t(l,{modelValue:a(e).formModel.title,"onUpdate:modelValue":o[1]||(o[1]=s=>a(e).formModel.title=s),placeholder:"请输入文章标题"},null,8,["modelValue"])]),_:1}),t(i,{label:"文章封面"},{default:d(()=>[t(S,{path:`${a(f).env.INIS_APP_THEME_NAME}/article/image/${new Date().toISOString().split("T")[0]}`,accept:[".jpg",".png",".jpeg",".svg",".webp"],value:a(e).formModel.covers,"onUpdate:value":o[2]||(o[2]=s=>a(e).formModel.covers=s)},null,8,["path","accept","value"])]),_:1}),t(i,{label:"文章分组"},{default:d(()=>[t(A,{modelValue:a(e).formModel.group,"onUpdate:modelValue":o[3]||(o[3]=s=>a(e).formModel.group=s),multiple:"",emitPath:!1,placeholder:"请选择文章分组",class:"w-100",options:a(e).group_tree},null,8,["modelValue","options"])]),_:1}),t(i,{label:"置顶文章"},{default:d(()=>[t(g,{class:"w-100",options:a(e).bool_num_options,value:a(e).formModel.top,"onUpdate:value":o[4]||(o[4]=s=>a(e).formModel.top=s)},null,8,["options","value"])]),_:1}),t(i,{label:"审核状态"},{default:d(()=>[t(g,{disabled:!a(c).admin,class:"w-100",options:a(e).audit_options,value:a(e).formModel.audit,"onUpdate:value":o[5]||(o[5]=s=>a(e).formModel.audit=s)},null,8,["disabled","options","value"])]),_:1}),t(i,{label:"文章标签"},{default:d(()=>[t(g,{class:"w-100",valueKey:"id",labelKey:"name",multiple:"","allow-create":"",filterable:"","reserve-keyword":!1,options:a(e).tags_options,value:a(e).formModel.tags,"onUpdate:value":o[6]||(o[6]=s=>a(e).formModel.tags=s),placeholder:"设置文章标签",onChange:n.handleTags},null,8,["options","value","onChange"])]),_:1}),t(i,{label:"文章摘要"},{default:d(()=>[t(l,{modelValue:a(e).formModel.abstract,"onUpdate:modelValue":o[7]||(o[7]=s=>a(e).formModel.abstract=s),type:"textarea",placeholder:"请输入文章摘要",autosize:{minRows:4,maxRows:8}},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{label:"高级选项",name:"senior"},{default:d(()=>[t(i,{label:"允许评论"},{default:d(()=>[t(g,{class:"w-100",options:a(e).allow_options,value:a(e).formModel.json.comment.allow,"onUpdate:value":o[8]||(o[8]=s=>a(e).formModel.json.comment.allow=s)},null,8,["options","value"])]),_:1}),t(i,{label:"显示评论"},{default:d(()=>[t(g,{class:"w-100",options:a(e).show_options,value:a(e).formModel.json.comment.show,"onUpdate:value":o[9]||(o[9]=s=>a(e).formModel.json.comment.show=s)},null,8,["options","value"])]),_:1}),t(i,{label:"文章权限"},{default:d(()=>[t(g,{class:"w-100",options:a(e).auth_options,value:a(e).formModel.json.auth.auth,"onUpdate:value":o[10]||(o[10]=s=>a(e).formModel.json.auth.auth=s)},null,8,["options","value"])]),_:1}),a(e).formModel.json.auth.auth==="password"?(M(),E(i,{key:0,label:"文章密码"},{default:d(()=>[t(l,{type:"password",clearable:"","show-password":"",modelValue:a(e).formModel.json.auth.password,"onUpdate:modelValue":o[11]||(o[11]=s=>a(e).formModel.json.auth.password=s),placeholder:"请输入文章密码"},null,8,["modelValue"])]),_:1})):q("",!0),t(i,{label:"发布时间"},{default:d(()=>[t(U,{style:{"--el-date-editor-width":"100%"},modelValue:a(e).formModel.create_time,"onUpdate:modelValue":o[12]||(o[12]=s=>a(e).formModel.create_time=s),type:"datetime","value-format":"X"},null,8,["modelValue"])]),_:1}),t(i,{label:"版权声明"},{default:d(()=>[t(l,{modelValue:a(e).formModel.json.copyright,"onUpdate:modelValue":o[13]||(o[13]=s=>a(e).formModel.json.copyright=s),type:"textarea",placeholder:"请填写文章版权说明",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"])]),_:1}),t(i,{label:"文章备注"},{default:d(()=>[t(l,{modelValue:a(e).formModel.remark,"onUpdate:modelValue":o[14]||(o[14]=s=>a(e).formModel.remark=s),type:"textarea",placeholder:"请填写文章备注",autosize:{minRows:4,maxRows:8}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(I,{onHandleClick:o[15]||(o[15]=s=>n.handleSubmit()),loading:a(e).loading},null,8,["loading"])])}}}),Ze=se(ge,[["__scopeId","data-v-69db7f4c"]]);export{Ze as default};
