import{_ as H}from"./Table-CEy5VCRK.js";import{V as $,f as E,j as M,b as B,X as U,Y as V}from"./element-plus-DEgQ78-a.js";import{p as Y}from"./vueuse-CTCWISgP.js";import{w as _,n as w,m as z}from"./index-CYWUNeU5.js";import{b as N}from"./@vueuse-80B0Z04t.js";import{d as P,i as j,m as A,ar as L,o as d,M as h,O as s,u as o,W as r,P as O,c as p,a as m,U as f,S as g,T as k}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./vue-router-MJGgZ6ro.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const W={class:"flex-yc g-2"},q={class:"h-1x"},F=["innerHTML"],G={key:1},X={class:"flex"},I={key:0},J={key:1},K={key:2},Q={key:3},Z={class:"flex-center"},Ue=P({__name:"index",setup(ee){const y=j(),{width:b}=N(),e=A({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,select_list:[],data_list:[],only_trashed:!1}),l={initData:()=>{l.fetchData()},getHtmlText:n=>new DOMParser().parseFromString(n,"text/html").body.textContent||"",fetchData:async()=>{e.loading=1;const n=await _.all({page:e.page,limit:e.limit,onlyTrashed:e.only_trashed});n.code===200?(e.data_list=n.data.data,e.count=n.data.count,e.page_count=n.data.page):e.data_list=[],e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,l.fetchData()},handleSelect:n=>{e.select_list=[...n.map(a=>a.id)]},handleRestore:async(n,a)=>{a===-1?e.loading=4:e.loading_index=a;const i=await _.restore(n);w(i),e.data_list=e.data_list.filter(u=>!i.data.ids.includes(u.id)),e.loading_index=-1,e.loading=0},handleRemove:async n=>{const a=e.only_trashed?await _.delete(n):await _.remove(n);w(a),a.code===200&&(e.data_list=e.data_list.filter(i=>!a.data.ids.includes(i.id))),l.fetchData()},rowDblclick:n=>{e.select_list.includes(n.id)?e.select_list=e.select_list.filter(a=>a!==n.id):e.select_list.push(n.id),y.value.toggleRowSelection(n)}};return l.initData(),(n,a)=>{const i=$,u=E,D=M,v=B,T=U,C=V,R=H,S=L("imgbox");return d(),h(R,{class:"comment-table-container",page:o(e).page,"onUpdate:page":a[0]||(a[0]=t=>o(e).page=t),limit:o(e).limit,"onUpdate:limit":a[1]||(a[1]=t=>o(e).limit=t),pageCount:o(e).page_count,"onUpdate:pageCount":a[2]||(a[2]=t=>o(e).page_count=t),isScreen:o(e).is_screen,"onUpdate:isScreen":a[3]||(a[3]=t=>o(e).is_screen=t),loading:o(e).loading,length:o(e).select_list.length,count:o(e).count,onlyTrashed:o(e).only_trashed,alloCreate:!1,onHandleRestore:a[4]||(a[4]=t=>l.handleRestore(o(e).select_list,-1)),onHandleRemove:a[5]||(a[5]=t=>l.handleRemove(o(e).select_list)),onGetTrash:a[6]||(a[6]=t=>l.getTrash()),onHandleRefresh:a[7]||(a[7]=t=>l.fetchData())},{default:s(()=>[r(C,{border:"",ref_key:"tableRef",ref:y,data:o(e).data_list,"empty-text":"",class:"w-100","max-height":o(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:l.handleSelect,onRowDblclick:l.rowDblclick},{default:s(()=>[r(i,{fixed:"",type:"selection",width:"45"}),r(i,{fixed:o(b)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),r(i,{label:"用户",width:"200","show-overflow-tooltip":""},{default:s(({row:t})=>{var c,x;return[O((d(),p("div",W,[r(u,{shape:"square",src:(c=t.result.author)==null?void 0:c.avatar,size:24},null,8,["src"]),m("span",null,f((x=t.result.author)==null?void 0:x.nickname),1)])),[[S]])]}),_:1}),r(i,{prop:"content","min-width":"250",label:"内容"},{default:s(({row:t})=>[t.content?(d(),h(D,{key:0,width:400,placement:"bottom-end",trigger:"hover"},{reference:s(()=>[m("span",q,f(l.getHtmlText(t.content)),1)]),default:s(()=>[m("div",{class:"comment-content article-content fs-12",innerHTML:o(z)(t.content)},null,8,F)]),_:2},1024)):(d(),p("span",G,"-"))]),_:1}),r(i,{prop:"ip",width:"150",label:"区域","show-overflow-tooltip":"",formatter:t=>{var c;return((c=t.json)==null?void 0:c.area)||"-"}},null,8,["formatter"]),r(i,{"min-width":"300",label:"来源","show-overflow-tooltip":""},{default:s(({row:t})=>[m("div",X,[t.bind_type==="article"?(d(),p("span",I,"文章：")):g("",!0),t.bind_type==="page"?(d(),p("span",J,"页面：")):g("",!0),t.result[t.bind_type]?(d(),p("span",K,f(t.result[t.bind_type].title||"-"),1)):(d(),p("span",Q,"-"))])]),_:1}),r(i,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:s(t=>[m("span",null,f(o(Y)(t.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),r(i,{fixed:o(b)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:140},{default:s(t=>[m("div",Z,[o(e).only_trashed?(d(),h(v,{key:0,onClick:c=>l.handleRestore([t.row.id],t.$index),size:"small",loading:o(e).loading_index===t.$index,type:"success",plain:""},{default:s(()=>[k(" 恢复 ")]),_:2},1032,["onClick","loading"])):g("",!0),r(T,{onConfirm:c=>l.handleRemove([t.row.id]),width:"180",title:o(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:s(()=>[r(v,{size:"small",type:"danger",plain:""},{default:s(()=>[k(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Ue as default};
