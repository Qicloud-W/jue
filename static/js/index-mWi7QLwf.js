import{_ as B}from"./Table-CEy5VCRK.js";import{V as J,f as V,b as Y,X as M,Y as N}from"./element-plus-DEgQ78-a.js";import{_ as A}from"./CommonSelect-BPJDZPOW.js";import{p as K}from"./vueuse-CTCWISgP.js";import{u as L}from"./vue-router-MJGgZ6ro.js";import{l as P,j as f,n as R,D as W,E as j}from"./index-CYWUNeU5.js";import{b as G}from"./@vueuse-80B0Z04t.js";import{d as O,i as X,m as q,ar as F,o as u,M as S,O as o,u as i,W as n,P as I,c as g,a as c,U as p,S as v,T}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const Q={class:"flex-yc g-1 curp theme-hover"},Z=["onClick"],ee={class:"fs-14"},te={class:"flex-center"},ae={class:"flex"},ie={class:"fs-14"},le=["onClick"],se={key:1,class:"fs-14 word-break mx5 curp hvco"},ne={class:"flex-center"},Pe=O({__name:"index",setup(oe){const x=L(),b=P(),y=X(),{width:k}=G(),e=q({page:1,count:0,limit:15,page_count:0,search_id:void 0,is_screen:!1,loading:0,loading_index:-1,eidt_index:0,select_list:[],data_list:[],only_trashed:!1,expJson:W,bindTypeJson:j}),s={initData:()=>{b.getUserList(),s.fetchData()},fetchData:async()=>{e.loading=1;const l=await f.all({page:e.page,limit:e.limit,order:"create_time desc",onlyTrashed:e.only_trashed,where:e.search_id?`uid = ${e.search_id}`:""});l.code===200?(e.data_list=l.data.data,e.count=l.data.count,e.page_count=l.data.page):e.data_list=[],e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,s.fetchData()},handleSelect:l=>{e.select_list=[...l.map(a=>a.id)]},handleRestore:async(l,a)=>{a===-1?e.loading=4:e.loading_index=a;const m=await f.restore(l);R(m),e.data_list=e.data_list.filter(r=>!m.data.ids.includes(r.id)),e.loading_index=-1,e.loading=0},handleRemove:async l=>{const a=e.only_trashed?await f.delete(l):await f.remove(l);R(a),a.code===200&&(e.data_list=e.data_list.filter(m=>!a.data.ids.includes(m.id))),s.fetchData()},rowDblclick:l=>{e.select_list.includes(l.id)?e.select_list=e.select_list.filter(a=>a!==l.id):e.select_list.push(l.id),y.value.toggleRowSelection(l)}};return s.initData(),(l,a)=>{const m=A,r=J,$=V,w=Y,E=M,U=N,H=B,z=F("imgbox");return u(),S(H,{class:"level-table-container",page:i(e).page,"onUpdate:page":a[2]||(a[2]=t=>i(e).page=t),limit:i(e).limit,"onUpdate:limit":a[3]||(a[3]=t=>i(e).limit=t),pageCount:i(e).page_count,"onUpdate:pageCount":a[4]||(a[4]=t=>i(e).page_count=t),isScreen:i(e).is_screen,"onUpdate:isScreen":a[5]||(a[5]=t=>i(e).is_screen=t),loading:i(e).loading,length:i(e).select_list.length,count:i(e).count,onlyTrashed:i(e).only_trashed,alloCreate:!1,onHandleRestore:a[6]||(a[6]=t=>s.handleRestore(i(e).select_list,-1)),onHandleRemove:a[7]||(a[7]=t=>s.handleRemove(i(e).select_list)),onGetTrash:a[8]||(a[8]=t=>s.getTrash()),onHandleRefresh:a[9]||(a[9]=t=>s.fetchData())},{"top-right":o(()=>[n(m,{value:i(e).search_id,"onUpdate:value":a[0]||(a[0]=t=>i(e).search_id=t),size:"small",multiple:!1,clearable:"",placeholder:"请选择用户",labelKey:"nickname",valueKey:"id",options:i(b).userList,style:{width:"120px"},onHandleChange:a[1]||(a[1]=t=>s.fetchData())},null,8,["value","options"])]),default:o(()=>[n(U,{border:"",ref_key:"tableRef",ref:y,data:i(e).data_list,"empty-text":"",class:"w-100","max-height":i(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:s.handleSelect,onRowDblclick:s.rowDblclick},{default:o(()=>[n(r,{fixed:"",type:"selection",width:"45"}),n(r,{fixed:i(k)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),n(r,{label:"用户",width:"150","show-overflow-tooltip":""},{default:o(({row:t})=>{var d,_;return[I((u(),g("div",Q,[n($,{class:"flex-shrink-0",src:(d=t.result.author)==null?void 0:d.avatar,size:20},null,8,["src"]),c("span",{onClick:h=>i(x).push({name:"admin-manage-user-detail",params:{id:t.uid}}),class:"fs-14 h-1x"},p(((_=t.result.author)==null?void 0:_.nickname)||"已删用户"),9,Z)])),[[z]])]}),_:1}),n(r,{label:"行为",width:"100",align:"center"},{default:o(({row:t})=>{var d;return[c("span",ee,p(((d=i(e).expJson[t.type])==null?void 0:d.name)||"-"),1)]}),_:1}),n(r,{label:"经验",width:"100",align:"center"},{default:o(({row:t})=>[c("div",te,[c("span",null,"+"+p(t.value||0),1)])]),_:1}),n(r,{prop:"description","min-width":"300",label:"描述","show-overflow-tooltip":""},{default:o(({row:t})=>{var d,_,h,C,D;return[c("div",ae,[c("span",ie,p((d=i(e).expJson[t.type])==null?void 0:d.text)+p(i(e).bindTypeJson[t.bind_type]||""),1),t.bind_type==="article"&&((_=t.result.article)!=null&&_.id)?(u(),g("span",{key:0,class:"fs-14 theme-color word-break mx5 curp hvco",onClick:re=>i(x).push({name:"admin-article-detail",params:{id:t.result.article.id}})},p((h=t.result.article)==null?void 0:h.title),9,le)):v("",!0),t.bind_type==="page"&&((C=t.result.page)!=null&&C.id)?(u(),g("span",se,p((D=t.result.page)==null?void 0:D.title),1)):v("",!0)])]}),_:1}),n(r,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:o(t=>[c("span",null,p(i(K)(t.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),n(r,{fixed:i(k)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:120},{default:o(t=>[c("div",ne,[i(e).only_trashed?(u(),S(w,{key:0,onClick:d=>s.handleRestore([t.row.id],t.$index),size:"small",loading:i(e).loading_index===t.$index,type:"success",plain:""},{default:o(()=>[T(" 恢复 ")]),_:2},1032,["onClick","loading"])):v("",!0),n(E,{onConfirm:d=>s.handleRemove([t.row.id]),width:"180",title:i(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:o(()=>[n(w,{size:"small",type:"danger",plain:""},{default:o(()=>[T(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Pe as default};
