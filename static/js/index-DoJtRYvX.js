import{_ as I}from"./Table-CEy5VCRK.js";import{V as P,i as j,b as F,X as G,Y as O,a as W,F as X,U as J,G as q,d as K}from"./element-plus-DEgQ78-a.js";import{_ as L}from"./InputUpload.vue_vue_type_style_index_0_lang-B-6SKlPI.js";import{_ as Q}from"./CommonSelect-BPJDZPOW.js";import{p as R}from"./vueuse-CTCWISgP.js";import{l as Z,i as u,n as b,J as ee}from"./index-CYWUNeU5.js";import{b as te}from"./@vueuse-80B0Z04t.js";import{l as ae}from"./options-BvRdR4NQ.js";import{d as le,i as oe,m as S,k as ne,ar as ie,o as m,M as g,O as i,u as l,W as o,P as de,c as f,T as _,U as x,a as y,S as U}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./vue-router-MJGgZ6ro.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const se=["src"],re={key:1},me=["href"],pe={key:1},_e={class:"flex-center"},ue={class:"dialog-footer"},Le=le({__name:"index",setup(ce){const E=Z(),D=oe(),V=Math.floor(Date.now()/1e3),{width:k}=te(),e=S({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,edit_index:0,select_list:[],data_list:[],only_trashed:!1,create_data:!1,show_dialog:!1,link_target_options:ae}),h=S({id:void 0,url:void 0,title:void 0,image:void 0,target:void 0,remark:void 0,content:void 0,end_time:void 0,start_time:void 0,time_range:void 0}),d=ne(()=>e.create_data?h:e.data_list[e.edit_index]||h),s={initData:()=>{s.fetchData()},fetchData:async()=>{e.loading=1;const n=await u.all({page:e.page,limit:e.limit,onlyTrashed:e.only_trashed});n.code===200?(e.data_list=n.data.data,e.count=n.data.count,e.page_count=n.data.page):e.data_list=[],e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,s.fetchData()},handleSelect:n=>{e.select_list=[...n.map(t=>t.id)]},handleAdd:()=>{e.create_data=!0,e.show_dialog=!0},handleEdit:n=>{e.create_data=!1,e.edit_index=n;const t=e.data_list[n]||h;t.time_range=[t.start_time,t.end_time],console.log(t),e.show_dialog=!0},handleSave:()=>{var n,t;d.value.start_time=((n=d.value.time_range)==null?void 0:n[0])||0,d.value.end_time=((t=d.value.time_range)==null?void 0:t[1])||0,e.create_data?s.handleCreate():s.handleUpdate()},handleCreate:async()=>{e.loading=2;const n=await u.create(d.value);b(n),e.loading=0,n.code===200&&(s.fetchData(),ee(h),e.show_dialog=!1)},handleUpdate:async()=>{e.loading=2;const n=await u.update({...d.value});b(n),e.show_dialog=!1,e.loading=0},handleRestore:async(n,t)=>{t===-1?e.loading=4:e.loading_index=t;const r=await u.restore(n);b(r),e.data_list=e.data_list.filter(w=>!r.data.ids.includes(w.id)),e.loading_index=-1,e.loading=0},handleRemove:async n=>{const t=e.only_trashed?await u.delete(n):await u.remove(n);b(t),t.code===200&&(e.data_list=e.data_list.filter(r=>!t.data.ids.includes(r.id))),s.fetchData()},rowDblclick:n=>{e.select_list.includes(n.id)?e.select_list=e.select_list.filter(t=>t!==n.id):e.select_list.push(n.id),D.value.toggleRowSelection(n)}};return s.initData(),(n,t)=>{const r=P,w=j,c=F,T=G,$=O,v=W,p=X,M=Q,H=L,Y=J,z=q,A=K,B=I,N=ie("imgbox");return m(),g(B,{class:"banner-table-container",page:l(e).page,"onUpdate:page":t[9]||(t[9]=a=>l(e).page=a),limit:l(e).limit,"onUpdate:limit":t[10]||(t[10]=a=>l(e).limit=a),pageCount:l(e).page_count,"onUpdate:pageCount":t[11]||(t[11]=a=>l(e).page_count=a),isScreen:l(e).is_screen,"onUpdate:isScreen":t[12]||(t[12]=a=>l(e).is_screen=a),loading:l(e).loading,length:l(e).select_list.length,count:l(e).count,onlyTrashed:l(e).only_trashed,onHandleAdd:t[13]||(t[13]=a=>s.handleAdd()),onHandleRestore:t[14]||(t[14]=a=>s.handleRestore(l(e).select_list,-1)),onHandleRemove:t[15]||(t[15]=a=>s.handleRemove(l(e).select_list)),onGetTrash:t[16]||(t[16]=a=>s.getTrash()),onHandleRefresh:t[17]||(t[17]=a=>s.fetchData())},{default:i(()=>[o($,{border:"",ref_key:"tableRef",ref:D,data:l(e).data_list,"empty-text":"",class:"w-100","max-height":l(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:s.handleSelect,onRowDblclick:s.rowDblclick},{default:i(()=>[o(r,{fixed:"",type:"selection",width:"45"}),o(r,{fixed:l(k)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),o(r,{prop:"title",label:"标题","min-width":"250","show-overflow-tooltip":""}),o(r,{"class-name":"cover-item",label:"封面",align:"center",width:"80"},{default:i(a=>[de((m(),f("div",null,[a.row.image?(m(),f("img",{key:0,src:a.row.image,class:"logo br"},null,8,se)):(m(),f("span",re,"-"))])),[[N]])]),_:1}),o(r,{label:"状态",align:"center",width:"80"},{default:i(({row:a})=>[l(V)>a.start_time&&l(V)<a.end_time?(m(),g(w,{key:0,type:"success"},{default:i(()=>[_("有效")]),_:1})):(m(),g(w,{key:1,type:"warning"},{default:i(()=>[_("过期")]),_:1}))]),_:1}),o(r,{prop:"url",label:"链接",width:"250","show-overflow-tooltip":""},{default:i(a=>[a.row.url?(m(),f("a",{key:0,class:"theme-color",href:a.row.url,target:"_blank"},x(a.row.url),9,me)):(m(),f("span",pe,"-"))]),_:1}),o(r,{prop:"content","min-width":"200",label:"内容","show-overflow-tooltip":"",formatter:a=>a.content||"-"},null,8,["formatter"]),o(r,{prop:"remark","min-width":"200",label:"备注","show-overflow-tooltip":"",formatter:a=>a.remark||"-"},null,8,["formatter"]),o(r,{prop:"update_time",sortable:"",label:"更新时间",width:"180"},{default:i(a=>[y("span",null,x(l(R)(a.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(r,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:i(a=>[y("span",null,x(l(R)(a.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(r,{fixed:l(k)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:140},{default:i(a=>[y("div",_e,[l(e).only_trashed?U("",!0):(m(),g(c,{key:0,size:"small",type:"primary",plain:"",onClick:C=>s.handleEdit(a.$index)},{default:i(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),l(e).only_trashed?(m(),g(c,{key:1,onClick:C=>s.handleRestore([a.row.id],a.$index),size:"small",loading:l(e).loading_index===a.$index,type:"success",plain:""},{default:i(()=>[_(" 恢复 ")]),_:2},1032,["onClick","loading"])):U("",!0),o(T,{onConfirm:C=>s.handleRemove([a.row.id]),width:"180",title:l(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:i(()=>[o(c,{size:"small",type:"danger",plain:""},{default:i(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"]),o(A,{modelValue:l(e).show_dialog,"onUpdate:modelValue":t[8]||(t[8]=a=>l(e).show_dialog=a),draggable:"",width:"95%",title:"编辑轮播"},{footer:i(()=>[y("span",ue,[o(c,{onClick:t[7]||(t[7]=a=>l(e).show_dialog=!1)},{default:i(()=>[_("取消")]),_:1}),o(c,{loading:l(e).loading===2,type:"primary",onClick:s.handleSave},{default:i(()=>[_(" 确认 ")]),_:1},8,["loading","onClick"])])]),default:i(()=>[o(z,{model:l(d),"label-position":l(k)<=768?"top":"left"},{default:i(()=>[o(p,{label:"标题"},{default:i(()=>[o(v,{modelValue:l(d).title,"onUpdate:modelValue":t[0]||(t[0]=a=>l(d).title=a),placeholder:"轮播标题"},null,8,["modelValue"])]),_:1}),o(p,{label:"链接"},{default:i(()=>[o(v,{modelValue:l(d).url,"onUpdate:modelValue":t[1]||(t[1]=a=>l(d).url=a),placeholder:"跳转链接"},null,8,["modelValue"])]),_:1}),o(p,{label:"跳转"},{default:i(()=>[o(M,{value:l(d).target,"onUpdate:value":t[2]||(t[2]=a=>l(d).target=a),options:l(e).link_target_options},null,8,["value","options"])]),_:1}),o(p,{label:"封面"},{default:i(()=>[o(H,{accept:[".jpg",".png",".jpeg",".svg",".webp"],path:`${l(E).env.INIS_APP_THEME_NAME}/banner`,value:l(d).image,"onUpdate:value":t[3]||(t[3]=a=>l(d).image=a)},null,8,["accept","path","value"])]),_:1}),o(p,{label:"时间"},{default:i(()=>[o(Y,{modelValue:l(d).time_range,"onUpdate:modelValue":t[4]||(t[4]=a=>l(d).time_range=a),type:"datetimerange","range-separator":"-","value-format":"X","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),o(p,{label:"内容"},{default:i(()=>[o(v,{modelValue:l(d).content,"onUpdate:modelValue":t[5]||(t[5]=a=>l(d).content=a),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入轮播内容"},null,8,["modelValue"])]),_:1}),o(p,{label:"备注"},{default:i(()=>[o(v,{modelValue:l(d).remark,"onUpdate:modelValue":t[6]||(t[6]=a=>l(d).remark=a),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Le as default};
