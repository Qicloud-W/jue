import{c as L}from"./unhead-BIJBGSS1.js";import{n as S,v as x,u as E}from"./@vue-AVcRlItG.js";function O(e){return Array.isArray(e)?e:[e]}const _=["title","titleTemplate","script","style","noscript"],b=["base","meta","link","style","script","noscript"],$=["title","titleTemplate","templateParams","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"],j=["base","title","titleTemplate","bodyAttrs","htmlAttrs","templateParams"],M=["tagPosition","tagPriority","tagDuplicateStrategy","children","innerHTML","textContent","processTemplateParams"],X=typeof window<"u";function Y(e){return e}function R(e){let n=9;for(let t=0;t<e.length;)n=Math.imul(n^e.charCodeAt(t++),9**9);return((n^n>>>9)+65536).toString(16).substring(1,8).toLowerCase()}function w(e){return e._h||R(e._d?e._d:`${e.tag}:${e.textContent||e.innerHTML||""}:${Object.entries(e.props).map(([n,t])=>`${n}:${String(t)}`).join(",")}`)}function D(e,n){const{props:t,tag:r}=e;if(j.includes(r))return r;if(r==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const i=["id"];r==="meta"&&i.push("name","property","http-equiv");for(const s of i)if(typeof t[s]<"u"){const c=String(t[s]);return n&&!n(c)?!1:`${r}:${s}:${c}`}return!1}function Z(e,n){return e==null?n||null:typeof e=="function"?e(n):e}async function I(e,n,t){const r={tag:e,props:await v(typeof n=="object"&&typeof n!="function"&&!(n instanceof Promise)?{...n}:{[["script","noscript","style"].includes(e)?"innerHTML":"textContent"]:n},["templateParams","titleTemplate"].includes(e))};return M.forEach(i=>{const s=typeof r.props[i]<"u"?r.props[i]:t[i];typeof s<"u"&&((!["innerHTML","textContent","children"].includes(i)||_.includes(r.tag))&&(r[i==="children"?"innerHTML":i]=s),delete r.props[i])}),r.props.body&&(r.tagPosition="bodyClose",delete r.props.body),r.tag==="script"&&typeof r.innerHTML=="object"&&(r.innerHTML=JSON.stringify(r.innerHTML),r.props.type=r.props.type||"application/json"),Array.isArray(r.props.content)?r.props.content.map(i=>({...r,props:{...r.props,content:i}})):r}function W(e){return typeof e=="object"&&!Array.isArray(e)&&(e=Object.keys(e).filter(n=>e[n])),(Array.isArray(e)?e.join(" "):e).split(" ").filter(n=>n.trim()).filter(Boolean).join(" ")}async function v(e,n){for(const t of Object.keys(e)){if(t==="class"){e[t]=W(e[t]);continue}if(e[t]instanceof Promise&&(e[t]=await e[t]),!n&&!M.includes(t)){const r=String(e[t]),i=t.startsWith("data-");r==="true"||r===""?e[t]=i?"true":!0:e[t]||(i&&r==="false"?e[t]="false":delete e[t])}}return e}const U=10;async function ee(e){const n=[];return Object.entries(e.resolvedInput).filter(([t,r])=>typeof r<"u"&&$.includes(t)).forEach(([t,r])=>{const i=O(r);n.push(...i.map(s=>I(t,s,e)).flat())}),(await Promise.all(n)).flat().filter(Boolean).map((t,r)=>(t._e=e._i,e.mode&&(t._m=e.mode),t._p=(e._i<<U)+r,t))}const H={base:-10,title:10},C={critical:-80,high:-10,low:20};function te(e){let n=100;const t=e.tagPriority;return typeof t=="number"?t:(e.tag==="meta"?(e.props["http-equiv"]==="content-security-policy"&&(n=-30),e.props.charset&&(n=-20),e.props.name==="viewport"&&(n=-15)):e.tag==="link"&&e.props.rel==="preconnect"?n=20:e.tag in H&&(n=H[e.tag]),typeof t=="string"&&t in C?n+C[t]:n)}const ne=[{prefix:"before:",offset:-1},{prefix:"after:",offset:1}],re=["onload","onerror","onabort","onprogress","onloadstart"],m="%separator";function B(e,n,t){if(typeof e!="string"||!e.includes("%"))return e;function r(c){let d;return["s","pageTitle"].includes(c)?d=n.pageTitle:c.includes(".")?d=c.split(".").reduce((y,l)=>y&&y[l]||void 0,n):d=n[c],typeof d<"u"?(d||"").replace(/"/g,'\\"'):!1}let i=e;try{i=decodeURI(e)}catch{}return(i.match(/%(\w+\.+\w+)|%(\w+)/g)||[]).sort().reverse().forEach(c=>{const d=r(c.slice(1));typeof d=="string"&&(e=e.replace(new RegExp(`\\${c}(\\W|$)`,"g"),(y,l)=>`${d}${l}`).trim())}),e.includes(m)&&(e.endsWith(m)&&(e=e.slice(0,-m.length).trim()),e.startsWith(m)&&(e=e.slice(m.length).trim()),e=e.replace(new RegExp(`\\${m}\\s*\\${m}`,"g"),m),e=B(e,{separator:t},t)),e}async function N(e){const n={tag:e.tagName.toLowerCase(),props:await v(e.getAttributeNames().reduce((t,r)=>({...t,[r]:e.getAttribute(r)}),{})),innerHTML:e.innerHTML};return n._d=D(n),n}async function q(e,n={}){var A;const t=n.document||e.resolvedOptions.document;if(!t)return;const r={shouldRender:e.dirty,tags:[]};if(await e.hooks.callHook("dom:beforeRender",r),!r.shouldRender)return;const i=(await e.resolveTags()).map(o=>({tag:o,id:b.includes(o.tag)?w(o):o.tag,shouldRender:!0}));let s=e._dom;if(!s){s={elMap:{htmlAttrs:t.documentElement,bodyAttrs:t.body}};for(const o of["body","head"]){const a=(A=t==null?void 0:t[o])==null?void 0:A.children;for(const f of[...a].filter(p=>b.includes(p.tagName.toLowerCase())))s.elMap[f.getAttribute("data-hid")||w(await N(f))]=f}}s.pendingSideEffects={...s.sideEffects||{}},s.sideEffects={};function c(o,a,f){const p=`${o}:${a}`;s.sideEffects[p]=f,delete s.pendingSideEffects[p]}function d({id:o,$el:a,tag:f}){const p=f.tag.endsWith("Attrs");s.elMap[o]=a,p||(["textContent","innerHTML"].forEach(u=>{f[u]&&f[u]!==a[u]&&(a[u]=f[u])}),c(o,"el",()=>{s.elMap[o].remove(),delete s.elMap[o]})),Object.entries(f.props).forEach(([u,g])=>{const P=`attr:${u}`;if(u==="class")for(const h of(g||"").split(" ").filter(Boolean))p&&c(o,`${P}:${h}`,()=>a.classList.remove(h)),!a.classList.contains(h)&&a.classList.add(h);else a.getAttribute(u)!==g&&a.setAttribute(u,g===!0?"":String(g)),p&&c(o,P,()=>a.removeAttribute(u))})}const y=[],l={bodyClose:void 0,bodyOpen:void 0,head:void 0};for(const o of i){const{tag:a,shouldRender:f,id:p}=o;if(f){if(a.tag==="title"){t.title=a.textContent;continue}o.$el=o.$el||s.elMap[p],o.$el?d(o):b.includes(a.tag)&&y.push(o)}}for(const o of y){const a=o.tag.tagPosition||"head";o.$el=t.createElement(o.tag.tag),d(o),l[a]=l[a]||t.createDocumentFragment(),l[a].appendChild(o.$el)}for(const o of i)await e.hooks.callHook("dom:renderTag",o,t,c);l.head&&t.head.appendChild(l.head),l.bodyOpen&&t.body.insertBefore(l.bodyOpen,t.body.firstChild),l.bodyClose&&t.body.appendChild(l.bodyClose),Object.values(s.pendingSideEffects).forEach(o=>o()),e._dom=s,e.dirty=!1,await e.hooks.callHook("dom:rendered",{renders:i})}async function F(e,n={}){const t=n.delayFn||(r=>setTimeout(r,10));return e._domUpdatePromise=e._domUpdatePromise||new Promise(r=>t(async()=>{await q(e,n),delete e._domUpdatePromise,r()}))}function oe(e){return n=>{var r,i;const t=((i=(r=n.resolvedOptions.document)==null?void 0:r.head.querySelector('script[id="unhead:payload"]'))==null?void 0:i.innerHTML)||!1;return t&&n.push(JSON.parse(t)),{mode:"client",hooks:{"entries:updated":function(s){F(s,e)}}}}}const G=x.startsWith("3");function K(e){return typeof e=="function"?e():E(e)}function T(e,n=""){if(e instanceof Promise)return e;const t=K(e);return!e||!t?t:Array.isArray(t)?t.map(r=>T(r,n)):typeof t=="object"?Object.fromEntries(Object.entries(t).map(([r,i])=>r==="titleTemplate"||r.startsWith("on")?[r,E(i)]:[r,T(i,r)])):t}const V={hooks:{"entries:resolve":function(e){for(const n of e.entries)n.resolvedInput=T(n.input)}}},k="usehead";function J(e){return{install(t){G&&(t.config.globalProperties.$unhead=e,t.config.globalProperties.$head=e,t.provide(k,e))}}.install}function ie(e={}){e.domDelayFn=e.domDelayFn||(t=>S(()=>setTimeout(()=>t(),0)));const n=L(e);return n.use(V),n.install=J(n),n}export{oe as D,b as H,X as I,re as N,ne as S,te as a,ie as c,Y as d,R as h,ee as n,B as p,Z as r,D as t};
