import{_ as Y}from"./Table-CEy5VCRK.js";import{V as H,b as M,X as z,Y as N,_ as A,F as B,a as F,G as I,d as G}from"./element-plus-DEgQ78-a.js";import{p as V}from"./vueuse-CTCWISgP.js";import{b as O}from"./@vueuse-80B0Z04t.js";import{M as m,n as c,J as W}from"./index-CYWUNeU5.js";import{d as j,i as J,m as D,k as L,o as w,M as b,O as d,u as a,W as n,a as f,U as k,T as _,S as R}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./vue-router-MJGgZ6ro.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const P={class:"flex-center"},X={class:"dialog-footer"},Ue=j({__name:"index",setup(q){const v=J(),{width:g}=O(),e=D({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,eidt_index:0,select_list:[],data_list:[],only_trashed:!1,create_data:!1,show_dialog:!1}),h=D({id:void 0,exp:void 0,name:void 0,value:void 0,description:void 0}),r=L(()=>e.create_data?h:e.data_list[e.eidt_index]||h),i={initData:()=>{i.fetchData()},fetchData:async()=>{e.loading=1;const o=await m.all({page:e.page,limit:e.limit,order:"exp asc",onlyTrashed:e.only_trashed});o.code===200?(e.data_list=o.data.data,e.count=o.data.count,e.page_count=o.data.page):e.data_list=[],e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,i.fetchData()},handleSelect:o=>{e.select_list=[...o.map(t=>t.id)]},handleAdd:()=>{e.create_data=!0,e.show_dialog=!0},handleEdit:o=>{e.create_data=!1,e.eidt_index=o,e.show_dialog=!0},handleSave:()=>{e.create_data?i.handleCreate():i.handleUpdate()},handleCreate:async()=>{e.loading=2;const o=await m.create(r.value);c(o),e.loading=0,o.code===200&&(i.fetchData(),W(h),e.show_dialog=!1)},handleUpdate:async()=>{e.loading=2;const o=await m.update({...r.value});c(o),e.show_dialog=!1,e.loading=0},handleRestore:async(o,t)=>{t===-1?e.loading=4:e.loading_index=t;const s=await m.restore(o);c(s),e.data_list=e.data_list.filter(p=>!s.data.ids.includes(p.id)),e.loading_index=-1,e.loading=0},handleRemove:async o=>{const t=e.only_trashed?await m.delete(o):await m.remove(o);c(t),t.code===200&&(e.data_list=e.data_list.filter(s=>!t.data.ids.includes(s.id))),i.fetchData()},rowDblclick:o=>{e.select_list.includes(o.id)?e.select_list=e.select_list.filter(t=>t!==o.id):e.select_list.push(o.id),v.value.toggleRowSelection(o)}};return i.initData(),(o,t)=>{const s=H,p=M,S=z,T=N,x=A,u=B,y=F,U=I,$=G,E=Y;return w(),b(E,{class:"level-table-container",page:a(e).page,"onUpdate:page":t[6]||(t[6]=l=>a(e).page=l),limit:a(e).limit,"onUpdate:limit":t[7]||(t[7]=l=>a(e).limit=l),pageCount:a(e).page_count,"onUpdate:pageCount":t[8]||(t[8]=l=>a(e).page_count=l),isScreen:a(e).is_screen,"onUpdate:isScreen":t[9]||(t[9]=l=>a(e).is_screen=l),loading:a(e).loading,length:a(e).select_list.length,count:a(e).count,onlyTrashed:a(e).only_trashed,onHandleAdd:t[10]||(t[10]=l=>i.handleAdd()),onHandleRestore:t[11]||(t[11]=l=>i.handleRestore(a(e).select_list,-1)),onHandleRemove:t[12]||(t[12]=l=>i.handleRemove(a(e).select_list)),onGetTrash:t[13]||(t[13]=l=>i.getTrash()),onHandleRefresh:t[14]||(t[14]=l=>i.fetchData())},{default:d(()=>[n(T,{border:"",ref_key:"tableRef",ref:v,data:a(e).data_list,"empty-text":"",class:"w-100","max-height":a(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:i.handleSelect,onRowDblclick:i.rowDblclick},{default:d(()=>[n(s,{fixed:"",type:"selection",width:"45"}),n(s,{fixed:a(g)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),n(s,{prop:"name",label:"名称",width:"150","show-overflow-tooltip":""}),n(s,{prop:"value",label:"等级",width:"60",align:"center"}),n(s,{prop:"exp",label:"经验",width:"120",align:"center"}),n(s,{prop:"description","min-width":"300",label:"描述","show-overflow-tooltip":"",formatter:l=>l.description||"-"},null,8,["formatter"]),n(s,{prop:"update_time",sortable:"",label:"更新时间",width:"180"},{default:d(l=>[f("span",null,k(a(V)(l.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),n(s,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:d(l=>[f("span",null,k(a(V)(l.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),n(s,{fixed:a(g)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:140},{default:d(l=>[f("div",P,[a(e).only_trashed?R("",!0):(w(),b(p,{key:0,size:"small",type:"primary",plain:"",onClick:C=>i.handleEdit(l.$index)},{default:d(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),a(e).only_trashed?(w(),b(p,{key:1,onClick:C=>i.handleRestore([l.row.id],l.$index),size:"small",loading:a(e).loading_index===l.$index,type:"success",plain:""},{default:d(()=>[_(" 恢复 ")]),_:2},1032,["onClick","loading"])):R("",!0),n(S,{onConfirm:C=>i.handleRemove([l.row.id]),width:"180",title:a(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:d(()=>[n(p,{size:"small",type:"danger",plain:""},{default:d(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"]),n($,{modelValue:a(e).show_dialog,"onUpdate:modelValue":t[5]||(t[5]=l=>a(e).show_dialog=l),draggable:"",width:"95%",title:"编辑等级"},{footer:d(()=>[f("span",X,[n(p,{onClick:t[4]||(t[4]=l=>a(e).show_dialog=!1)},{default:d(()=>[_("取消")]),_:1}),n(p,{loading:a(e).loading===2,type:"primary",onClick:i.handleSave},{default:d(()=>[_(" 确认 ")]),_:1},8,["loading","onClick"])])]),default:d(()=>[n(U,{model:a(r),"label-position":a(g)<=768?"top":"left"},{default:d(()=>[n(u,{label:"等级"},{default:d(()=>[n(x,{class:"w-100",modelValue:a(r).value,"onUpdate:modelValue":t[0]||(t[0]=l=>a(r).value=l),placeholder:"等级"},null,8,["modelValue"])]),_:1}),n(u,{label:"经验"},{default:d(()=>[n(x,{class:"w-100",step:100,modelValue:a(r).exp,"onUpdate:modelValue":t[1]||(t[1]=l=>a(r).exp=l),placeholder:"所需经验"},null,8,["modelValue"])]),_:1}),n(u,{label:"名称"},{default:d(()=>[n(y,{modelValue:a(r).name,"onUpdate:modelValue":t[2]||(t[2]=l=>a(r).name=l),placeholder:"等级名称"},null,8,["modelValue"])]),_:1}),n(u,{label:"内容"},{default:d(()=>[n(y,{modelValue:a(r).description,"onUpdate:modelValue":t[3]||(t[3]=l=>a(r).description=l),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入标签描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Ue as default};
