import{_ as L}from"./Table-CEy5VCRK.js";import{V as K,f as M,g as B,b as F,X as N,Y as j,a as P,F as G,G as I,d as O}from"./element-plus-DEgQ78-a.js";import{_ as W}from"./CommonSelect-BPJDZPOW.js";import{p as R}from"./vueuse-CTCWISgP.js";import{b as J}from"./@vueuse-80B0Z04t.js";import{h as X}from"./options-BvRdR4NQ.js";import{L as p,F as q,U as Q,T as Z,n as y,J as ee}from"./index-CYWUNeU5.js";import{d as te,i as ae,m as U,k as le,bg as oe,o as c,M as w,O as i,u as a,W as s,a as g,c as se,aa as ie,a0 as ne,V as de,U as V,T as f,S as A}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./vue-router-MJGgZ6ro.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const re={class:"flex-yc"},ue={class:"flex-center"},pe={class:"dialog-footer"},We=te({__name:"index",setup(me){const D=ae(),{width:b}=J(),e=U({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,eidt_index:0,select_list:[],data_list:[],only_trashed:!1,create_data:!1,show_dialog:!1,auth_root_options:X,user_list:[],auth_pages_list:[],auth_rules_list:[],uids:[],pages:[],rules:[]}),k=U({id:void 0,key:void 0,name:void 0,root:0,type:void 0,uids:void 0,pages:void 0,rules:void 0,remark:void 0}),r=le(()=>e.create_data?k:e.data_list[e.eidt_index]||k),n={initData:()=>{n.fetchData(),n.getUserList(),n.getAuthPagesList(),n.getAuthRulesList()},fetchData:async()=>{e.loading=1;const o=await p.all({order:"create_time asc",page:e.page,limit:e.limit,onlyTrashed:e.only_trashed});o.code===200?(e.data_list=o.data.data,e.count=o.data.count,e.page_count=o.data.page):e.data_list=[],e.loading=0},getUserList:async()=>{const{code:o,data:t}=await q.column({field:"id,nickname",order:"nickname asc"});o===200&&(e.user_list=t)},getAuthPagesList:async()=>{const{code:o,data:t}=await Q.column({field:"hash,name",order:"name asc",where:'hash <> ""'});o===200&&(e.auth_pages_list=t,e.auth_pages_list.unshift({hash:"all",name:"所有页面"}))},getAuthRulesList:async()=>{const{code:o,data:t}=await Z.column({field:"hash,name",order:"name asc"});o===200&&(e.auth_rules_list=t,e.auth_rules_list.unshift({hash:"all",name:"所有规则"}))},getTrash:()=>{e.only_trashed=!e.only_trashed,n.fetchData()},handleSelect:o=>{e.select_list=[...o.map(t=>t.id)]},handleAdd:()=>{e.create_data=!0,e.show_dialog=!0},handleEdit:o=>{var d;e.create_data=!1,e.eidt_index=o;const t=e.data_list[o];t&&(e.uids=((d=t.uids.match(/\d+/g))==null?void 0:d.map(Number))||[],e.pages=t.pages?t.pages.split(","):[],e.rules=t.rules?t.rules.split(","):[]),e.show_dialog=!0},handleSave:()=>{r.value.uids=e.uids.length?`|${e.uids.join("|")}|`:"",r.value.pages=e.pages.includes("all")?"all":e.pages.join(","),r.value.rules=e.rules.includes("all")?"all":e.rules.join(","),e.create_data?n.handleCreate():n.handleUpdate()},handleCreate:async()=>{e.loading=2;const o=await p.create(r.value);y(o),e.loading=0,o.code===200&&(n.fetchData(),ee(k),e.show_dialog=!1)},handleUpdate:async()=>{e.loading=2;const o=await p.update({...r.value});y(o),e.show_dialog=!1,e.loading=0},handleRestore:async(o,t)=>{t===-1?e.loading=4:e.loading_index=t;const d=await p.restore(o);y(d),e.data_list=e.data_list.filter(x=>!d.data.ids.includes(x.id)),e.loading_index=-1,e.loading=0},handleRemove:async o=>{const t=e.only_trashed?await p.delete(o):await p.remove(o);y(t),t.code===200&&(e.data_list=e.data_list.filter(d=>!t.data.ids.includes(d.id))),n.fetchData()},rowDblclick:o=>{e.select_list.includes(o.id)?e.select_list=e.select_list.filter(t=>t!==o.id):e.select_list.push(o.id),D.value.toggleRowSelection(o)}};return oe(()=>{n.initData()}),(o,t)=>{const d=K,x=M,S=B,m=F,$=N,T=j,C=P,u=G,h=W,E=I,Y=O,z=L;return c(),w(z,{class:"auth-group-table-container",page:a(e).page,"onUpdate:page":t[9]||(t[9]=l=>a(e).page=l),limit:a(e).limit,"onUpdate:limit":t[10]||(t[10]=l=>a(e).limit=l),pageCount:a(e).page_count,"onUpdate:pageCount":t[11]||(t[11]=l=>a(e).page_count=l),isScreen:a(e).is_screen,"onUpdate:isScreen":t[12]||(t[12]=l=>a(e).is_screen=l),loading:a(e).loading,length:a(e).select_list.length,count:a(e).count,onlyTrashed:a(e).only_trashed,onHandleAdd:t[13]||(t[13]=l=>n.handleAdd()),onHandleRestore:t[14]||(t[14]=l=>n.handleRestore(a(e).select_list,-1)),onHandleRemove:t[15]||(t[15]=l=>n.handleRemove(a(e).select_list)),onGetTrash:t[16]||(t[16]=l=>n.getTrash()),onHandleRefresh:t[17]||(t[17]=l=>n.fetchData())},{default:i(()=>[s(T,{border:"",ref_key:"tableRef",ref:D,data:a(e).data_list,"empty-text":"",class:"w-100","max-height":a(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:n.handleSelect,onRowDblclick:n.rowDblclick},{default:i(()=>[s(d,{fixed:"",type:"selection",width:"45"}),s(d,{fixed:a(b)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),s(d,{prop:"name",label:"名称",width:"200","show-overflow-tooltip":""}),s(d,{prop:"key",label:"识别码",width:"130","show-overflow-tooltip":""}),s(d,{"min-width":"300",label:"成员"},{default:i(({row:l})=>{var _;return[g("div",re,[(c(!0),se(de,null,ie((_=l.result)==null?void 0:_.users,(v,H)=>(c(),w(S,{key:v.id,content:`@${v.nickname} ${v.account}`,placement:"top"},{default:i(()=>[s(x,{src:v.avatar,size:"small",class:"user-item flex-shrink-0",style:ne({"z-index":999-H})},null,8,["src","style"])]),_:2},1032,["content"]))),128))])]}),_:1}),s(d,{prop:"remark","min-width":"200",label:"备注","show-overflow-tooltip":"",formatter:l=>l.remark||"-"},null,8,["formatter"]),s(d,{prop:"update_time",sortable:"",label:"更新时间",width:"180"},{default:i(l=>[g("span",null,V(a(R)(l.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),s(d,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:i(l=>[g("span",null,V(a(R)(l.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),s(d,{fixed:a(b)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:140},{default:i(l=>[g("div",ue,[a(e).only_trashed?A("",!0):(c(),w(m,{key:0,size:"small",type:"primary",plain:"",onClick:_=>n.handleEdit(l.$index)},{default:i(()=>[f(" 编辑 ")]),_:2},1032,["onClick"])),a(e).only_trashed?(c(),w(m,{key:1,onClick:_=>n.handleRestore([l.row.id],l.$index),size:"small",loading:a(e).loading_index===l.$index,type:"success",plain:""},{default:i(()=>[f(" 恢复 ")]),_:2},1032,["onClick","loading"])):A("",!0),s($,{onConfirm:_=>n.handleRemove([l.row.id]),width:"180",title:a(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:i(()=>[s(m,{size:"small",type:"danger",plain:""},{default:i(()=>[f(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"]),s(Y,{modelValue:a(e).show_dialog,"onUpdate:modelValue":t[8]||(t[8]=l=>a(e).show_dialog=l),draggable:"",width:"95%",title:"编辑权限分组"},{footer:i(()=>[g("span",pe,[s(m,{onClick:t[7]||(t[7]=l=>a(e).show_dialog=!1)},{default:i(()=>[f("取消")]),_:1}),s(m,{loading:a(e).loading===2,type:"primary",onClick:n.handleSave},{default:i(()=>[f(" 确认 ")]),_:1},8,["loading","onClick"])])]),default:i(()=>[s(E,{model:a(r),"label-width":"50","label-position":a(b)<=768?"top":"left"},{default:i(()=>[s(u,{label:"名称"},{default:i(()=>[s(C,{modelValue:a(r).name,"onUpdate:modelValue":t[0]||(t[0]=l=>a(r).name=l),placeholder:"权限分组名称"},null,8,["modelValue"])]),_:1}),s(u,{label:"Key"},{default:i(()=>[s(C,{modelValue:a(r).key,"onUpdate:modelValue":t[1]||(t[1]=l=>a(r).key=l),placeholder:"分组唯一识别码"},null,8,["modelValue"])]),_:1}),s(u,{label:"权限"},{default:i(()=>[s(h,{value:a(r).root,"onUpdate:value":t[2]||(t[2]=l=>a(r).root=l),options:a(e).auth_root_options},null,8,["value","options"])]),_:1}),s(u,{label:"成员"},{default:i(()=>[s(h,{value:a(e).uids,"onUpdate:value":t[3]||(t[3]=l=>a(e).uids=l),options:a(e).user_list,labelKey:"nickname",valueKey:"id",multiple:""},null,8,["value","options"])]),_:1}),s(u,{label:"页面"},{default:i(()=>[s(h,{value:a(e).pages,"onUpdate:value":t[4]||(t[4]=l=>a(e).pages=l),options:a(e).auth_pages_list,labelKey:"name",valueKey:"hash",multiple:""},null,8,["value","options"])]),_:1}),s(u,{label:"规则"},{default:i(()=>[s(h,{value:a(e).rules,"onUpdate:value":t[5]||(t[5]=l=>a(e).rules=l),options:a(e).auth_rules_list,labelKey:"name",valueKey:"hash",multiple:""},null,8,["value","options"])]),_:1}),s(u,{label:"备注"},{default:i(()=>[s(C,{modelValue:a(r).remark,"onUpdate:modelValue":t[6]||(t[6]=l=>a(r).remark=l),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入标签描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{We as default};
