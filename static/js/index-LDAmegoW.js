import{_ as F}from"./Table-CEy5VCRK.js";import{V as P,f as j,i as K,b as L,X as O,Y as W,a as q,F as J,G as X,d as Q}from"./element-plus-DEgQ78-a.js";import{_ as Z}from"./CommonSelect-BPJDZPOW.js";import{_ as ee}from"./InputUpload.vue_vue_type_style_index_0_lang-B-6SKlPI.js";import{l as te,F as g,L as V,n as w,J as ae,k as le}from"./index-CYWUNeU5.js";import{p as C}from"./vueuse-CTCWISgP.js";import{u as oe}from"./vue-router-MJGgZ6ro.js";import{b as ne}from"./@vueuse-80B0Z04t.js";import{g as ie}from"./options-BvRdR4NQ.js";import{d as de,i as se,m as E,k as re,ar as pe,o as _,M as v,O as i,u as l,W as o,P as me,c as ue,a as h,U as b,T as m,S as $}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const _e={class:"flex-yc g-2"},ce={class:"flex-center"},fe={class:"dialog-footer"},Ze=de({__name:"index",setup(ge){const T=te(),Y=oe(),D=se(),{width:y}=ne(),e=E({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,eidt_index:0,select_list:[],data_list:[],only_trashed:!1,create_data:!1,show_dialog:!1,group_optins:[],gender_options:ie}),U=E({id:void 0,email:void 0,title:void 0,gender:void 0,avatar:void 0,remark:void 0,account:void 0,password:void 0,nickname:void 0,description:void 0,auth_ids:[]}),d=re(()=>{var a,s;const n=e.data_list[e.eidt_index];return n.auth_ids=((s=(a=n==null?void 0:n.result.auth)==null?void 0:a.group)==null?void 0:s.ids)||[],e.create_data||!n?U:n}),r={initData:()=>{r.fetchData(),r.getAuthGroup()},fetchData:async()=>{e.loading=1;const n=await g.all({order:"create_time asc",page:e.page,limit:e.limit,onlyTrashed:e.only_trashed});n.code===200?(e.data_list=n.data.data,e.count=n.data.count,e.page_count=n.data.page):e.data_list=[],e.loading=0},getAuthGroup:async()=>{const n=await V.column({field:"id,name"});n.code===200&&(e.group_optins=n.data)},getTrash:()=>{e.only_trashed=!e.only_trashed,r.fetchData()},handleSelect:n=>{e.select_list=[...n.map(a=>a.id)]},handleAdd:()=>{e.create_data=!0,e.show_dialog=!0},handleEdit:n=>{e.create_data=!1,e.eidt_index=n,e.show_dialog=!0},handleSave:()=>{e.create_data?r.handleCreate():r.handleUpdate()},handleCreate:async()=>{e.loading=2;const n=await g.create(d.value);w(n),e.loading=0,n.code===200&&(await V.uids({uid:n.data.id,ids:d.value.auth_ids}),r.fetchData(),ae(U),e.show_dialog=!1)},handleUpdate:async()=>{e.loading=2;const n=await g.update({...d.value});w(n),n.code===200&&await V.uids({uid:d.value.id,ids:d.value.auth_ids}),e.show_dialog=!1,e.loading=0},handleRestore:async(n,a)=>{a===-1?e.loading=4:e.loading_index=a;const s=await g.restore(n);w(s),e.data_list=e.data_list.filter(k=>!s.data.ids.includes(k.id)),e.loading_index=-1,e.loading=0},handleRemove:async n=>{const a=e.only_trashed?await g.delete(n):await g.remove(n);w(a),a.code===200&&(e.data_list=e.data_list.filter(s=>!a.data.ids.includes(s.id))),r.fetchData()},rowDblclick:n=>{e.select_list.includes(n.id)?e.select_list=e.select_list.filter(a=>a!==n.id):e.select_list.push(n.id),D.value.toggleRowSelection(n)}};return r.initData(),(n,a)=>{const s=P,k=j,z=le,x=K,c=L,A=O,H=W,u=q,p=J,M=ee,R=Z,I=X,N=Q,B=F,G=pe("imgbox");return _(),v(B,{class:"users-table-container",page:l(e).page,"onUpdate:page":a[12]||(a[12]=t=>l(e).page=t),limit:l(e).limit,"onUpdate:limit":a[13]||(a[13]=t=>l(e).limit=t),pageCount:l(e).page_count,"onUpdate:pageCount":a[14]||(a[14]=t=>l(e).page_count=t),isScreen:l(e).is_screen,"onUpdate:isScreen":a[15]||(a[15]=t=>l(e).is_screen=t),loading:l(e).loading,length:l(e).select_list.length,count:l(e).count,onlyTrashed:l(e).only_trashed,onHandleAdd:a[16]||(a[16]=t=>r.handleAdd()),onHandleRestore:a[17]||(a[17]=t=>r.handleRestore(l(e).select_list,-1)),onHandleRemove:a[18]||(a[18]=t=>r.handleRemove(l(e).select_list)),onGetTrash:a[19]||(a[19]=t=>r.getTrash()),onHandleRefresh:a[20]||(a[20]=t=>r.fetchData())},{default:i(()=>[o(H,{border:"",ref_key:"tableRef",ref:D,data:l(e).data_list,"empty-text":"",class:"w-100","max-height":l(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:r.handleSelect,onRowDblclick:r.rowDblclick},{default:i(()=>[o(s,{fixed:"",type:"selection",width:"45"}),o(s,{fixed:l(y)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),o(s,{prop:"name",label:"昵称",width:"200","show-overflow-tooltip":""},{default:i(({row:t})=>[me((_(),ue("div",_e,[o(k,{shape:"square",src:t.avatar,size:24},null,8,["src"]),h("span",null,b(t.nickname),1)])),[[G]])]),_:1}),o(s,{width:"100",label:"账号","show-overflow-tooltip":"",formatter:t=>t.account||"-"},null,8,["formatter"]),o(s,{prop:"title",width:"150",label:"等级"},{default:i(({row:t})=>{var f,S;return[o(z,{size:16,name:(f=t.result.level)==null?void 0:f.current.name,value:(S=t.result.level)==null?void 0:S.current.value},null,8,["name","value"])]}),_:1}),o(s,{width:"180",label:"邮箱","show-overflow-tooltip":"",formatter:t=>t.email||"-"},null,8,["formatter"]),o(s,{align:"center",width:"60",label:"性别"},{default:i(({row:t})=>[t.gender==="boy"?(_(),v(x,{key:0,effect:"dark",size:"small",color:"#1591fa"},{default:i(()=>[m("男")]),_:1})):t.gender==="girl"?(_(),v(x,{key:1,effect:"dark",size:"small",color:"#f74066"},{default:i(()=>[m("女")]),_:1})):(_(),v(x,{key:2,effect:"dark",size:"small",type:"info"},{default:i(()=>[m("密")]),_:1}))]),_:1}),o(s,{prop:"exp",width:"100",label:"经验"}),o(s,{prop:"update_time",sortable:"",label:"上次登录",width:"180"},{default:i(t=>[h("span",null,b(l(C)(t.row.login_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(s,{prop:"update_time",sortable:"",label:"更新时间",width:"180"},{default:i(t=>[h("span",null,b(l(C)(t.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(s,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:i(t=>[h("span",null,b(l(C)(t.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(s,{fixed:l(y)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:180},{default:i(t=>[h("div",ce,[o(c,{size:"small",type:"success",plain:"",onClick:f=>l(Y).push({name:"admin-manage-user-detail",params:{id:t.row.id}})},{default:i(()=>[m(" 详情 ")]),_:2},1032,["onClick"]),l(e).only_trashed?$("",!0):(_(),v(c,{key:0,size:"small",type:"primary",plain:"",onClick:f=>r.handleEdit(t.$index)},{default:i(()=>[m(" 编辑 ")]),_:2},1032,["onClick"])),l(e).only_trashed?(_(),v(c,{key:1,onClick:f=>r.handleRestore([t.row.id],t.$index),size:"small",loading:l(e).loading_index===t.$index,type:"success",plain:""},{default:i(()=>[m(" 恢复 ")]),_:2},1032,["onClick","loading"])):$("",!0),o(A,{onConfirm:f=>r.handleRemove([t.row.id]),width:"180",title:l(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:i(()=>[o(c,{size:"small",type:"danger",plain:""},{default:i(()=>[m(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"]),o(N,{modelValue:l(e).show_dialog,"onUpdate:modelValue":a[11]||(a[11]=t=>l(e).show_dialog=t),draggable:"","align-center":"",width:"95%",title:"编辑用户"},{footer:i(()=>[h("span",fe,[o(c,{onClick:a[10]||(a[10]=t=>l(e).show_dialog=!1)},{default:i(()=>[m("取消")]),_:1}),o(c,{loading:l(e).loading===2,type:"primary",onClick:r.handleSave},{default:i(()=>[m(" 确认 ")]),_:1},8,["loading","onClick"])])]),default:i(()=>[o(I,{model:l(d),"label-position":l(y)<=768?"top":"left"},{default:i(()=>[o(p,{label:"昵称"},{default:i(()=>[o(u,{modelValue:l(d).nickname,"onUpdate:modelValue":a[0]||(a[0]=t=>l(d).nickname=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),o(p,{label:"账号"},{default:i(()=>[o(u,{modelValue:l(d).account,"onUpdate:modelValue":a[1]||(a[1]=t=>l(d).account=t),placeholder:"不少于4字符"},null,8,["modelValue"])]),_:1}),o(p,{label:"头像"},{default:i(()=>[o(M,{accept:[".jpg",".png",".jpeg",".svg",".webp"],path:`${l(T).env.INIS_APP_THEME_NAME}/user`,value:l(d).avatar,"onUpdate:value":a[2]||(a[2]=t=>l(d).avatar=t)},null,8,["accept","path","value"])]),_:1}),o(p,{label:"邮箱"},{default:i(()=>[o(u,{modelValue:l(d).email,"onUpdate:modelValue":a[3]||(a[3]=t=>l(d).email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),o(p,{label:"密码"},{default:i(()=>[o(u,{modelValue:l(d).password,"onUpdate:modelValue":a[4]||(a[4]=t=>l(d).password=t),placeholder:"为空则不修改"},null,8,["modelValue"])]),_:1}),o(p,{label:"头衔"},{default:i(()=>[o(u,{modelValue:l(d).title,"onUpdate:modelValue":a[5]||(a[5]=t=>l(d).title=t),placeholder:"用户专属头衔"},null,8,["modelValue"])]),_:1}),o(p,{label:"性别"},{default:i(()=>[o(R,{value:l(d).gender,"onUpdate:value":a[6]||(a[6]=t=>l(d).gender=t),options:l(e).gender_options},null,8,["value","options"])]),_:1}),o(p,{label:"权限"},{default:i(()=>[o(R,{valueKey:"id",labelKey:"name",multiple:"",value:l(d).auth_ids,"onUpdate:value":a[7]||(a[7]=t=>l(d).auth_ids=t),options:l(e).group_optins},null,8,["value","options"])]),_:1}),o(p,{label:"简介"},{default:i(()=>[o(u,{modelValue:l(d).description,"onUpdate:modelValue":a[8]||(a[8]=t=>l(d).description=t),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入简介"},null,8,["modelValue"])]),_:1}),o(p,{label:"备注"},{default:i(()=>[o(u,{modelValue:l(d).remark,"onUpdate:modelValue":a[9]||(a[9]=t=>l(d).remark=t),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Ze as default};
