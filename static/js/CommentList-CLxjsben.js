import{d as he,w as ye,m as oe,x as de,y as re,z as ge,_ as ke,h as xe}from"./index-CYWUNeU5.js";import{_ as we}from"./CommentInput-CLsnyAEF.js";import{d as _e,bE as Ce,o as l,c as n,a,U as r,i as $e,m as Te,w as Se,bg as Ie,b as ze,W as c,al as Re,u as t,O as ce,V as x,aa as pe,M as T,S as d,Q as ue,P as be,X as He,bn as Le,bl as Ve}from"./@vue-AVcRlItG.js";import{e as je,f as qe}from"./element-plus-DEgQ78-a.js";import{a as De}from"./@vueuse-80B0Z04t.js";import{u as Me,a as Ae}from"./vue-router-MJGgZ6ro.js";const Ee={class:"level-icon-wrapper no-select pr overhide"},Be={class:"flex-yc white-color overhide"},Ne={class:"level-value flex-yc"},Oe=_e({__name:"LevelTitle",props:{size:{default:18},value:{default:"作者"}},setup(h){Ce(g=>({fab6782e:`${w.size}px`,"37e4456a":`${w.size*.6}px`}));const w=h;return(g,z)=>(l(),n("div",Ee,[a("div",Be,[a("div",Ne,[a("span",null,r(g.value),1)])])]))}}),Fe=he(Oe,[["__scopeId","data-v-62670e99"]]),u=h=>(Le("data-v-1241ed29"),h=h(),Ve(),h),Pe={class:"comment-list-wrapper"},Qe=["id"],Ue={class:"flex g-2"},We={class:"comment-info-wrap w-100"},Xe=["onClick"],Ge={class:"title-color theme-hover fs-15"},Je=["innerHTML"],Ke={class:"flex-yc fs-12 no-select muted-color mb-2 g-1"},Ye=["onClick"],Ze=u(()=>a("span",null,"·",-1)),me=u(()=>a("span",null,"·",-1)),es={key:0},ss={key:1},ts={key:1,class:"comment-reply-list"},as=["id"],is={class:"flex-yc"},ls={class:"flex-yc g-1"},ns=["onClick"],os={class:"flex-yc g-1"},ds=["onClick"],rs=["innerHTML"],cs={class:"flex-yc fs-12 no-select muted-color mb-2 g-1"},ps=["onClick"],us=u(()=>a("span",null,"·",-1)),hs=u(()=>a("span",null,"·",-1)),_s={key:0},fs={key:1},vs=["onClick"],ys=["onClick"],gs=u(()=>a("span",null,"收起评论",-1)),ks={key:0,class:"split-line mb-2"},xs={class:"loading-wrap flex-yc flex-center my-2 fs-12 muted-color"},ws=u(()=>a("span",null,"加载中...",-1)),Cs={key:0,class:"my-2 flex-yc flex-center fs-12 muted-color"},$s=u(()=>a("div",{class:"split"},null,-1)),Ts=u(()=>a("span",{class:"mx-1"},"我是有底线的",-1)),Ss=u(()=>a("div",{class:"split"},null,-1)),Is=[$s,Ts,Ss],zs=_e({__name:"CommentList",props:{bindId:{},bindType:{},uid:{}},setup(h,{expose:w}){const g=h,{arrivedState:z}=De(window),k=Me(),C=Ae(),_=$e([]),s=Te({pid:0,page:1,limit:12,count:0,all_page:1,loading:!1,data:null}),p={fetchData:async()=>{s.pid=0;const{code:o,data:f}=await ye.flat({page:s.page,limit:s.limit,bind_id:g.bindId,bind_type:g.bindType});o===200?(s.data||(s.data=[]),s.data=s.data.concat(f.data),s.count=f.count,s.all_page=f.page):s.data=s.data||[]},findReply:(o,f,$)=>{const v=$.find(S=>S.id===o);return v&&v.uid!==f?v:null},handleRefresh:()=>{s.data=[],s.page=1,s.all_page=1,s.count=0,p.fetchData()}};return Se(z,async o=>{o.bottom&&(s.page+=1,s.loading=!0,s.page<=s.all_page&&await p.fetchData(),s.loading=!1)}),w({refresh:p.handleRefresh}),Ie(()=>{setTimeout(()=>{if(C.query.id){const o=document.querySelector(`#${C.query.id}`);o&&o.scrollIntoView({behavior:"smooth"})}},500)}),ze(()=>{setTimeout(()=>{if(C.query.id){const o=document.querySelector(`#${C.query.id}`);o&&o.scrollIntoView({behavior:"smooth"})}},500)}),p.fetchData(),(o,f)=>{const $=je,v=qe,S=Fe,fe=ge,y=ke,R=we,ve=xe;return l(),n("div",Pe,[c($,{animated:"",throttle:200,loading:t(s).data===null},Re({template:ce(()=>[c($,{rows:8})]),_:2},[t(s).data?{name:"default",fn:ce(()=>[t(s).data.length?(l(),n(x,{key:0},[(l(!0),n(x,null,pe(t(s).data,(e,b)=>{var H,L,V,j,q,D,M,A,E,B,N,O,F,P,Q,U,W;return l(),n("div",{class:"comment-item-wrap",id:`article-comment-${e.id}`,key:b},[a("div",Ue,[c(v,{class:"flex-shrink-0 curp",onClick:i=>t(k).push({name:"front-user-detail",params:{id:e.uid}}),src:(L=(H=e.result)==null?void 0:H.author)==null?void 0:L.avatar,size:32},null,8,["onClick","src"]),a("div",We,[a("div",{class:"flex-yc g-1 theme-hover curp w-fit",onClick:i=>t(k).push({name:"front-user-detail",params:{id:e.uid}})},[a("span",Ge,r(((j=(V=e.result)==null?void 0:V.author)==null?void 0:j.nickname)||"未知用户"),1),(e==null?void 0:e.uid)===o.uid?(l(),T(S,{key:0,size:14,value:"作者"})):d("",!0),c(fe,{size:14,value:((E=(A=(M=(D=(q=e==null?void 0:e.result)==null?void 0:q.author)==null?void 0:D.result)==null?void 0:M.level)==null?void 0:A.current)==null?void 0:E.value)||0},null,8,["value"])],8,Xe),a("div",{class:"comment-content article-content",innerHTML:t(oe)(e.content)},null,8,Je),a("div",Ke,[a("span",{class:ue(["theme-hover flex-yc curp hvco",{"theme-color":t(s).pid===e.id}]),onClick:i=>t(s).pid=t(s).pid===e.id?0:e.id},[c(y,{size:"14",name:"reply-line"}),a("span",null,r(t(s).pid===e.id?"取消回复":"回复"),1)],10,Ye),Ze,a("span",null,r(t(de)(e.create_time||0)),1),me,a("span",null,r(t(re)(e.agent)||"未知设备"),1),(B=e.json)!=null&&B.area?(l(),n("span",es,"·")):d("",!0),(N=e.json)!=null&&N.area?(l(),n("span",ss,r((O=e.json)==null?void 0:O.area),1)):d("",!0)]),t(s).pid===e.id?(l(),T(R,{key:0,class:"mb-3",onHandleSend:p.handleRefresh,placeholderText:`回复 ${((P=(F=e.result)==null?void 0:F.author)==null?void 0:P.nickname)||"未知用户"}:`,focus:!0,pid:e.id,"bind-id":o.bindId,"bind-type":o.bindType},null,8,["onHandleSend","placeholderText","pid","bind-id","bind-type"])):d("",!0),e.replies&&e.replies.length?(l(),n("div",ts,[(l(!0),n(x,null,pe(e.replies,(i,X)=>{var G,J,K,Y,Z,m,ee,se,te,ae,ie,le;return l(),n("div",{class:"comment-item-wrap",id:`article-comment-${i.id}`,key:X},[X<2||t(_).includes(e.id)?(l(),n(x,{key:0},[a("div",is,[a("div",ls,[c(v,{onClick:I=>t(k).push({name:"front-user-detail",params:{id:i.uid}}),class:"flex-shrink-0 curp",src:(J=(G=i.result)==null?void 0:G.author)==null?void 0:J.avatar,size:18},null,8,["onClick","src"]),a("span",{onClick:I=>t(k).push({name:"front-user-detail",params:{id:i.uid}}),class:"title-color theme-hover curp flex-yc fs-14 light-text"},r(((Y=(K=i.result)==null?void 0:K.author)==null?void 0:Y.nickname)||"未知用户"),9,ns)]),e.id!==i.pid&&p.findReply(i.pid,i.uid,e.replies)?(l(),n(x,{key:0},[c(y,{name:"arrow-right-s-fill",color:"var(--light-text)"}),a("div",os,[a("span",{onClick:I=>{var ne;return t(k).push({name:"front-user-detail",params:{id:(ne=p.findReply(i.pid,i.uid,e.replies))==null?void 0:ne.uid}})},class:"title-color flex-yc theme-hover curp fs-14 light-text"},r(((ee=(m=(Z=p.findReply(i.pid,i.uid,e.replies))==null?void 0:Z.result)==null?void 0:m.author)==null?void 0:ee.nickname)||"未知用户"),9,ds)])],64)):d("",!0)]),a("div",{class:"comment-content article-content",innerHTML:t(oe)(i.content)},null,8,rs),a("div",cs,[a("span",{class:ue(["theme-hover flex-yc curp hvco",{"theme-color":t(s).pid===i.id}]),onClick:I=>t(s).pid=t(s).pid===i.id?0:i.id},[c(y,{size:"14",name:"reply-line"}),a("span",null,r(t(s).pid===i.id?"取消回复":"回复"),1)],10,ps),us,a("span",null,r(t(de)(i.create_time||0)),1),hs,a("span",null,r(t(re)(i.agent)||"未知设备"),1),(se=i.json)!=null&&se.area?(l(),n("span",_s,"·")):d("",!0),(te=i.json)!=null&&te.area?(l(),n("span",fs,r((ae=i.json)==null?void 0:ae.area),1)):d("",!0)]),t(s).pid===i.id?(l(),T(R,{key:0,class:"mb-3",onHandleSend:p.handleRefresh,placeholderText:`回复 ${((le=(ie=i.result)==null?void 0:ie.author)==null?void 0:le.nickname)||"未知用户"}:`,focus:!0,pid:i.id,"bind-id":o.bindId,"bind-type":o.bindType},null,8,["onHandleSend","placeholderText","pid","bind-id","bind-type"])):d("",!0)],64)):d("",!0)],8,as)}),128)),!t(_).includes(e.id)&&((Q=e.replies)==null?void 0:Q.length)>2?(l(),n("div",{key:0,style:{width:"fit-content"},class:"light-text fs-14 theme-hover curp mb-2 flex-yc",onClick:i=>t(_).push(e.id)},[a("span",null,"查看全部"+r(((U=e.replies)==null?void 0:U.length)||0)+"条回复",1),c(y,{name:"arrow-down-s-line"})],8,vs)):d("",!0),t(_).includes(e.id)&&((W=e.replies)==null?void 0:W.length)>2?(l(),n("div",{key:1,style:{width:"fit-content"},class:"light-text mt-2 fs-14 theme-hover curp mb-1 flex-yc",onClick:i=>t(_).splice(t(_).indexOf(e.id),1)},[gs,c(y,{name:"arrow-up-s-line"})],8,ys)):d("",!0)])):d("",!0)])]),b!==t(s).data.length-1?(l(),n("div",ks)):d("",!0)],8,Qe)}),128)),be(a("div",xs,[c(y,{name:"loader-2-line ",size:"14",class:"mr5 spinner"}),ws],512),[[He,t(s).loading]]),t(s).page>t(s).all_page?(l(),n("div",Cs,Is)):d("",!0)],64)):(l(),T(ve,{key:1,text:"暂无评论数据，快来抢占沙发!"}))]),key:"0"}:void 0]),1032,["loading"])])}}}),qs=he(zs,[["__scopeId","data-v-1241ed29"]]);export{qs as _};
