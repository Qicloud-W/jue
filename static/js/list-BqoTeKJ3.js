import{_ as M}from"./Table-CEy5VCRK.js";import{V as A,b as B,X as N,Y as j,a as F,F as G,G as I,d as O}from"./element-plus-DEgQ78-a.js";import{_ as P}from"./InputUpload.vue_vue_type_style_index_0_lang-B-6SKlPI.js";import{p as R}from"./vueuse-CTCWISgP.js";import{u as W}from"./vue-router-MJGgZ6ro.js";import{b as J}from"./@vueuse-80B0Z04t.js";import{s as u,n as h,J as X}from"./index-CYWUNeU5.js";import{d as q,i as K,m as V,k as L,ar as Q,o as w,M as v,O as n,u as l,W as o,a as c,P as Z,U as b,T as _,S as C}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const ee={class:"flex-center"},te=["src"],ae={class:"flex-center"},le={class:"dialog-footer"},Ne=q({__name:"list",setup(oe){const $=W(),D=K(),{width:y}=J(),e=V({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,eidt_index:0,select_list:[],data_list:[],only_trashed:!1,create_data:!1,show_dialog:!1}),x=V({id:void 0,name:void 0,covers:void 0,remark:void 0,description:void 0}),r=L(()=>e.create_data?x:e.data_list[e.eidt_index]||x),s={initData:()=>{s.fetchData()},fetchData:async()=>{e.loading=1;const i=await u.all({page:e.page,limit:e.limit,onlyTrashed:e.only_trashed});i.code===200?(e.data_list=i.data.data,e.count=i.data.count,e.page_count=i.data.page):e.data_list=[],e.loading=0},getTrash:()=>{e.only_trashed=!e.only_trashed,s.fetchData()},handleSelect:i=>{e.select_list=[...i.map(a=>a.id)]},handleAdd:()=>{e.create_data=!0,e.show_dialog=!0},handleEdit:i=>{e.create_data=!1,e.eidt_index=i,e.show_dialog=!0},handleSave:()=>{e.create_data?s.handleCreate():s.handleUpdate()},handleCreate:async()=>{e.loading=2;const i=await u.create(r.value);h(i),e.loading=0,i.code===200&&(s.fetchData(),X(x),e.show_dialog=!1)},handleUpdate:async()=>{e.loading=2;const i=await u.update({...r.value});h(i),e.show_dialog=!1,e.loading=0},handleRestore:async(i,a)=>{a===-1?e.loading=4:e.loading_index=a;const d=await u.restore(i);h(d),e.data_list=e.data_list.filter(p=>!d.data.ids.includes(p.id)),e.loading_index=-1,e.loading=0},handleRemove:async i=>{const a=e.only_trashed?await u.delete(i):await u.remove(i);h(a),a.code===200&&(e.data_list=e.data_list.filter(d=>!a.data.ids.includes(d.id))),s.fetchData()},rowDblclick:i=>{e.select_list.includes(i.id)?e.select_list=e.select_list.filter(a=>a!==i.id):e.select_list.push(i.id),D.value.toggleRowSelection(i)}};return s.initData(),(i,a)=>{const d=A,p=B,S=N,U=j,k=F,g=G,T=P,E=I,Y=O,H=M,z=Q("imgbox");return w(),v(H,{class:"album-group-table-container",page:l(e).page,"onUpdate:page":a[6]||(a[6]=t=>l(e).page=t),limit:l(e).limit,"onUpdate:limit":a[7]||(a[7]=t=>l(e).limit=t),pageCount:l(e).page_count,"onUpdate:pageCount":a[8]||(a[8]=t=>l(e).page_count=t),isScreen:l(e).is_screen,"onUpdate:isScreen":a[9]||(a[9]=t=>l(e).is_screen=t),loading:l(e).loading,length:l(e).select_list.length,count:l(e).count,onlyTrashed:l(e).only_trashed,onHandleAdd:a[10]||(a[10]=t=>s.handleAdd()),onHandleRestore:a[11]||(a[11]=t=>s.handleRestore(l(e).select_list,-1)),onHandleRemove:a[12]||(a[12]=t=>s.handleRemove(l(e).select_list)),onGetTrash:a[13]||(a[13]=t=>s.getTrash()),onHandleRefresh:a[14]||(a[14]=t=>s.fetchData())},{default:n(()=>[o(U,{border:"",ref_key:"tableRef",ref:D,data:l(e).data_list,"empty-text":"",class:"w-100","max-height":l(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:s.handleSelect,onRowDblclick:s.rowDblclick},{default:n(()=>[o(d,{fixed:"",type:"selection",width:"45"}),o(d,{fixed:l(y)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),o(d,{prop:"name",label:"名称",width:"150","show-overflow-tooltip":""}),o(d,{width:"80","class-name":"cover-item",label:"封面",align:"center"},{default:n(({row:t})=>[c("div",ee,[Z(c("img",{class:"curp",src:t.covers.split(",")[0]},null,8,te),[[z]])])]),_:1}),o(d,{label:"数量",width:"80",align:"center"},{default:n(({row:t})=>{var m,f;return[c("span",null,b(((f=(m=t.result)==null?void 0:m.album)==null?void 0:f.count)||0),1)]}),_:1}),o(d,{label:"浏览",width:"80",align:"center"},{default:n(({row:t})=>{var m,f;return[c("span",null,b(((f=(m=t.result)==null?void 0:m.album)==null?void 0:f.views)||0),1)]}),_:1}),o(d,{prop:"description","min-width":"250",label:"描述","show-overflow-tooltip":"",formatter:t=>t.description||"-"},null,8,["formatter"]),o(d,{prop:"remark","min-width":"200",label:"备注","show-overflow-tooltip":"",formatter:t=>t.remark||"-"},null,8,["formatter"]),o(d,{prop:"update_time",sortable:"",label:"更新时间",width:"180"},{default:n(t=>[c("span",null,b(l(R)(t.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(d,{prop:"create_time",sortable:"",width:"180",label:"创建时间"},{default:n(t=>[c("span",null,b(l(R)(t.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),o(d,{fixed:l(y)<=768?!1:"right",align:"center",label:"操作","class-name":"center",width:190},{default:n(t=>[c("div",ae,[l(e).only_trashed?C("",!0):(w(),v(p,{key:0,size:"small",type:"success",plain:"",onClick:m=>l($).push({name:"admin-album-detail",params:{id:t.row.id}})},{default:n(()=>[_(" 详情 ")]),_:2},1032,["onClick"])),l(e).only_trashed?C("",!0):(w(),v(p,{key:1,size:"small",type:"primary",plain:"",onClick:m=>s.handleEdit(t.$index)},{default:n(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),l(e).only_trashed?(w(),v(p,{key:2,onClick:m=>s.handleRestore([t.row.id],t.$index),size:"small",loading:l(e).loading_index===t.$index,type:"success",plain:""},{default:n(()=>[_(" 恢复 ")]),_:2},1032,["onClick","loading"])):C("",!0),o(S,{onConfirm:m=>s.handleRemove([t.row.id]),width:"180",title:l(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:n(()=>[o(p,{size:"small",type:"danger",plain:""},{default:n(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"]),o(Y,{modelValue:l(e).show_dialog,"onUpdate:modelValue":a[5]||(a[5]=t=>l(e).show_dialog=t),draggable:"",width:"95%",title:"编辑相册"},{footer:n(()=>[c("span",le,[o(p,{onClick:a[4]||(a[4]=t=>l(e).show_dialog=!1)},{default:n(()=>[_("取消")]),_:1}),o(p,{loading:l(e).loading===2,type:"primary",onClick:s.handleSave},{default:n(()=>[_(" 确认 ")]),_:1},8,["loading","onClick"])])]),default:n(()=>[o(E,{model:l(r),"label-position":l(y)<=768?"top":"left"},{default:n(()=>[o(g,{label:"名称"},{default:n(()=>[o(k,{modelValue:l(r).name,"onUpdate:modelValue":a[0]||(a[0]=t=>l(r).name=t),placeholder:"名称"},null,8,["modelValue"])]),_:1}),o(g,{label:"封面"},{default:n(()=>[o(T,{accept:[".jpg",".png",".jpeg",".svg",".webp"],value:l(r).covers,"onUpdate:value":a[1]||(a[1]=t=>l(r).covers=t)},null,8,["accept","value"])]),_:1}),o(g,{label:"描述"},{default:n(()=>[o(k,{modelValue:l(r).description,"onUpdate:modelValue":a[2]||(a[2]=t=>l(r).description=t),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),o(g,{label:"备注"},{default:n(()=>[o(k,{modelValue:l(r).remark,"onUpdate:modelValue":a[3]||(a[3]=t=>l(r).remark=t),type:"textarea",autosize:{minRows:3,maxRows:12},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","label-position"])]),_:1},8,["modelValue"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{Ne as default};
