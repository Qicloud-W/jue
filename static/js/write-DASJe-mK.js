import{_ as V,a as k}from"./Vditor-DbNEEuP_.js";import{E as j,L as x,a as S,F as E,G as U}from"./element-plus-DEgQ78-a.js";import{_ as C}from"./CommonSelect-BPJDZPOW.js";import{u as I,p as g,n as M,A as w,d as N}from"./index-CYWUNeU5.js";import{a as A}from"./vue-router-MJGgZ6ro.js";import{a as T,s as D,b as O,c as B,d as F}from"./options-BvRdR4NQ.js";import{d as J,m as R,bg as K,o as $,c as z,W as a,O as s,u as t,bn as G,bl as H,a as b}from"./@vue-AVcRlItG.js";import"./vditor-CyQdJvZo.js";import"./clipboard-CJr-i2j9.js";import"./@vueuse-80B0Z04t.js";import"./vueuse-CTCWISgP.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const v=u=>(G("data-v-abd53fe5"),u=u(),H(),u),L={class:"admin-article-page-wrapper flex g-4"},P=v(()=>b("h4",null,"撰写页面",-1)),W=v(()=>b("h4",null,"页面配置",-1)),q=J({__name:"write",setup(u){const c=I(),_=A(),o=R({formModel:{id:void 0,title:"",tags:[],key:"",content:"",remark:"",audit:c.admin?1:0,editor:"vditor",json:{comment:{allow:1,show:1}}},allow_options:T,show_options:D,auth_options:O,audit_options:B,bool_num_options:F,tags_options:[],loading:!1}),m={initData:()=>{m.fetchData(),m.getTags()},fetchData:async()=>{var n;if(_.params.id){const e=await g.one({id:_.params.id});e.code===200&&(o.formModel.id=e.data.id,o.formModel.audit=e.data.audit,o.formModel.title=e.data.title,o.formModel.key=e.data.key,e.data.json&&e.data.json.comment&&(o.formModel.json.comment=e.data.json.comment),o.formModel.remark=e.data.remark||"",o.formModel.content=e.data.content,o.formModel.tags=((n=e.data.tags.match(/\d+/g))==null?void 0:n.map(Number))||[])}},handleSubmit:async()=>{if(!o.formModel.title)return j.warning("标题不能为空");o.loading=!0;try{const n=JSON.parse(JSON.stringify({...o.formModel.json})),e={...o.formModel,tags:o.formModel.tags.length?`|${o.formModel.tags.join("|")}|`:"",json:JSON.stringify({...n})},i=await g.save(e);M(i),i.code===200&&(o.formModel.id=i.data.id)}finally{o.loading=!1}},getTags:async()=>{const n=await w.column({field:"id,name"});n.code===200&&(o.tags_options=n.data)},handleTags:n=>{n&&n.length&&n.forEach(async(e,i)=>{if(typeof e=="string"){const{code:r,msg:p,data:d}=await w.save({name:e});if(r!==200)return M(r,void 0,"添加标签失败："+p),o.tags_options.splice(i,1);o.formModel.tags[i]=d.id,o.tags_options.push({id:d.id,name:e})}})}};return K(()=>{m.initData()}),(n,e)=>{const i=k,r=x,p=S,d=E,f=C,h=U,y=V;return $(),z("div",L,[a(r,{class:"box-card cus-box-card w-100 article-left flex-column",shadow:"never"},{header:s(()=>[P]),default:s(()=>[a(i,{class:"flex-1",content:t(o).formModel.content,"onUpdate:content":e[0]||(e[0]=l=>t(o).formModel.content=l)},null,8,["content"])]),_:1}),a(r,{class:"article-config-card box-card cus-box-card",shadow:"never"},{header:s(()=>[W]),default:s(()=>[a(h,{"label-position":"top"},{default:s(()=>[a(d,{label:"页面标题"},{default:s(()=>[a(p,{modelValue:t(o).formModel.title,"onUpdate:modelValue":e[1]||(e[1]=l=>t(o).formModel.title=l),placeholder:"请输入页面标题"},null,8,["modelValue"])]),_:1}),a(d,{label:"页面唯一键"},{default:s(()=>[a(p,{modelValue:t(o).formModel.key,"onUpdate:modelValue":e[2]||(e[2]=l=>t(o).formModel.key=l),placeholder:"请输入页面页面唯一键"},null,8,["modelValue"])]),_:1}),a(d,{label:"审核状态"},{default:s(()=>[a(f,{disabled:!t(c).admin,class:"w-100",options:t(o).audit_options,value:t(o).formModel.audit,"onUpdate:value":e[3]||(e[3]=l=>t(o).formModel.audit=l)},null,8,["disabled","options","value"])]),_:1}),a(d,{label:"页面标签"},{default:s(()=>[a(f,{class:"w-100",valueKey:"id",labelKey:"name",multiple:"","allow-create":"",filterable:"","reserve-keyword":!1,options:t(o).tags_options,value:t(o).formModel.tags,"onUpdate:value":e[4]||(e[4]=l=>t(o).formModel.tags=l),placeholder:"设置页面标签",onChange:m.handleTags},null,8,["options","value","onChange"])]),_:1}),a(d,{label:"允许评论"},{default:s(()=>[a(f,{class:"w-100",options:t(o).allow_options,modelValue:t(o).formModel.json.comment.allow,"onUpdate:modelValue":e[5]||(e[5]=l=>t(o).formModel.json.comment.allow=l)},null,8,["options","modelValue"])]),_:1}),a(d,{label:"显示评论"},{default:s(()=>[a(f,{class:"w-100",options:t(o).show_options,value:t(o).formModel.json.comment.show,"onUpdate:value":e[6]||(e[6]=l=>t(o).formModel.json.comment.show=l)},null,8,["options","value"])]),_:1}),a(d,{label:"页面备注"},{default:s(()=>[a(p,{modelValue:t(o).formModel.remark,"onUpdate:modelValue":e[7]||(e[7]=l=>t(o).formModel.remark=l),type:"textarea",placeholder:"请填写页面备注",autosize:{minRows:4,maxRows:8}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(y,{onHandleClick:e[8]||(e[8]=l=>m.handleSubmit()),loading:t(o).loading},null,8,["loading"])])}}}),Ao=N(q,[["__scopeId","data-v-abd53fe5"]]);export{Ao as default};
