import{_ as D}from"./Table-CEy5VCRK.js";import{V as I,_ as T,W as $,b as E,X as V,Y}from"./element-plus-DEgQ78-a.js";import{p as b}from"./vueuse-CTCWISgP.js";import{S as H}from"./sortablejs-BS5toX6s.js";import{u as N}from"./vue-router-MJGgZ6ro.js";import{b as A}from"./@vueuse-80B0Z04t.js";import{p as r,n as _}from"./index-CYWUNeU5.js";import{d as M,i as U,m as z,bg as B,b as O,o as u,M as f,O as d,u as n,W as s,a as h,U as k,T as g,S}from"./@vue-AVcRlItG.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const J={class:"flex-center"},ve=M({__name:"list",setup(W){const w=N(),y=U(),{width:x}=A(),e=z({page:1,count:0,limit:15,page_count:0,is_screen:!1,loading:0,loading_index:-1,select_list:[],data_list:[],only_trashed:!1}),i={fetchData:async()=>{e.loading=1;const t=await r.all({page:e.page,limit:e.limit,onlyTrashed:e.only_trashed});t.code===200?(e.data_list=t.data.data.sort((o,l)=>(o.json.sort||0)<(l.json.sort||0)?1:(o.json.sort||0)>(l.json.sort||0)?-1:0),e.count=t.data.count,e.page_count=t.data.page):e.data_list=[],e.loading=0},handleAudit:async t=>{const o=await r.update({id:t.id,key:t.key,audit:t.audit===1?0:1});o.code===200&&(t.audit=t.audit===1?0:1),_(o)},getTrash:()=>{e.only_trashed=!e.only_trashed,i.fetchData()},handleSelect:t=>{e.select_list=[...t.map(o=>o.id)]},handleAdd:()=>{w.push({name:"admin-pages-write"})},handleEdit:t=>{w.push({name:"admin-pages-write",params:{id:t}})},handleRestore:async(t,o)=>{o===-1?e.loading=4:e.loading_index=o;const l=await r.restore(t);_(l),e.data_list=e.data_list.filter(m=>!l.data.ids.includes(m.id)),e.loading_index=-1,e.loading=0},handleRemove:async t=>{const o=e.only_trashed?await r.delete(t):await r.remove(t);_(o),o.code===200&&(e.data_list=e.data_list.filter(l=>!o.data.ids.includes(l.id))),i.fetchData()},rowDblclick:t=>{e.select_list.includes(t.id)?e.select_list=e.select_list.filter(o=>o!==t.id):e.select_list.push(t.id),y.value.toggleRowSelection(t)},formatEmpty:t=>t.abstract||"-",handleSort:async t=>{await r.update({id:t.id,key:t.key,json:JSON.stringify(t.json)}),i.fetchData()},handleSortRow:()=>{new H(document.querySelector("tbody"),{animation:150,onEnd:t=>{if(t.oldIndex!==t.newIndex){const o=e.data_list[t.oldIndex].json.sort||0,l=e.data_list[t.newIndex].json.sort||0;e.data_list[t.oldIndex].json.sort=l,e.data_list[t.newIndex].json.sort=o,r.update({id:e.data_list[t.oldIndex].id,key:e.data_list[t.oldIndex].key,json:JSON.stringify(e.data_list[t.oldIndex].json)}),r.update({id:e.data_list[t.newIndex].id,key:e.data_list[t.newIndex].key,json:JSON.stringify(e.data_list[t.newIndex].json)})}}})}};return B(()=>{i.fetchData()}),O(()=>{i.handleSortRow()}),(t,o)=>{const l=I,m=T,C=$,c=E,v=V,R=Y,j=D;return u(),f(j,{ref:"tables",class:"article-group-data-container",page:n(e).page,"onUpdate:page":o[0]||(o[0]=a=>n(e).page=a),limit:n(e).limit,"onUpdate:limit":o[1]||(o[1]=a=>n(e).limit=a),pageCount:n(e).page_count,"onUpdate:pageCount":o[2]||(o[2]=a=>n(e).page_count=a),isScreen:n(e).is_screen,"onUpdate:isScreen":o[3]||(o[3]=a=>n(e).is_screen=a),loading:n(e).loading,length:n(e).select_list.length,count:n(e).count,onlyTrashed:n(e).only_trashed,onHandleAdd:o[4]||(o[4]=a=>i.handleAdd()),onHandleRestore:o[5]||(o[5]=a=>i.handleRestore(n(e).select_list,-1)),onHandleRemove:o[6]||(o[6]=a=>i.handleRemove(n(e).select_list)),onGetTrash:o[7]||(o[7]=a=>i.getTrash()),onHandleRefresh:o[8]||(o[8]=a=>i.fetchData())},{default:d(()=>[s(R,{border:"",ref_key:"tableRef",ref:y,data:n(e).data_list,"empty-text":"",class:"w-100","max-height":n(e).is_screen?"calc(100vh - 120px)":"calc(100vh - 270px)",onSelectionChange:i.handleSelect,onRowDblclick:i.rowDblclick},{default:d(()=>[s(l,{fixed:"",type:"selection",width:"45"}),s(l,{fixed:n(x)>768,type:"index",label:"序号",width:"60",align:"center"},null,8,["fixed"]),s(l,{label:"排序",width:"150",align:"center"},{default:d(a=>[s(m,{onChange:p=>i.handleSort(a.row),style:{width:"100px"},size:"small",modelValue:a.row.json.sort,"onUpdate:modelValue":p=>a.row.json.sort=p},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),s(l,{prop:"title",label:"标题",width:"250","show-overflow-tooltip":""}),s(l,{prop:"key",label:"唯一键",width:"100","show-overflow-tooltip":""}),s(l,{width:"80",label:"审核",align:"center"},{default:d(({row:a})=>[s(C,{"inline-prompt":"","active-text":"是","inactive-text":"否","model-value":a.audit===1,onChange:p=>i.handleAudit(a)},null,8,["model-value","onChange"])]),_:1}),s(l,{prop:"remark",label:"备注","min-width":"250","show-overflow-tooltip":""}),s(l,{prop:"update_time",sortable:"",label:"更新时间",width:"160"},{default:d(a=>[h("span",null,k(n(b)(a.row.update_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),s(l,{prop:"create_time",sortable:"",width:"160",label:"创建时间"},{default:d(a=>[h("span",null,k(n(b)(a.row.create_time,"YYYY-MM-DD HH:mm")),1)]),_:1}),s(l,{fixed:n(x)<768?!1:"right",align:"center",label:"操作","class-name":"center",width:140},{default:d(a=>[h("div",J,[n(e).only_trashed?S("",!0):(u(),f(c,{key:0,size:"small",type:"primary",plain:"",onClick:p=>i.handleEdit(a.row.id)},{default:d(()=>[g(" 编辑 ")]),_:2},1032,["onClick"])),n(e).only_trashed?(u(),f(c,{key:1,onClick:p=>i.handleRestore([a.row.id],a.$index),size:"small",loading:n(e).loading_index===a.$index,type:"success",plain:""},{default:d(()=>[g(" 恢复 ")]),_:2},1032,["onClick","loading"])):S("",!0),s(v,{onConfirm:p=>i.handleRemove([a.row.id]),width:"180",title:n(e).only_trashed?"彻底删除该条数据？":"移至回收站?"},{reference:d(()=>[s(c,{size:"small",type:"danger",plain:""},{default:d(()=>[g(" 删除 ")]),_:1})]),_:2},1032,["onConfirm","title"])])]),_:1},8,["fixed"])]),_:1},8,["data","max-height","onSelectionChange","onRowDblclick"])]),_:1},8,["page","limit","pageCount","isScreen","loading","length","count","onlyTrashed"])}}});export{ve as default};
