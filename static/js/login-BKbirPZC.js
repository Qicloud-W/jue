import{D as j,E as F,a as J,F as Q,b as X,G as Y,g as Z}from"./element-plus-DEgQ78-a.js";import{u as ee,a as oe,b as h,n as I,_ as N,c as le,d as P,e as ae}from"./index-CYWUNeU5.js";import{d as T,i as w,m as K,H as se,o as u,M as te,O as d,u as e,c as v,a as t,S as k,V as S,W as a,ai as M,T as V,U as E,bn as A,bl as D,a0 as re}from"./@vue-AVcRlItG.js";import{a as ne,u as G}from"./vue-router-MJGgZ6ro.js";import{e as ie,_ as de}from"./LoginLeft-DkxJ_TY_.js";import{f as ce}from"./@vueuse-80B0Z04t.js";import"./lodash-es-25cZ6aDd.js";import"./async-validator-DKvM95Vc.js";import"./dayjs-D7ajE0Qg.js";import"./clipboard-CJr-i2j9.js";import"./@element-plus-Bh_lnI-E.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./pinia-DsZbUfLd.js";import"./pinia-plugin-persistedstate-n2tMOXAx.js";import"./axios-BdQ6k-vz.js";import"./nprogress-Dnjw-PvA.js";import"./markdown-it-4Tp5vWU9.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-XL2UFyD4.js";import"./entities-C20TfXL6.js";import"./linkify-it-BpOB9kmn.js";import"./punycode.js-Dj65hjkv.js";import"./crypto-js-BOfVfFwP.js";import"./vue3-danmaku-DA_6354Q.js";import"./plyr-DMguYs3u.js";import"./viewerjs-ul8fLQ7-.js";import"./highlight.js-DnQT8WiG.js";import"./@unhead-CE7b8z0V.js";import"./unhead-BIJBGSS1.js";import"./hookable-B8xFkYCm.js";const U=p=>(A("data-v-b4f082a6"),p=p(),D(),p),pe=U(()=>t("div",{class:"fs-28 white-color fw-600 mb5"},"登  录",-1)),ue={style:{height:"20px"}},me={class:"flex-yc g-2 w-100"},fe={class:"flex-sb fs-12 muted-color mt-1"},ge={class:"flex-yc g-1 curp hvco login-tip"},_e=U(()=>t("div",{class:"flex-yc mt-2"},[t("div",{class:"split-line"}),t("span",{class:"flex-shrink-0 mx-1 fs-12 muted-color login-tip",style:{color:"#ddd"}},"社交账号登录"),t("div",{class:"split-line"})],-1)),ve={class:"flex-center mt-2"},we={class:"flex-yc g-3"},ye=U(()=>t("div",{class:"fs-28 mb-2 white-color fw-600"},"重置密码",-1)),be={class:"flex-yc g-2 w-100"},he={class:"flex-yc w-100 g-1 mt-4"},ke=T({__name:"LoginForm",setup(p){const i=w(60),C=w(!1),q=ee(),x=ne(),R=G(),y=w(),c=w(!1),m=w(!1),f=w(0),$=w(!1),l=K({account:"",email:"",password:"",re_password:"",code:""}),{pause:B,resume:z}=ce(()=>{i.value--,i.value<=0&&(i.value=60,B())},1e3,{immediate:!0}),O=K({account:[{required:!0,message:"账号或邮箱不能为空",trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{pattern:ie,message:"邮箱格式不正确",trigger:"blur"}],re_password:[{required:!0,message:"请重复密码",trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}]}),g={init:()=>{},fetchData:async()=>{const n=await oe.one("ALLOW_REGISTER");n.code===200&&(C.value=n.data.value==="1")},handleLogin:async()=>{const n=y.value;n&&n.validate(async o=>{if(o){c.value=!0;try{let r;f.value===0?r=await h.login(l.account,l.password):r=await h.loginByCode(l.email,l.code),r.code===200?(j({title:"登录成功！",message:`欢迎你，${r.data.user.nickname}！`,type:"success"}),g.afterLogin(r.data)):I(r)}finally{c.value=!1}}})},getLogincode:async()=>{if(!l.email)return F.warning("邮箱不能为空");m.value=!0;try{const n=await h.loginByCode(l.email);n.code===201&&(i.value=i.value-1,z()),I(n)}finally{m.value=!1}},getResetcode:async()=>{if(!l.email)return F.warning("邮箱不能为空");m.value=!0;try{const n=await h.resetPwd(l.email);n.code===201&&(i.value=i.value-1,z()),I(n)}finally{m.value=!1}},handleResetPwd:()=>{const n=y.value;n&&n.validate(async o=>{if(o){c.value=!0;try{if(l.password!==l.re_password)return F.warning("两次输入密码不一致");const r=await h.resetPwd(l.email,l.code,l.password);I(r),r.code===200&&(i.value=60,$.value=!1)}finally{c.value=!1}}})},afterLogin:n=>{q.setLogin(n);const o=x.query.redirect;window.location.href=o?decodeURIComponent(o):"/"}};return se(()=>{B()}),g.fetchData(),(n,o)=>{const r=J,_=Q,b=X,W=N,L=le,H=Y;return u(),te(H,{"hide-required-asterisk":"",ref_key:"loginFormRef",ref:y,model:e(l),class:"login-body pr",rules:e(O),"label-position":"top"},{default:d(()=>[e($)?(u(),v(S,{key:1},[ye,a(_,{label:"邮箱",prop:"email"},{default:d(()=>[a(r,{clearable:"",modelValue:e(l).email,"onUpdate:modelValue":o[8]||(o[8]=s=>e(l).email=s),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(_,{label:"密码",prop:"password"},{default:d(()=>[a(r,{onKeyup:M(g.handleLogin,["enter"]),clearable:"","show-password":"",modelValue:e(l).password,"onUpdate:modelValue":o[9]||(o[9]=s=>e(l).password=s),type:"password",placeholder:"请输入新密码"},null,8,["onKeyup","modelValue"])]),_:1}),a(_,{label:"确认密码",prop:"re_password"},{default:d(()=>[a(r,{clearable:"","show-password":"",modelValue:e(l).re_password,"onUpdate:modelValue":o[10]||(o[10]=s=>e(l).re_password=s),type:"password",placeholder:"请重复输入新密码"},null,8,["modelValue"])]),_:1}),a(_,{label:"验证码",prop:"code"},{default:d(()=>[t("div",be,[a(r,{clearable:"",class:"w-100",modelValue:e(l).code,"onUpdate:modelValue":o[11]||(o[11]=s=>e(l).code=s),placeholder:"请输入验证码"},null,8,["modelValue"]),a(b,{type:"primary",loading:e(m),disabled:e(i)<60,plain:"",onClick:g.getResetcode},{default:d(()=>[V(E(e(i)===60?"获取验证码":`${e(i)}s`),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1}),t("div",he,[a(b,{class:"w-100",onClick:o[12]||(o[12]=s=>$.value=!1)},{default:d(()=>[V("返回登录")]),_:1}),a(b,{class:"w-100",type:"primary",onClick:g.handleResetPwd,loading:e(c)},{default:d(()=>[V(E(e(c)?"提交中":"提  交"),1)]),_:1},8,["onClick","loading"])])],64)):(u(),v(S,{key:0},[pe,t("div",ue,[e(C)?(u(),v("div",{key:0,onClick:o[0]||(o[0]=s=>e(R).push({name:"Register"})),class:"login-tip fs-12 curp hvco"}," 没有账号？点击注册 ")):k("",!0)]),e(f)===0?(u(),v(S,{key:0},[a(_,{label:"账号",prop:"account",class:"mt-2"},{default:d(()=>[a(r,{modelValue:e(l).account,"onUpdate:modelValue":o[1]||(o[1]=s=>e(l).account=s),placeholder:"请输入账号或邮箱",clearable:""},null,8,["modelValue"])]),_:1}),a(_,{label:"密码",prop:"password"},{default:d(()=>[a(r,{onKeyup:M(g.handleLogin,["enter"]),clearable:"","show-password":"",modelValue:e(l).password,"onUpdate:modelValue":o[2]||(o[2]=s=>e(l).password=s),type:"password",placeholder:"请输入登录密码"},null,8,["onKeyup","modelValue"])]),_:1})],64)):k("",!0),e(f)===1?(u(),v(S,{key:1},[a(_,{label:"邮箱",prop:"email"},{default:d(()=>[a(r,{modelValue:e(l).email,"onUpdate:modelValue":o[3]||(o[3]=s=>e(l).email=s),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1}),a(_,{label:"验证码",prop:"code"},{default:d(()=>[t("div",me,[a(r,{clearable:"",class:"w-100",modelValue:e(l).code,"onUpdate:modelValue":o[4]||(o[4]=s=>e(l).code=s),placeholder:"请输入验证码"},null,8,["modelValue"]),a(b,{type:"primary",loading:e(m),disabled:e(i)<60,plain:"",onClick:g.getLogincode},{default:d(()=>[V(E(e(i)===60?"获取验证码":`${e(i)}s`),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1})],64)):k("",!0),a(b,{type:"primary",onClick:g.handleLogin,loading:e(c),class:"w-100 mt-4"},{default:d(()=>[V(E(e(c)?"登录中":"登录"),1)]),_:1},8,["onClick","loading"]),t("div",fe,[t("div",ge,[a(W,{name:"exchange-line",size:"14"}),e(f)===0?(u(),v("span",{key:0,onClick:o[5]||(o[5]=s=>f.value=1)},"验证码登录")):k("",!0),e(f)===1?(u(),v("span",{key:1,onClick:o[6]||(o[6]=s=>f.value=0)},"账号密码登录")):k("",!0)]),t("span",{class:"curp hvco login-tip",onClick:o[7]||(o[7]=s=>$.value=!0)},"忘记密码?")]),_e,t("div",ve,[t("div",we,[a(L,{name:"qq",class:"curp hover-scale",size:"30"}),a(L,{name:"wechat",class:"curp hover-scale",size:"30"}),a(L,{name:"github",class:"curp hover-scale",size:"30"}),a(L,{name:"baidu",class:"curp hover-scale",size:"30"})])])],64))]),_:1},8,["model","rules"])}}}),Ve=P(ke,[["__scopeId","data-v-b4f082a6"]]),Ce=p=>(A("data-v-bb882546"),p=p(),D(),p),xe={class:"br-5 overhide login-wrapper flex"},$e={class:"login-right flex-yc w-100 p-3 pr"},Le=Ce(()=>t("div",{class:"theme-overlay wh-100 pa inset-0"},null,-1)),Ie=T({__name:"login",setup(p){const i=G(),C=ae();return(q,x)=>{const R=de,y=Ve,c=N,m=Z;return u(),v("div",{class:"login-page-wrapper shadow flex-center pr",style:re({backgroundImage:`url(${e(C).theme.login_bg})`})},[t("div",xe,[a(R),t("div",$e,[a(y,{class:"w-100"}),a(m,{class:"box-item",effect:"dark",content:"返回首页"},{default:d(()=>[t("div",{onClick:x[0]||(x[0]=f=>e(i).push("/")),class:"close curp hvco muted-color"},[a(c,{name:"home-5-line",color:"#eee",size:"22"})])]),_:1})])]),Le],4)}}}),no=P(Ie,[["__scopeId","data-v-bb882546"]]);export{no as default};
