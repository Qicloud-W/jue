import{e as N,c as M,p as V,q as R,j as A,E as D,f as H,b as P}from"./element-plus-DEgQ78-a.js";import{l as F,u as q,w as z,n as J,_ as O,d as Q}from"./index-CYWUNeU5.js";import{d as L,o as c,M as B,O as a,J as W,W as i,al as U,u as l,a as m,c as f,aa as I,V as T,bE as G,i as x,F as K,S as X,U as Y,a3 as $,Q as Z,T as ee,bn as te,bl as ne}from"./@vue-AVcRlItG.js";import{u as oe}from"./vue-router-MJGgZ6ro.js";import{h as se}from"./@vueuse-80B0Z04t.js";const ae={class:"emoji-grid"},le=["onClick","src"],ie={class:"emoji-grid"},re=["onClick","src"],ce={class:"emoji-grid"},de=["onClick","src"],pe=L({__name:"EmojiSelect",props:{width:{default:300},trigger:{default:"hover"},placement:{default:"bottom-start"}},emits:["handleSelect"],setup(S,{emit:j}){const h=j,g=F(),y={handleSelect:r=>{h("handleSelect",r)}};return g.getEmoji(),(r,b)=>{const k=N,w=M,o=V,v=R,C=A;return c(),B(C,{"popper-class":"emoji-popover-wrap",placement:r.placement,width:r.width,trigger:r.trigger,teleported:!1,style:{"--el-tabs-header-height":"30px"}},{reference:a(()=>[W(r.$slots,"default")]),default:a(()=>[i(k,{animated:"",throttle:200,loading:!l(g).emoji},U({template:a(()=>[i(k)]),_:2},[l(g).emoji?{name:"default",fn:a(()=>[i(v,null,{default:a(()=>[i(o,{label:"抖音"},{default:a(()=>[i(w,{"max-height":200},{default:a(()=>[m("div",ae,[(c(!0),f(T,null,I(l(g).emoji.tiktok,(d,t)=>(c(),f("img",{onClick:n=>y.handleSelect(d),src:d,key:t,class:"trf"},null,8,le))),128))])]),_:1})]),_:1}),i(o,{label:"QQ"},{default:a(()=>[i(w,{"max-height":200},{default:a(()=>[m("div",ie,[(c(!0),f(T,null,I(l(g).emoji.qq,(d,t)=>(c(),f("img",{onClick:n=>y.handleSelect(d),src:d,key:t,class:"trf"},null,8,re))),128))])]),_:1})]),_:1}),i(o,{label:"TV"},{default:a(()=>[i(w,{"max-height":200},{default:a(()=>[m("div",ce,[(c(!0),f(T,null,I(l(g).emoji.bilibili,(d,t)=>(c(),f("img",{onClick:n=>y.handleSelect(d),src:d,key:t,class:"trf"},null,8,de))),128))])]),_:1})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["loading"])]),_:3},8,["placement","width","trigger"])}}}),ue=S=>(te("data-v-1701a305"),S=S(),ne(),S),me={class:"comment-input-wrapper"},_e={key:0,class:"form-box-wrapper flex g-2"},fe={class:"fs-14 muted-colo placeholder"},he=["innerHTML"],ge={key:1,class:"login-tip-wrapper br-5 flex-center"},ve={class:"py-3 center"},be=ue(()=>m("p",{class:"fs-12 mt-2 light-text"},"请先登录后参与评论!",-1)),we=L({__name:"CommentInput",props:{pid:{},bindId:{},bindType:{},focus:{type:Boolean},placeholderText:{}},emits:["handleSend"],setup(S,{emit:j}){G(n=>({"966efef6":l(v)?"inline":"none"}));const h=S,g=j,y=oe(),r=q(),b=F(),k=x(),{focused:w}=se(k,{initialValue:h.focus}),o=x(""),v=x(!0),C=x(!1),d=K("ws"),t={handleSubmit:async()=>{var s,p,u;if(!o.value)return D.warning("评论内容不能为空");C.value=!0;const n=JSON.stringify({area:`${((s=b.ipInfo)==null?void 0:s.province)||""}${((p=b.ipInfo)==null?void 0:p.city)||""}`,addres:((u=b.address)==null?void 0:u.formatted_address)||"",lon:b.pos.lon||0,lat:b.pos.lat||0}),e=await z.save({pid:h.pid,bind_id:h.bindId,bind_type:h.bindType,content:o.value,json:n});C.value=!1,J(e,"评论成功!"),e.code===200&&(v.value=!0,g("handleSend"),d.send(JSON.stringify({headers:{"content-type":"broadcast"},body:{type:"comment",avatar:r.user.avatar,nickname:r.user.nickname,comment_id:e.data.id,content:o.value,bind_id:h.bindId,bind_type:h.bindType}})),o.value="")},handleBlur:n=>{var p;window.removeEventListener("paste",t.handlePaste);const s=(((p=n.target)==null?void 0:p.innerHTML)||"").replace(/<div><br>/g,`
`).replace(/<div>/g,`
`).replace(/<[^>]+>/g,function(u){return/<img[^>]*>/.test(u)?u:""});s.trim()===""?o.value="":o.value=s||"",v.value=!o.value},handleFocus:()=>{window.addEventListener("paste",t.handlePaste);const n=k.value;if(n){const e=document.createRange();e.selectNodeContents(n),e.collapse(!1);const s=window.getSelection();s&&(s.removeAllRanges(),s.addRange(e))}},handleInput:()=>{v.value=!1},handlePaste:n=>{var p,u,E;n.preventDefault();const e=(n.clipboardData||window.clipboardData).getData("text/plain"),s=document.createElement("span");v.value=!e,s.innerHTML=e,(p=window.getSelection())==null||p.deleteFromDocument(),(u=window.getSelection())==null||u.getRangeAt(0).insertNode(s),(E=window.getSelection())==null||E.collapseToEnd()},insertEmoji:n=>{o.value+=`<img src="${n}" class="emoji" />`,v.value=!1},handleClickFooter:()=>{w.value=!0},handleLogin:()=>{y.push({name:"Login",query:{redirect:window.location.href}})}};return b.getAddress(),(n,e)=>{const s=H,p=O,u=pe,E=P;return c(),f("div",me,[l(r).user?(c(),f("div",_e,[n.pid===0?(c(),B(s,{key:0,class:"flex-shrink-0 hide-phone",src:l(r).user.avatar,size:36},null,8,["src"])):X("",!0),m("div",{class:Z(["form-box w-100 br-5 trf pr",{"is-active":l(w)||l(o),"is-focus":l(w)}])},[m("div",fe,Y(n.placeholderText||"说些什么吧..."),1),m("div",{ref_key:"inputRef",ref:k,tabindex:0,contenteditable:"true",spellcheck:"false",class:"rich-input-wrapper word-break article-content lh-17 p-1 fs-15",onInput:e[0]||(e[0]=(..._)=>t.handleInput&&t.handleInput(..._)),onFocus:e[1]||(e[1]=(..._)=>t.handleFocus&&t.handleFocus(..._)),onBlur:e[2]||(e[2]=(..._)=>t.handleBlur&&t.handleBlur(..._)),innerHTML:l(o)},null,40,he),m("div",{onClick:e[4]||(e[4]=(..._)=>t.handleClickFooter&&t.handleClickFooter(..._)),class:"comment-input-footer-wrap flex-yc flex-sb p-1"},[i(u,{onHandleSelect:t.insertEmoji},{default:a(()=>[i(p,{onClick:e[3]||(e[3]=$(()=>{},["stop"])),name:"emotion-line",class:"light-text theme-hover curp",size:"20"})]),_:1},8,["onHandleSelect"]),i(E,{loading:l(C),size:"small",type:"primary",onClick:$(t.handleSubmit,["stop"])},{default:a(()=>[ee("发送")]),_:1},8,["loading","onClick"])])],2)])):(c(),f("div",ge,[m("div",ve,[m("span",{class:"login-btn br-3 curp trf fs-14",onClick:e[5]||(e[5]=(..._)=>t.handleLogin&&t.handleLogin(..._))},"请先登录"),be])]))])}}}),xe=Q(we,[["__scopeId","data-v-1701a305"]]);export{xe as _,pe as a};
